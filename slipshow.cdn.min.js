var Slipshow=function(t){"use strict";let e=(t,e,i)=>{i=i||"slip-slip",t.id||(t.id="_"+Math.random().toString(36).substr(2,15));let s=Array.from(t.querySelectorAll(e)),o=e.split(",").map(e=>"#"+t.id+" "+i+" "+e).join(),n=Array.from(t.querySelectorAll(o));return s.filter(t=>!n.includes(t))};function i(t){let e=t.cloneNode(!1);return t.childNodes.forEach(t=>{if(t.tagName&&"SLIP-SLIP"==t.tagName){let i=document.createElement(t.tagName);i.classList.add("toReplace"),e.appendChild(i)}else e.appendChild(i(t))}),e}function s(t,i){let s=e(t,".toReplace");i.forEach((t,e)=>{s[e].replaceWith(t)})}function o(t){let e=t;this.getEngine=()=>this.engine,this.setEngine=t=>this.engine=t;let i=1;document.addEventListener("keypress",t=>{"f"==t.key&&(i=(i+4)%30+1),"r"==t.key&&e.getCurrentSlip().refresh(),"#"==t.key&&(document.querySelectorAll("slip-slip").forEach(t=>{t.style.zIndex="-1"}),document.querySelectorAll(".background-canvas").forEach(t=>{t.style.zIndex="1"}))}),document.addEventListener("keydown",t=>{let s=e.getOpenWindowHeight(),o=e.getOpenWindowWidth();"l"==t.key&&e.moveWindowRelative(0,i/s,0,0,.1),"o"==t.key&&e.moveWindowRelative(0,-i/s,0,0,.1),"k"==t.key&&e.moveWindowRelative(-i/o,0,0,0,.1),"m"==t.key&&e.moveWindowRelative(i/o,0,0,0,.1),"i"==t.key&&e.moveWindowRelative(0,0,0,1,.1),"p"==t.key&&e.moveWindowRelative(0,0,0,-1,.1),"z"==t.key&&e.moveWindowRelative(0,0,.01,0,.1),"Z"==t.key&&e.moveWindowRelative(0,0,-.01,0,.1),"T"==t.key&&e.showToC(),"t"==t.key&&(document.querySelector(".toc-slip").style.display="none"==document.querySelector(".toc-slip").style.display?"block":"none"),"ArrowRight"==t.key?(console.log(t),t.shiftKey?e.nextSlip():e.next()):"ArrowLeft"==t.key?t.shiftKey?e.previousSlip():e.previous():"ArrowUp"==t.key&&e.pop()})}function n(t,o,l,r,a){this.generateActionList=function(){console.log("debug generateactionlist",this.name);let t=[];return this.queryAll("slip-slip[enter-at]").forEach(e=>{console.log("new slip with ",e,null,null,r,{}),t[e.getAttribute("enter-at")]=new n(e,"",[],r,{})}),t},this.addSubSlips=function(){console.log("debug generateactionlist",this.name);return this.queryAll("slip-slip[enter-at]").forEach(t=>{console.log("new slip with ",t,null,null,r,{}),this.setNthAction(t.getAttribute("enter-at"),new n(t,"",[],r,{}))}),[]};let u=l;this.setAction=t=>{u=t},this.getActionList=()=>{let t=[];for(let e=0;e<=this.getMaxNext();e++)this.pauseSlipList[e]instanceof n?t[e]=this.pauseSlipList[e]:"function"==typeof u[e]||u[e]instanceof n?t[e]=u[e]:t[e]=()=>{};return t},this.setNthAction=(t,e)=>{u[t]=e},this.getCurrentSubSlip=()=>u[this.getActionIndex()]instanceof n?u[this.getActionIndex()]:this.pauseSlipList[this.getActionIndex()]instanceof n&&this.pauseSlipList[this.getActionIndex()],this.nextStageNeedGoto=()=>!(u[this.getActionIndex()+1]instanceof n)&&(!(this.pauseSlipList[this.getActionIndex()+1]instanceof n)&&!(this.getActionIndex()>=this.getMaxNext())),this.getSubSlipList=function(){return this.getActionList().filter(t=>t instanceof n)};let c=-1;this.setActionIndex=t=>c=t,this.getActionIndex=()=>c,this.getMaxNext=()=>{if(this.maxNext)return this.maxNext;let t=u.length;["mk-visible-at","mk-hidden-at","mk-emphasize-at","mk-unemphasize-at","emphasize-at","chg-visib-at","up-at","down-at","center-at","static-at","exec-at","enter-at","focus-at","unfocus-at"].forEach(e=>{this.queryAll("*["+e+"]").forEach(i=>{i.getAttribute(e).split(" ").forEach(e=>{t=Math.max(Math.abs(parseInt(e)),t)})})});let e=this.queryAll("[pause], [step], [auto-enter], [immediate-enter]").map(t=>t.hasAttribute("pause")&&""!=t.getAttribute("pause")?parseInt(t.getAttribute("pause")):t.hasAttribute("step")&&""!=t.getAttribute("step")?parseInt(t.getAttribute("step")):1);return t=Math.max(t,e.reduce((t,e)=>t+e,0)),this.maxNext=t,t},this.queryAll=t=>e(this.element,t),this.query=t=>"string"!=typeof t?t:this.queryAll(t)[0],this.findSubslipByID=t=>{let e=this.getSubSlipList().find(e=>e.name==t?1:e.findSubslipByID(t));return!!e&&(e.name==t?e:e.findSubslipByID(t))},this.findSlipCoordinate=()=>{let t=p.getCoordinateInUniverse(this.element);return console.log("debug findslipcoordinate",t),t.scale*=this.scale,t.y=t.y+.5*t.scale,t.x=t.centerX,console.log("debug findslipcoordinate",t),t},this.updatePauseAncestors=()=>{this.queryAll(".pauseAncestor").forEach(t=>{t.classList.remove("pauseAncestor")});let t=this.query("[pause]");for(;t&&"SLIP-SLIP"!=t.tagName;)t.classList.add("pauseAncestor"),t=t.parentElement},this.unpause=t=>{t.hasAttribute("down-at-unpause")&&(""==t.getAttribute("down-at-unpause")?this.moveDownTo(t,1):this.moveDownTo("#"+t.getAttribute("down-at-unpause"),1)),t.hasAttribute("up-at-unpause")&&(""==t.getAttribute("up-at-unpause")?this.moveUpTo(t,1):this.moveUpTo("#"+t.getAttribute("up-at-unpause"),1)),t.hasAttribute("center-at-unpause")&&(""==t.getAttribute("center-at-unpause")?this.moveCenterTo(t,1):this.moveCenterTo("#"+t.getAttribute("center-at-unpause"),1)),t.hasAttribute("exec-at-unpause")&&(""==t.getAttribute("exec-at-unpause")?this.executeScript(t):this.executeScript("#"+t.getAttribute("exec-at-unpause"))),t.hasAttribute("reveal-at-unpause")&&(""==t.getAttribute("reveal-at-unpause")?this.reveal(t):this.reveal("#"+t.getAttribute("reveal-at-unpause"))),t.hasAttribute("focus-at-unpause")&&(""==t.getAttribute("focus-at-unpause")?this.focus(t):this.focus("#"+t.getAttribute("focus-at-unpause"))),t.hasAttribute("unfocus-at-unpause")&&(""==t.getAttribute("unfocus-at-unpause")?this.unfocus(t):this.unfocus("#"+t.getAttribute("unfocus-at-unpause")))},this.incrPause=()=>{let t=this.query('[pause], [auto-enter]:not([auto-enter="0"]), [immediate-enter]:not([immediate-enter="0"]), [step]');if(t){if(console.log("pause is",this.name,t),t.hasAttribute("step")){t.getAttribute("step")||t.setAttribute("step",1);let e=t.getAttribute("step");e<=1?(t.removeAttribute("step"),this.unpause(t)):t.setAttribute("step",e-1)}if(t.hasAttribute("auto-enter")&&(t.setAttribute("auto-enter",0),this.unpause(t)),t.hasAttribute("immediate-enter")&&(t.setAttribute("immediate-enter",0),this.unpause(t)),t.hasAttribute("pause")){t.getAttribute("pause")||t.setAttribute("pause",1);let e=t.getAttribute("pause");e<=1?(t.removeAttribute("pause"),this.unpause(t)):t.setAttribute("pause",e-1),this.updatePauseAncestors()}}},this.doAttributes=()=>{this.queryAll("*[mk-hidden-at]").forEach(t=>{t.getAttribute("mk-hidden-at").split(" ").map(t=>parseInt(t)).includes(c)&&(t.style.opacity="0")}),this.queryAll("*[mk-visible-at]").forEach(t=>{t.getAttribute("mk-visible-at").split(" ").map(t=>parseInt(t)).includes(c)&&(t.style.opacity="1")}),this.queryAll("*[mk-emphasize-at]").forEach(t=>{t.getAttribute("mk-emphasize-at").split(" ").map(t=>parseInt(t)).includes(c)&&t.classList.add("emphasize")}),this.queryAll("*[mk-unemphasize-at]").forEach(t=>{t.getAttribute("mk-unemphasize-at").split(" ").map(t=>parseInt(t)).includes(c)&&t.classList.remove("emphasize")}),this.queryAll("*[emphasize-at]").forEach(t=>{t.getAttribute("emphasize-at").split(" ").map(t=>parseInt(t)).includes(c)?t.classList.add("emphasize"):t.classList.remove("emphasize")}),this.queryAll("*[chg-visib-at]").forEach(t=>{let e=t.getAttribute("chg-visib-at").split(" ").map(t=>parseInt(t));e.includes(c)&&(t.style.opacity="1"),e.includes(-c)&&(t.style.opacity="0")}),this.queryAll("*[static-at]").forEach(t=>{let e=t.getAttribute("static-at").split(" ").map(t=>parseInt(t));e.includes(-c)&&this.makeUnStatic(t),e.includes(c)&&this.makeStatic(t)}),this.queryAll("*[down-at]").forEach(t=>{t.getAttribute("down-at").split(" ").map(t=>parseInt(t)).includes(c)&&this.moveDownTo(t,1)}),this.queryAll("*[up-at]").forEach(t=>{t.getAttribute("up-at").split(" ").map(t=>parseInt(t)).includes(c)&&this.moveUpTo(t,1)}),this.queryAll("*[center-at]").forEach(t=>{t.getAttribute("center-at").split(" ").map(t=>parseInt(t)).includes(c)&&this.moveCenterTo(t,1)}),this.queryAll("*[focus-at]").forEach(t=>{t.getAttribute("focus-at").split(" ").map(t=>parseInt(t)).includes(c)&&this.focus(t,1)}),this.queryAll("*[unfocus-at]").forEach(t=>{t.getAttribute("unfocus-at").split(" ").map(t=>parseInt(t)).includes(c)&&this.unfocus(t,1)}),this.queryAll("*[exec-at]").forEach(t=>{t.getAttribute("exec-at").split(" ").map(t=>parseInt(t)).includes(c)&&this.executeScript(t)})},this.incrIndex=()=>{console.log("incrIndex",this.name),c+=1,this.doAttributes(),c>0&&this.incrPause(),this.updateToC()},this.next=function(){return!(c>=this.getMaxNext())&&(this.incrIndex(),"function"==typeof u[c]&&u[c](this),u[c]instanceof n?u[c]:!(this.pauseSlipList[c]instanceof n)||this.pauseSlipList[c])},this.previous=()=>{let t,e=this.getActionIndex(),i=this.currentDelay;if(this.getEngine().setDoNotMove(!0),console.log("gotoslip: we call doRefresh",this.doRefresh()),-1==e)return!1;for(;this.getActionIndex()<e-1;)console.log("previous is ca we do next",this.getEngine().getDoNotMove()),t=this.next();return setTimeout(()=>{this.getEngine().setDoNotMove(!1)},0),this.getEngine().gotoSlip(this,{delay:i}),t},this.setTocElem=t=>{this.tocElem=t},this.updateToC=()=>{if(!this.tocElem)return;let t;for(this.ToCList||(this.ToCList=e(this.tocElem,"li","li")),t=0;t<this.getActionIndex();t++)this.ToCList[t].classList.remove("before","after","current"),this.ToCList[t].classList.add("before");for(t<=this.getActionIndex()&&(this.ToCList[t].classList.remove("before","after","current"),this.ToCList[t].classList.add("current"),t++);t<=this.getMaxNext();t++)this.ToCList[t].classList.remove("before","after","current"),this.ToCList[t].classList.add("after")},this.firstVisit=()=>{this.updateToC(),a.firstVisit&&a.firstVisit(this)},this.init=()=>{this.queryAll("*[chg-visib-at]").forEach(t=>{t.style.opacity="0"}),this.doAttributes(),this.updatePauseAncestors(),a.init&&a.init(this)},this.refresh=()=>{u[c]instanceof n?u[c].refresh():this.doRefresh()},this.refreshAll=()=>{u.filter(t=>t instanceof n).forEach(t=>{t.refreshAll()}),this.pauseSlipList.filter(t=>t instanceof n).forEach(t=>{t.refreshAll()}),this.doRefresh()},this.doRefresh=()=>{console.log("gotoslip: doRefresh has been called"),this.setActionIndex(-1);let t=e(this.element,"slip-slip");console.log("mmdebug",h);let i=h.cloneNode(!0);s(i,t),this.element.replaceWith(i),this.element=i,this.init(),this.firstVisit(),delete this.currentX,delete this.currentY,delete this.currentDelay,console.log("previous is ca GOTOSLIP FROM 3",a,this.getEngine().getDoNotMove()),this.getEngine().gotoSlip(this)},this.makeUnStatic=(t,e,i)=>{let s=this.query(t);s.style.position="absolute",s.style.visibility="hidden"},this.makeStatic=t=>{let e=this.query(t);e.style.position="static",e.style.visibility="visible"},this.unfocus=t=>{this.getEngine().gotoSlip(this,{delay:1})},this.focus=t=>{let e=this.query(t);this.getEngine().moveToElement(e,{})},this.executeScript=t=>{let e;e="string"==typeof t?this.query(t):t,new Function("slip",e.innerHTML)(this)},this.moveUpTo=(t,e,i)=>{setTimeout(()=>{let s;s="string"==typeof t?this.query(t):t,void 0===i&&(i=.0125);let o=this.findSlipCoordinate(),n=(s.offsetTop/1080-i)*o.scale;this.moveWindow(o.x,o.y+n,o.scale,this.rotate,e)},0)},this.moveDownTo=(t,e,i)=>{setTimeout(()=>{let s;s="string"==typeof t?this.query(t):t,void 0===i&&(i=.0125);let o=this.findSlipCoordinate(),n=((s.offsetTop+s.offsetHeight)/1080-1+i)*o.scale;this.moveWindow(o.x,o.y+n,o.scale,this.rotate,e)},0)},this.moveCenterTo=(t,e,i)=>{setTimeout(()=>{let s;s="string"==typeof t?this.query(t):t,void 0===i&&(i=0);let o=this.findSlipCoordinate(),n=((s.offsetTop+s.offsetHeight/2)/1080-.5+i)*o.scale;this.moveWindow(o.x,o.y+n,o.scale,this.rotate,e)},0)},this.restoreWindow=()=>{this.getEngine},this.moveWindow=(t,e,i,s,o)=>{this.currentX=t,this.currentY=e,this.currentDelay=o,console.log("previous is ca we try to move win",this.getEngine().getDoNotMove()),console.log("previous is ca ORIGIN 3",t,e,this.getEngine().getDoNotMove()),this.getEngine().moveWindow(t,e,i,s,o)},this.reveal=t=>{let e;e="string"==typeof t?this.query(t):t,e.style.opacity="1"},this.revealAll=t=>{this.queryAll(t).forEach(t=>{t.style.opacity="1"})},this.hide=t=>{this.query(t).style.opacity="0"},this.hideAll=t=>{this.queryAll(t).forEach(t=>{t.style.opacity="0"})};let h,p=r;this.getEngine=()=>p,this.setEngine=t=>p=t,this.element="string"==typeof t?document.querySelector("#"==t[0]?t:"#"+t):t,this.name="string"==typeof t?t:t.id,"string"==typeof o?this.fullName=o:this.element.hasAttribute("toc-title")?this.fullName=this.element.getAttribute("toc-title"):this.fullName=this.name,console.log("this name is ",this.name),"undefined"!=typeof MathJax?MathJax.startup.promise.then(()=>{setTimeout(()=>{h=i(this.element)},0)}):setTimeout(()=>{h=i(this.element)},0),this.getCloned=()=>h,this.setCloned=t=>h=t,this.scale=parseFloat(this.element.getAttribute("scale")),(void 0===this.scale||isNaN(this.scale))&&(this.scale=1),this.rotate=parseFloat(this.element.getAttribute("rotate"))||0,this.delay=isNaN(parseFloat(this.element.getAttribute("delay")))?0:parseFloat(this.element.getAttribute("delay"));let d=this.findSlipCoordinate();console.log(d),this.x=d.x,this.y=d.y,this.init(this,p),this.addSubSlips(),this.generatePauseFlowSlipList=function(){let t=[],e=this.queryAll("[pause], [step], [auto-enter], [immediate-enter]"),i=1;return e.forEach(e=>{console.log("debug generatePauseFlowsliplist",e,i),e.hasAttribute("auto-enter")&&(t[i]=new n(e,e.getAttribute("toc-title")||"",[],r,{}),i++),e.hasAttribute("immediate-enter")&&(t[i-1]=new n(e,e.getAttribute("toc-title")||"",[],r,{}),i++),e.hasAttribute("step")&&(console.log("debug generatePauseFlowsliplist1",e,i),i+=parseInt(e.getAttribute("step"))||1,console.log("debug generatePauseFlowsliplist2",e,i)),e.hasAttribute("pause")&&(console.log("debug generatePauseFlowsliplist1",e,i),i+=parseInt(e.getAttribute("pause"))||1,console.log("debug generatePauseFlowsliplist1",e,i))}),t},this.pauseSlipList=this.generatePauseFlowSlipList()}window.myQueryAll=e;const l=function(t){"string"==typeof t?("#"!=t[0]&&(t="#"+t),t=document.querySelector(t)):void 0===t&&(t=document.querySelector("slip-slipshow")),function(t){let e=document.createElement("div");e.innerHTML='\t\t<div class="toc-slip" style="display:none;"></div>        <div id="open-window">\t  <div class="cpt-slip">0</div>\t  <div class="format-container">\t    <div class="rotate-container">\t\t<div class="scale-container">\t\t    <div class="universe movable" id="universe">\t\t\t<div width="10000" height="10000" class="fog"></div>                        <div class="placeHolder"></div>\t\t    </div>\t\t</div>              </div>\t    </div>\t</div>',t.replaceWith(e),e.querySelector(".placeHolder").replaceWith(t),t.querySelectorAll("slip-slip").forEach(t=>{setTimeout(()=>{var e=document.createElement("div"),i=document.createElement("div");let s;for(e.classList.add("slip-scale-container"),i.classList.add("slip-container");s=t.firstChild;)i.appendChild(s);e.appendChild(i),t.appendChild(e)},0)}),t.style.width="unset",t.style.height="unset",document.querySelectorAll(".background-canvas").forEach(t=>{t.addEventListener("click",t=>{console.log("vous avez cliquez aux coordonnées : ",t.layerX,t.layerY)})})}(t),document.body.style.cursor="auto";let i=[];document.body.addEventListener("mousemove",t=>{i.forEach(t=>{clearTimeout(t)}),document.body.style.cursor="auto",i.push(setTimeout(()=>{document.body.style.cursor="none"},5e3))});let s,l,r,a,u,c,h,p,d=document.querySelector("#open-window"),g=document.querySelector("#universe"),f=g.querySelectorAll("slip-slip:not(slip-slipshow)");this.getOpenWindowHeight=()=>a,this.getOpenWindowWidth=()=>l,this.getCoord=()=>({x:u,y:c,scale:h});let m=!1;function y(t,e){if(1==e||e>3)return t.toString();let i,s="",o=[1e3,900,500,400,100,90,50,40,10,9,5,4,1];i=0==e?["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]:["m","cm","d","cd","c","xc","l","xl","x","ix","v","iv","i"];for(var n=0;n<=o.length;n++)for(;t%o[n]<t;)s+=i[n],t-=o[n];return s}this.setDoNotMove=t=>m=t,this.getDoNotMove=t=>m,this.moveWindow=function(t,e,i,s,o){if(this.getDoNotMove())return console.log("we cannot move"),void console.log("previous is ca we cannot move !");console.log("previous is ca getDoNotMove !",t,e,i,s,o,this.getDoNotMove()),console.log("move to",t,e,"with scale, rotate, delay",i,s,o),h=i,p=s,u=t,c=e,console.log(t,e),setTimeout(()=>{document.querySelector(".scale-container").style.transitionDuration=o+"s",document.querySelector(".rotate-container").style.transitionDuration=o+"s",g.style.transitionDuration=o+"s, "+o+"s",setTimeout(()=>{g.style.left=-(1440*t-720)+"px",g.style.top=-(1080*e-540)+"px",document.querySelector(".scale-container").style.transform="scale("+1/i+")",document.querySelector(".rotate-container").style.transform="rotate("+s+"deg)"},0)},0)},this.moveWindowRelative=function(t,e,i,s,o){this.moveWindow(u+t,c+e,h+i,p+s,o)},this.placeSlip=function(t){let e=parseFloat(t.getAttribute("scale")),i=t.querySelector(".slip-scale-container");e=isNaN(e)?1:e,i.style.transform="scale("+e+")",t.style.width=Math.max(i.offsetWidth,1440)*e+"px",t.style.height=Math.max(i.offsetHeight,1080)*e+"px"},this.placeSlips=function(){let t=function t(i){console.log("debug depth (elem)",i);let s=e(i,"slip-slip");return console.log("debug depth (subslips)",i),1+s.map(t).reduce((t,e)=>Math.max(t,e),0)}(document.body);console.log("debug",t);for(let e=0;e<t;e++)f.forEach(this.placeSlip)},setTimeout(()=>{this.placeSlips()},0),this.placeOpenWindow=function(){s=window.innerHeight,r=window.innerWidth,s/3<r/4?(l=Math.floor(4*s/3),a=s,d.style.left=(window.innerWidth-l)/2+"px",d.style.right=(window.innerWidth-l)/2+"px",d.style.width=l+"px",d.style.top="0",d.style.bottom="0",d.style.height=a+"px"):(a=Math.floor(3*r/4),l=r,d.style.top=(window.innerHeight-a)/2+"px",d.style.bottom=(window.innerHeight-a)/2+"px",d.style.height=a+"px",d.style.right="0",d.style.left="0",d.style.width=l+"px"),document.querySelector(".scale-container").style.transformOrigin="720px 540px",document.querySelector(".rotate-container").style.transformOrigin="720px 540px",document.querySelector(".format-container").style.transform="scale("+l/1440+")",document.querySelector(".cpt-slip").style.right=parseInt(d.style.left)+"px",document.querySelector(".cpt-slip").style.bottom="0",document.querySelector(".cpt-slip").style.zIndex="10"},this.placeOpenWindow(),window.addEventListener("resize",t=>{this.placeOpenWindow(),this.moveWindow(u,c,h,p,0)}),this.countersToString=t=>{let e="";e+=y(t[0]+1,0);for(let i=1;i<t.length;i++)e+="."+y(t[i]+1,i);return e},this.updateCounter=function(){let t=A.map(t=>t.getActionIndex());document.querySelector(".cpt-slip").innerHTML=this.countersToString(t)},this.next=()=>{""==document.querySelector(".toc-slip").innerHTML&&this.showToC();let t=this.getCurrentSlip().next();if(this.updateCounter(),t instanceof n)return this.gotoSlip(t),this.push(t),this.next(),!0;if(!t){this.pop();let t=this.getCurrentSlip();return t.nextStageNeedGoto()&&this.gotoSlip(t),A.length>1||t.getActionIndex()<t.getMaxNext()?this.next():this.gotoSlip(t),!0}return!1},this.nextSlip=function(){for(;!this.next(););},this.previous=t=>{console.log("previous is called with option",t);let e=this.getCurrentSlip(),i=e.previous();if(console.log("debug previous (currentSlip, n)",e,i),i instanceof n){for(;i.getCurrentSubSlip()instanceof n;)this.push(i),i=i.getCurrentSubSlip();return this.push(i),console.log("previous is ca GOTOSLIP FROM 1",t),this.gotoSlip(i,t),this.updateCounter(),!0}if(!i){this.pop();let i=this.getCurrentSlip();return console.log("previous is ca currentDelay, delay",e.currentDelay,e.delay),A.length>1||i.getActionIndex()>-1?this.previous({delay:e.currentDelay?e.currentDelay:e.delay}):(this.gotoSlip(i,t),console.log("previous is ca GOTOSLIP FROM 2",t)),this.updateCounter(),!0}return t&&setTimeout(()=>{this.gotoSlip(e,t)},0),this.updateCounter(),!1},this.previousSlip=function(){for(;!this.previous(););},this.getCoordinateInUniverse=function(t){console.log("debug getcoord elem",t);let e=1,i=function(t){return"none"==t?1:parseFloat(t.split("(")[1].split(",")[0])},s=t=>{console.log("debug getcoorditer elem",t);let o=(t=>({x:t.offsetLeft,y:t.offsetTop}))(t);if(!t.offsetParent)return{x:0,y:0,centerX:0,centerY:0,width:0,height:0,scale:0};if(t.offsetParent.classList.contains("universe"))return console.log("universe",o),o;let n,l=s(t.offsetParent),r=window.getComputedStyle(t.offsetParent);return n=i(r.transform),e*=n,{x:l.x+o.x*e,y:l.y+o.y*e}},o=s(t),n=window.getComputedStyle(t),l=i(n.transform);e*=l,console.log("getCoord",{x:o.x/1440+.5,y:o.y/1080+.5},"globalScale",e,n.transform,l);let r={x:o.x/1440,y:o.y/1080,centerX:o.x/1440+.5*t.offsetWidth/1440*e,centerY:o.y/1080+.5*t.offsetHeight/1080*e,width:t.offsetWidth/1440*e,height:t.offsetHeight/1080*e,scale:e};return console.log(r),r},this.moveToElement=function(t,e){let i=this.getCoordinateInUniverse(t);t.offsetWidth,i.scale,t.offsetHeight,i.scale;e&&this.moveWindow(i.centerX,i.centerY,Math.max(i.width,i.height),0,e.delay?e.delay:1)},this.gotoSlip=function(t,e){console.log("previous is ca goto slip",e,t.element,this.getDoNotMove()),console.log("we goto slip",t.element,this.getDoNotMove()),e=e||{},console.log("options is ",e),"SLIP-SLIP"==t.element.tagName?setTimeout(()=>{let i=t.findSlipCoordinate();void 0!==t.currentX&&void 0!==t.currentY?(console.log("previous is ca ORIGIN 1",t.currentX,t.currentY,this.getDoNotMove(),e),this.moveWindow(t.currentX,t.currentY,i.scale,t.rotate,void 0!==e.delay?e.delay:void 0!==t.currentDelay?t.currentDelay:t.delay)):(t.currentX=i.x,t.currentY=i.y,t.currentDelay=t.delay,console.log("previous is ca ORIGIN 2",i.x,i.y,this.getDoNotMove()),this.moveWindow(i.x,i.y,i.scale,t.rotate,void 0!==e.delay?e.delay:void 0!==t.currentDelay?t.currentDelay:t.delay))},0):setTimeout(()=>{console.log("debug slip element",t.element);let i=this.getCoordinateInUniverse(t.element);this.moveWindow(i.centerX,i.centerY,Math.max(i.width,i.height),0,void 0!==e.delay?e.delay:t.delay)},0)};let v=new n(t,"Presentation",[],this,{}),A=[v];this.push=function(t){A.push(t)},this.pop=function(){let t=A.pop();return 0==A.length&&A.push(t),t},this.getCurrentSlip=function(){return A[A.length-1]},this.getSlipTree=function(t){return(t=t||v)instanceof n?{name:t.name,slip:t,subslips:t.getActionList().map(t=>this.getSlipTree(t))}:{function:!0}},this.goToState=function(t){let e=t=>{if(0!=t.length)for(e(t[0]);t[1].getActionIndex()<t[2];)this.next()};A=[v],v.refreshAll(),e(t),this.gotoSlip(t[1])},this.showToC=function(){console.log("debug showtoc");let t=document.querySelector(".toc-slip"),e=(document.createElement("div"),this.getSlipTree()),i=(t,e)=>{console.log("debug treee",t);let s=document.createElement("div"),o=document.createElement("div");if(o.innerText=t.slip.fullName,s.appendChild(o),t.subslips.length>0){let o=document.createElement("ul");t.subslips.forEach((s,n)=>{let l=[e,t.slip,n],r=document.createElement("li");if(s.function){let t=e=>0==e.length?[]:t(e[0]).concat([e[2]]);r.innerText=this.countersToString(t(l)),r.classList.add("toc-function")}else r.appendChild(i(s,l));r.addEventListener("click",t=>{t.target==r&&(this.goToState(l),console.log("newstack",l))}),o.appendChild(r)}),s.appendChild(o),t.slip.setTocElem(s)}return console.log("debug tree, will return",s),s};t.innerHTML="",t.appendChild(i(e,[]))},this.setRootSlip=t=>{v=t,A=[v]},this.getRootSlip=()=>v,this.start=()=>(A=[v],this.next(),this),this.restart=()=>{A=[v],v.refreshAll(),this.next()};let b=new o(this);this.getController=()=>b},r=o,a=n,u=Object.freeze({__proto__:null,myQueryAll:e,cloneNoSubslip:i,replaceSubslips:s});return t.Controller=r,t.Engine=l,t.Slip=a,t.Util=u,t.startSlipshow=()=>{let t;return"undefined"!=typeof MathJax?MathJax.startup.promise.then(()=>{t=new l(document.querySelector("slip-slipshow")).start()}):t=new l(document.querySelector("slip-slipshow")).start(),t},t}({});
//# sourceMappingURL=slipshow.cdn.min.js.map
