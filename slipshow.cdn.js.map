{"version":3,"file":"slipshow.cdn.js","sources":["../src/modules/slip-figure.mjs","../src/modules/util.mjs","../src/modules/controller.mjs","../node_modules/atrament/src/mouse.js","../node_modules/atrament/src/constants.js","../node_modules/atrament/src/events.js","../node_modules/atrament/src/pixels.js","../node_modules/atrament/src/atrament.js","../node_modules/atrament/index.js","../src/modules/slip.mjs","../src/modules/engine.mjs","../src/slip-lib.js"],"sourcesContent":["class SlipFigure extends HTMLImageElement {\n    // Pour spécifier les attributs qui, changés, appellent \"attributeChangedCallback\"\n    static get observedAttributes() {return ['figure-name']; };\n\n    constructor() {\n\t// Toujours appeler \"super\" d'abord dans le constructeur\n\tsuper();\n\tif (typeof(this.internalStep) == \"undefined\") {\n \t    this.internalStep = 0;   \n\t}\n\tthis.img = [];\n\tthis.maxStep = 0;\n\tthis.figureName = this.getAttribute(\"figure-name\");\n\tthis.promise = this.preloadImages(0).then(() => {\n\t    this.updateSRC();\n\t});\n    }\n    preloadImage(i) {\n\treturn new Promise((resolve, reject) => {\n\t    this.img[i] = new Image();\n\t    this.img[i].onload = () => resolve();\n\t    this.img[i].onerror = reject;\n\t    this.img[i].src = this.getURL(i);\n\t});\n    }\n    preloadImages(i) {\n\treturn new Promise((resolve, reject) => {\n\t    this.preloadImage(i).then(()=> {\n\t\tthis.preloadImages(i+1).then(() => { resolve(); });\n\t    }).catch(() => {\n\t\tthis.maxStep = i-1;\n\t\tresolve();\n\t    });\t    \n\t});\n    }\n    connectedCallback() {\n    }\n\n    getURL(i) {\n\treturn \"figures/\"+this.figureName+\"/\"+this.figureName+\"_\"+i+\".svg\";\n    }\n    updateSRC() {\n\tthis.src = this.getURL(this.figureStep);\n    }\n    \n    set figureStep(step) {\n\tthis.promise = this.promise.then(() => {\n\t    if(step > this.maxStep)\n\t\tthis.internalStep = this.maxStep;\n\t    else if (step < 0)\n\t\tthis.internalStep = 0;\n\t    else\n\t\tthis.internalStep=step;\n\t    this.updateSRC();\n\t});\n    }\n    get figureStep() {\n\treturn this.internalStep;\n    }\n    \n    attributeChangedCallback(name, oldValue, newValue) {\n\tif(name == \"figure-name\") {\n\t    this.figureName = newValue;\n\t    this.promise = this.promise.then(() => {\n\t\tthis.preloadImages(0).then(() => {\n\t\t    this.updateSRC();\n\t\t});\n\t    });\n\t}\n    }\n    nextFigure() {\n\tthis.figuresStep++;\n    }\n}\n\ncustomElements.define('slip-figure', SlipFigure, { extends: \"img\" });\n","export let myQueryAll = (root, selector, avoid) => {\n    avoid = avoid || \"slip-slip\";\n    if (!root.id)\n\troot.id = '_' + Math.random().toString(36).substr(2, 15);;\n    let allElem = Array.from(root.querySelectorAll(selector));\n    let separatedSelector = selector.split(\",\").map(selec => \"#\"+root.id+\" \" + avoid + \" \" + selec).join();\n    // console.log(\"debug myQueryAll\", selector, \"VS\",  separatedSelector);\n    let other = Array.from(root.querySelectorAll(separatedSelector));\n    // let other = Array.from(root.querySelectorAll(\"#\"+root.id+\" \" + avoid + \" \" + separatedSelector));\n    return allElem.filter(value => !other.includes(value));\n};\nwindow.myQueryAll = myQueryAll;\n\nexport function cloneNoSubslip (elem) {\n    let newElem = elem.cloneNode(false);\n    elem.childNodes.forEach((child) => {\n\tif(child.tagName && child.tagName == \"SLIP-SLIP\"){\n\t    let placeholder = document.createElement(child.tagName);\n\t    placeholder.classList.add(\"toReplace\");\n\t    newElem.appendChild(placeholder);\n\t}\n\telse if(child.tagName && child.tagName == \"CANVAS\" && child.classList.contains(\"sketchpad\")){\n\t    let placeholder = document.createElement(child.tagName);\n\t    placeholder.classList.add(\"toReplaceSketchpad\");\n\t    newElem.appendChild(placeholder);\n\t}\n\telse\n\t    newElem.appendChild(cloneNoSubslip(child));\n    });\n    if(newElem.tagName == \"SLIP-SLIP\")\n\tconsole.log(\"debug cloneNosubslip\", newElem);\n    return newElem;\n}\nexport function replaceSubslips(clone, subslips, sketchpad, sketchpadHighlight) {\n    let placeholders = myQueryAll(clone, \".toReplace\");\n    subslips.forEach((subslip, index) => {\n\tplaceholders[index].replaceWith(subslip);\n    });\n    console.log(\"debug cloneNosubslip2\", myQueryAll(clone, \".toReplaceSketchpad\"));\n    let sketchPlaceholder = myQueryAll(clone, \".toReplaceSketchpad\");\n    if(sketchPlaceholder[0])\n\tsketchPlaceholder[0].replaceWith(sketchpad);\n    if(sketchPlaceholder[1])\n\tsketchPlaceholder[1].replaceWith(sketchpadHighlight);\n}\n","// import Hammer from 'hammerjs';\n\nexport default function (ng) {\n    let engine = ng;\n    this.getEngine = () => this.engine;\n    this.setEngine = (ng) => this.engine = ng;\n\n    let activated = true;\n    this.activate = () => {\n\tactivated = true;\n    };\n    this.deactivate = () => {\n\tactivated = false;\n    };\n    \n    let left_keys = [\"k\"],\n\tright_keys = [\"m\"],\n\tup_keys = [\"o\"],\n\tdown_keys = [\"l\"],\n\trotate_keys = [\"i\"],\n\tunrotate_keys = [\"p\"],\n\tzoom_keys = [\"z\"],\n\tunzoom_keys = [\"Z\"],\n\tshow_toc_keys = [\"T\"],\n\tshow_toc2_keys = [\"t\"],\n\tnext_keys = [\"ArrowRight\", \"ArrowDown\"],\n\tprevious_keys = [\"ArrowLeft\", \"ArrowUp\"],\n\trefresh_keys = [\"r\"],\n\tchange_speed_keys = [\"f\"],\n\tup_slip_keys = [],\n\tdraw_on_slip_keys = [\"w\"],\n\terase_on_slip_keys = [\"W\"],\n\thighlight_on_slip_keys = [\"h\"],\n\terase_highlight_on_slip_keys = [\"H\"],\n\tstop_writing_on_slip_keys = [\"x\"],\n\tclear_annotations_keys = [\"X\"],\n\treload_canvas_keys = [\"C\"],\n\tbackground_canvas_keys = [\"#\"];\n\n    // let mainSlip = mainS;\n    // this.getMainSlip = () => mainSlip;\n    // this.setMainSlip = (slip) => mainSlip = slip;\n\n    // let mc = new Hammer(document.body);\n    // mc.on(\"swipe\", (ev) => {\n    // \tif (ev.direction == 2) {\n    // \t    engine.next();\n    // \t}\n    // \tif (ev.direction == 4) {\n    // \t    engine.previous();\n    // \t}\n    // });\n    let speedMove=1;\n    document.addEventListener(\"keypress\", (ev) => {\n\tif(change_speed_keys.includes(ev.key) && activated) { speedMove = (speedMove + 4)%30+1; }    \n\tif(refresh_keys.includes(ev.key) && activated) { engine.getCurrentSlip().refresh(); }    \n\tif(draw_on_slip_keys.includes(ev.key) && activated) { engine.setTool(\"drawing\"); }    \n\tif(erase_on_slip_keys.includes(ev.key) && activated) { engine.setTool(\"drawing-erase\"); }    \n\tif(highlight_on_slip_keys.includes(ev.key) && activated) { engine.setTool(\"highlighting\"); }    \n\tif(erase_highlight_on_slip_keys.includes(ev.key) && activated) { engine.setTool(\"highlighting-erase\"); }\n\tif(stop_writing_on_slip_keys.includes(ev.key) && activated) { engine.setTool(\"no-tool\"); }    \n\tif(clear_annotations_keys.includes(ev.key) && activated) { engine.setTool(\"clear-all\"); }    \n\tif(reload_canvas_keys.includes(ev.key) && activated) { engine.reloadCanvas(); }    \n\tif(background_canvas_keys.includes(ev.key) && activated) {\n\t    document.querySelectorAll(\"slip-slip\").forEach((slip) => {slip.style.zIndex = \"-1\";});\n\t    document.querySelectorAll(\".background-canvas\").forEach((canvas) => {canvas.style.zIndex = \"1\";});\n\t}    \n    });\n    document.addEventListener(\"keydown\", (ev) => {\n\tlet openWindowHeight = engine.getOpenWindowHeight();\n\tlet openWindowWidth = engine.getOpenWindowWidth();\n\tif(down_keys.includes(ev.key) && activated) { engine.moveWindowRelative( 0                          ,  (speedMove)/openWindowHeight, 0, 0, 0.1); }   // Bas\n\tif(up_keys.includes(ev.key) && activated) { engine.moveWindowRelative( 0                          , -(speedMove)/openWindowHeight, 0, 0, 0.1); }  // Haut\n\tif(left_keys.includes(ev.key) && activated) { engine.moveWindowRelative(-(speedMove)/openWindowWidth,  0                           , 0, 0, 0.1); }   // Gauche\n\tif(right_keys.includes(ev.key) && activated) { engine.moveWindowRelative( (speedMove)/openWindowWidth,  0                           , 0, 0, 0.1); }   // Droite\n\tif(rotate_keys.includes(ev.key) && activated) { engine.moveWindowRelative(0, 0,  0   ,  1, 0.1); }                             // Rotate \n\tif(unrotate_keys.includes(ev.key) && activated) { engine.moveWindowRelative(0, 0,  0   , -1, 0.1); }                             // Unrotate\n\tif(zoom_keys.includes(ev.key) && activated) { engine.moveWindowRelative(0, 0,  0.01,  0, 0.1); }                          // Zoom\n\tif(unzoom_keys.includes(ev.key) && activated) { engine.moveWindowRelative(0, 0, -0.01,  0, 0.1); }                          // Unzoom\n\tif(show_toc_keys.includes(ev.key) && activated) {\n\t    engine.showToC();\n\t    // document.querySelector(\".toc-slip\").style.display = document.querySelector(\".toc-slip\").style.display == \"none\" ? \"block\" : \"none\"; \n\t}   \n\tif(show_toc2_keys.includes(ev.key) && activated) {\n\t    // engine.showToC();\n\t    document.querySelector(\".toc-slip\").style.display = document.querySelector(\".toc-slip\").style.display == \"none\" ? \"block\" : \"none\"; \n\t}   \n\tif(next_keys.includes(ev.key) && activated) {\n\t    console.log(ev);\n\t    if(ev.shiftKey)\n\t\tengine.nextSlip();\n\t    else    \n\t\tengine.next();\n\t}\n\telse if (previous_keys.includes(ev.key) && activated) {\n\t    if(ev.shiftKey)\n\t\tengine.previousSlip();\n\t    else    \n\t\tengine.previous();\n\t}\n\telse if (up_slip_keys.includes(ev.key) && activated) {\n\t    engine.pop();\n\t}\n    });    \n};\n","// make a class for Point\nclass Point {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  set(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n}\n\n// make a class for the mouse data\nclass Mouse extends Point {\n  constructor() {\n    super(0, 0);\n    this.down = false;\n    this.previous = new Point(0, 0);\n  }\n}\n\nmodule.exports = { Mouse, Point };\n","const C = {};\nC.floodFillInterval = 100;\nC.maxLineThickness = 50;\nC.minLineThickness = 1;\nC.lineThicknessRange = C.maxLineThickness - C.minLineThickness;\nC.thicknessIncrement = 0.5;\nC.minSmoothingFactor = 0.87;\nC.initialSmoothingFactor = 0.85;\nC.weightSpread = 10;\nC.initialThickness = 2;\n\nmodule.exports = C;\n","class AtramentEventTarget {\n  constructor() {\n    this.eventListeners = new Map();\n  }\n\n  addEventListener(eventName, handler) {\n    const handlers = this.eventListeners.get(eventName) || new Set();\n    handlers.add(handler);\n    this.eventListeners.set(eventName, handlers);\n  }\n\n  removeEventListener(eventName, handler) {\n    const handlers = this.eventListeners.get(eventName);\n    if (!handlers) return;\n    handlers.delete(handler);\n  }\n\n  dispatchEvent(eventName, data) {\n    const handlers = this.eventListeners.get(eventName);\n    if (!handlers) return;\n    [...handlers].forEach(handler => handler(data));\n  }\n}\n\nmodule.exports = { AtramentEventTarget };\n","exports.lineDistance = (x1, y1, x2, y2) => {\n  // calculate euclidean distance between (x1, y1) and (x2, y2)\n  const xs = Math.pow(x2 - x1, 2);\n  const ys = Math.pow(y2 - y1, 2);\n  return Math.sqrt(xs + ys);\n};\n\nexports.hexToRgb = (hexColor) => {\n  // Since input type color provides hex and ImageData accepts RGB need to transform\n  const m = hexColor.match(/^#?([\\da-f]{2})([\\da-f]{2})([\\da-f]{2})$/i);\n  return [\n    parseInt(m[1], 16),\n    parseInt(m[2], 16),\n    parseInt(m[3], 16)\n  ];\n};\n\nexports.matchColor = (data, compR, compG, compB, compA) => (pixelPos) => {\n  // Pixel color equals comp color?\n  const r = data[pixelPos];\n  const g = data[pixelPos + 1];\n  const b = data[pixelPos + 2];\n  const a = data[pixelPos + 3];\n\n  return (r === compR && g === compG && b === compB && a === compA);\n};\n\nexports.colorPixel = (data, fillR, fillG, fillB, startColor, alpha) => {\n  const matcher = exports.matchColor(data, ...startColor);\n\n  return (pixelPos) => {\n    // Update fill color in matrix\n    data[pixelPos] = fillR;\n    data[pixelPos + 1] = fillG;\n    data[pixelPos + 2] = fillB;\n    data[pixelPos + 3] = alpha;\n\n    if (!matcher(pixelPos + 4)) {\n      data[pixelPos + 4] = data[pixelPos + 4] * 0.01 + fillR * 0.99;\n      data[pixelPos + 4 + 1] = data[pixelPos + 4 + 1] * 0.01 + fillG * 0.99;\n      data[pixelPos + 4 + 2] = data[pixelPos + 4 + 2] * 0.01 + fillB * 0.99;\n      data[pixelPos + 4 + 3] = data[pixelPos + 4 + 3] * 0.01 + alpha * 0.99;\n    }\n\n    if (!matcher(pixelPos - 4)) {\n      data[pixelPos - 4] = data[pixelPos - 4] * 0.01 + fillR * 0.99;\n      data[pixelPos - 4 + 1] = data[pixelPos - 4 + 1] * 0.01 + fillG * 0.99;\n      data[pixelPos - 4 + 2] = data[pixelPos - 4 + 2] * 0.01 + fillB * 0.99;\n      data[pixelPos - 4 + 3] = data[pixelPos - 4 + 3] * 0.01 + alpha * 0.99;\n    }\n  };\n};\n","const { Mouse, Point } = require('./mouse.js');\nconst Constants = require('./constants.js');\nconst { AtramentEventTarget } = require('./events.js');\nconst Pixels = require('./pixels.js');\n\nconst DrawingMode = {\n  DRAW: 'draw',\n  ERASE: 'erase',\n  FILL: 'fill',\n  DISABLED: 'disabled'\n};\n\nconst PathDrawingModes = [DrawingMode.DRAW, DrawingMode.ERASE];\n\nmodule.exports = class Atrament extends AtramentEventTarget {\n  constructor(selector, config = {}) {\n    if (typeof window === 'undefined') {\n      throw new Error('Looks like we\\'re not running in a browser');\n    }\n\n    super();\n\n    // get canvas element\n    if (selector instanceof window.Node && selector.tagName === 'CANVAS') this.canvas = selector;\n    else if (typeof selector === 'string') this.canvas = document.querySelector(selector);\n    else throw new Error(`can't look for canvas based on '${selector}'`);\n    if (!this.canvas) throw new Error('canvas not found');\n\n    // set external canvas params\n    this.canvas.width = config.width || this.canvas.width;\n    this.canvas.height = config.height || this.canvas.height;\n\n    // create a mouse object\n    this.mouse = new Mouse();\n\n    // mousemove handler\n    const mouseMove = (event) => {\n      if (event.cancelable) {\n        event.preventDefault();\n      }\n\n      const rect = this.canvas.getBoundingClientRect();\n      const position = event.changedTouches && event.changedTouches[0] || event;\n      let x = position.offsetX;\n      let y = position.offsetY;\n\n      if (typeof x === 'undefined') {\n        x = position.clientX - rect.left;\n      }\n      if (typeof y === 'undefined') {\n        y = position.clientY - rect.top;\n      }\n\n      const { mouse } = this;\n      // draw if we should draw\n      if (mouse.down && PathDrawingModes.includes(this.mode)) {\n        const { x: newX, y: newY } = this.draw(x, y, mouse.previous.x, mouse.previous.y);\n\n        if (!this._dirty && this.mode === DrawingMode.DRAW && (x !== mouse.x || y !== mouse.y)) {\n          this._dirty = true;\n          this.fireDirty();\n        }\n\n        mouse.set(x, y);\n        mouse.previous.set(newX, newY);\n      }\n      else {\n        mouse.set(x, y);\n      }\n    };\n\n    // mousedown handler\n    const mouseDown = (event) => {\n      if (event.cancelable) {\n        event.preventDefault();\n      }\n      // update position just in case\n      mouseMove(event);\n\n      // if we are filling - fill and return\n      if (this.mode === DrawingMode.FILL) {\n        this.fill();\n        return;\n      }\n      // remember it\n      const { mouse } = this;\n      mouse.previous.set(mouse.x, mouse.y);\n      mouse.down = true;\n\n      this.beginStroke(mouse.previous.x, mouse.previous.y);\n    };\n\n    const mouseUp = (e) => {\n      if (this.mode === DrawingMode.FILL) {\n        return;\n      }\n\n      const { mouse } = this;\n\n      if (!mouse.down) {\n        return;\n      }\n\n      const position = e.changedTouches && e.changedTouches[0] || e;\n      const x = position.offsetX;\n      const y = position.offsetY;\n      mouse.down = false;\n\n      if (mouse.x === x && mouse.y === y && PathDrawingModes.includes(this.mode)) {\n        const { x: nx, y: ny } = this.draw(mouse.x, mouse.y, mouse.previous.x, mouse.previous.y);\n        mouse.previous.set(nx, ny);\n      }\n\n      this.endStroke(mouse.x, mouse.y);\n    };\n\n    // attach listeners\n    this.canvas.addEventListener('mousemove', mouseMove);\n    this.canvas.addEventListener('mousedown', mouseDown);\n    document.addEventListener('mouseup', mouseUp);\n    this.canvas.addEventListener('touchstart', mouseDown);\n    this.canvas.addEventListener('touchend', mouseUp);\n    this.canvas.addEventListener('touchmove', mouseMove);\n\n    // helper for destroying Atrament (removing event listeners)\n    this.destroy = () => {\n      this.clear();\n      this.canvas.removeEventListener('mousemove', mouseMove);\n      this.canvas.removeEventListener('mousedown', mouseDown);\n      document.removeEventListener('mouseup', mouseUp);\n      this.canvas.removeEventListener('touchstart', mouseDown);\n      this.canvas.removeEventListener('touchend', mouseUp);\n      this.canvas.removeEventListener('touchmove', mouseMove);\n    };\n\n    // set internal canvas params\n    this.context = this.canvas.getContext('2d');\n    this.context.globalCompositeOperation = 'source-over';\n    this.context.globalAlpha = 1;\n    this.context.strokeStyle = config.color || 'rgba(0,0,0,1)';\n    this.context.lineCap = 'round';\n    this.context.lineJoin = 'round';\n    this.context.translate(0.5, 0.5);\n\n    this._filling = false;\n    this._fillStack = [];\n\n    // set drawing params\n    this.recordStrokes = false;\n    this.strokeMemory = [];\n\n    this.smoothing = Constants.initialSmoothingFactor;\n    this._thickness = Constants.initialThickness;\n    this._targetThickness = this._thickness;\n    this._weight = this._thickness;\n    this._maxWeight = this._thickness + Constants.weightSpread;\n\n    this._mode = DrawingMode.DRAW;\n    this.adaptiveStroke = true;\n\n    // update from config object\n    ['weight', 'smoothing', 'adaptiveStroke', 'mode']\n      .forEach(key => config[key] === undefined ? 0 : this[key] = config[key]);\n  }\n\n  /**\n   * Begins a stroke at a given position\n   *\n   * @param {number} x\n   * @param {number} y\n   */\n  beginStroke(x, y) {\n    this.context.beginPath();\n    this.context.moveTo(x, y);\n\n    if (this.recordStrokes) {\n      this.strokeMemory.push(new Point(x, y));\n    }\n    this.dispatchEvent('strokestart', { x, y });\n  }\n\n  /**\n   * Ends a stroke at a given position\n   *\n   * @param {number} x\n   * @param {number} y\n   */\n  endStroke(x, y) {\n    this.context.closePath();\n\n    if (this.recordStrokes) {\n      this.strokeMemory.push(new Point(x, y));\n    }\n    this.dispatchEvent('strokeend', { x, y });\n\n    if (this.recordStrokes) {\n      const stroke = {\n        points: this.strokeMemory.slice(),\n        mode: this.mode,\n        weight: this.weight,\n        smoothing: this.smoothing,\n        color: this.color,\n        adaptiveStroke: this.adaptiveStroke\n      };\n\n      this.dispatchEvent('strokerecorded', { stroke });\n    }\n    this.strokeMemory = [];\n  }\n\n  /**\n   * Draws a smooth quadratic curve with adaptive stroke thickness\n   * between two points\n   *\n   * @param {number} x current X coordinate\n   * @param {number} y current Y coordinate\n   * @param {number} prevX previous X coordinate\n   * @param {number} prevY previous Y coordinate\n   */\n  draw(x, y, prevX, prevY) {\n    if (this.recordStrokes) {\n      this.strokeMemory.push(new Point(x, y));\n    }\n\n    const { context } = this;\n    // calculate distance from previous point\n    const rawDist = Pixels.lineDistance(x, y, prevX, prevY);\n\n    // now, here we scale the initial smoothing factor by the raw distance\n    // this means that when the mouse moves fast, there is more smoothing\n    // and when we're drawing small detailed stuff, we have more control\n    // also we hard clip at 1\n    const smoothingFactor = Math.min(Constants.minSmoothingFactor, this.smoothing + (rawDist - 60) / 3000);\n\n    // calculate processed coordinates\n    const procX = x - (x - prevX) * smoothingFactor;\n    const procY = y - (y - prevY) * smoothingFactor;\n\n    // recalculate distance from previous point, this time relative to the smoothed coords\n    const dist = Pixels.lineDistance(procX, procY, prevX, prevY);\n\n    if (this.adaptiveStroke) {\n      // calculate target thickness based on the new distance\n      this._targetThickness = (dist - Constants.minLineThickness)\n        / Constants.lineThicknessRange * (this._maxWeight - this._weight) + this._weight;\n      // approach the target gradually\n      if (this._thickness > this._targetThickness) {\n        this._thickness -= Constants.thicknessIncrement;\n      }\n      else if (this._thickness < this._targetThickness) {\n        this._thickness += Constants.thicknessIncrement;\n      }\n      // set line width\n      context.lineWidth = this._thickness;\n    }\n    else {\n      // line width is equal to default weight\n      context.lineWidth = this._weight;\n    }\n\n    // draw using quad interpolation\n    context.quadraticCurveTo(prevX, prevY, procX, procY);\n    context.stroke();\n\n    return { x: procX, y: procY };\n  }\n\n  get color() {\n    return this.context.strokeStyle;\n  }\n\n  set color(c) {\n    if (typeof c !== 'string') throw new Error('wrong argument type');\n    this.context.strokeStyle = c;\n  }\n\n  get weight() {\n    return this._weight;\n  }\n\n  set weight(w) {\n    if (typeof w !== 'number') throw new Error('wrong argument type');\n    this._weight = w;\n    this._thickness = w;\n    this._targetThickness = w;\n    this._maxWeight = w + Constants.weightSpread;\n  }\n\n  get mode() {\n    return this._mode;\n  }\n\n  set mode(m) {\n    if (typeof m !== 'string') throw new Error('wrong argument type');\n    switch (m) {\n      case DrawingMode.ERASE:\n        this._mode = DrawingMode.ERASE;\n        this.context.globalCompositeOperation = 'destination-out';\n        break;\n      case DrawingMode.FILL:\n        this._mode = DrawingMode.FILL;\n        this.context.globalCompositeOperation = 'source-over';\n        break;\n      case DrawingMode.DISABLED:\n        this._mode = DrawingMode.DISABLED;\n        break;\n      default:\n        this._mode = DrawingMode.DRAW;\n        this.context.globalCompositeOperation = 'source-over';\n        break;\n    }\n  }\n\n  isDirty() {\n    return !!this._dirty;\n  }\n\n  fireDirty() {\n    this.dispatchEvent('dirty');\n  }\n\n  clear() {\n    if (!this.isDirty) {\n      return;\n    }\n\n    this._dirty = false;\n    this.dispatchEvent('clean');\n\n    // make sure we're in the right compositing mode, and erase everything\n    if (this.mode === DrawingMode.ERASE) {\n      this.mode = DrawingMode.DRAW;\n      this.context.clearRect(-10, -10, this.canvas.width + 20, this.canvas.height + 20);\n      this.mode = DrawingMode.ERASE;\n    }\n    else {\n      this.context.clearRect(-10, -10, this.canvas.width + 20, this.canvas.height + 20);\n    }\n  }\n\n  toImage() {\n    return this.canvas.toDataURL();\n  }\n\n  fill() {\n    const { mouse } = this;\n    const { context } = this;\n    // converting to Array because Safari 9\n    const startColor = Array.from(context.getImageData(mouse.x, mouse.y, 1, 1).data);\n\n    if (!this._filling) {\n      const { x, y } = mouse;\n      this.dispatchEvent('fillstart', { x, y });\n      this._filling = true;\n      setTimeout(() => { this._floodFill(mouse.x, mouse.y, startColor); }, Constants.floodFillInterval);\n    }\n    else {\n      this._fillStack.push([\n        mouse.x,\n        mouse.y,\n        startColor\n      ]);\n    }\n  }\n\n  _floodFill(_startX, _startY, startColor) {\n    const { context } = this;\n    const startX = Math.floor(_startX);\n    const startY = Math.floor(_startY);\n    const canvasWidth = context.canvas.width;\n    const canvasHeight = context.canvas.height;\n    const pixelStack = [[startX, startY]];\n    // hex needs to be trasformed to rgb since colorLayer accepts RGB\n    const fillColor = Pixels.hexToRgb(this.color);\n    // Need to save current context with colors, we will update it\n    const colorLayer = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n    const alpha = Math.min(context.globalAlpha * 10 * 255, 255);\n    const colorPixel = Pixels.colorPixel(colorLayer.data, ...fillColor, startColor, alpha);\n    const matchColor = Pixels.matchColor(colorLayer.data, ...startColor);\n    const matchFillColor = Pixels.matchColor(colorLayer.data, ...[...fillColor, 255]);\n\n    // check if we're trying to fill with the same colour, if so, stop\n    if (matchFillColor((startY * context.canvas.width + startX) * 4)) {\n      this._filling = false;\n      this.dispatchEvent('fillend', {});\n      return;\n    }\n\n    while (pixelStack.length) {\n      const newPos = pixelStack.pop();\n      const x = newPos[0];\n      let y = newPos[1];\n\n      let pixelPos = (y * canvasWidth + x) * 4;\n\n      while (y-- >= 0 && matchColor(pixelPos)) {\n        pixelPos -= canvasWidth * 4;\n      }\n      pixelPos += canvasWidth * 4;\n\n      ++y;\n\n      let reachLeft = false;\n      let reachRight = false;\n\n      while (y++ < canvasHeight - 1 && matchColor(pixelPos)) {\n        colorPixel(pixelPos);\n\n        if (x > 0) {\n          if (matchColor(pixelPos - 4)) {\n            if (!reachLeft) {\n              pixelStack.push([x - 1, y]);\n              reachLeft = true;\n            }\n          }\n          else if (reachLeft) {\n            reachLeft = false;\n          }\n        }\n\n        if (x < canvasWidth - 1) {\n          if (matchColor(pixelPos + 4)) {\n            if (!reachRight) {\n              pixelStack.push([x + 1, y]);\n              reachRight = true;\n            }\n          }\n          else if (reachRight) {\n            reachRight = false;\n          }\n        }\n\n        pixelPos += canvasWidth * 4;\n      }\n    }\n\n    // Update context with filled bucket!\n    context.putImageData(colorLayer, 0, 0);\n\n    if (this._fillStack.length) {\n      this._floodFill(...this._fillStack.shift());\n    }\n    else {\n      this._filling = false;\n      this.dispatchEvent('fillend', {});\n    }\n  }\n};\n","module.exports = require('./src/atrament.js');\n","import { cloneNoSubslip, myQueryAll, replaceSubslips } from './util';\nimport Atrament from 'atrament';\nexport default function Slip(name, fullName, actionL, ng, options) {\n\n    // ******************************\n    // Action List\n    // ******************************\n\n    this.generateActionList = function() {\n\tconsole.log(\"debug generateactionlist\", this.name);\n\tlet newActionList = [];\n\tthis.queryAll(\"slip-slip[enter-at]\").forEach((slip) => {\n\t    console.log(\"new slip with \", slip, null, null, ng, {});\n\t    newActionList[slip.getAttribute(\"enter-at\")] = new Slip(slip, \"\", [], ng, {});\n\t});\n\treturn newActionList;\n    };\n    this.addSubSlips = function() {\n\tconsole.log(\"debug generateactionlist\", this.name);\n\tlet newActionList = [];\n\tthis.queryAll(\"slip-slip[enter-at]\").forEach((slip) => {\n\t    console.log(\"new slip with \", slip, null, null, ng, {});\n\t    this.setNthAction(slip.getAttribute(\"enter-at\"), new Slip(slip, \"\", [], ng, {}));\n\t});\n\treturn newActionList;\n    };\n    let actionList = actionL;// || this.generateActionList();\n    this.setAction = (actionL) => {actionList = actionL;};\n    this.getActionList = () => {\n\tlet ret = [];\n\tfor(let i = 0;i <= this.getMaxNext(); i++) {\n\t    if(this.pauseSlipList[i] instanceof Slip)\n\t\tret[i] = this.pauseSlipList[i];\n\t    else if(typeof actionList[i] == \"function\" || actionList[i] instanceof Slip)\n\t\tret[i] = actionList[i];\n\t    else\n\t\tret[i] = () => {};\n\t}\n\treturn ret;\n    };\n    this.setNthAction = (n,action) => {actionList[n] = action;};\n    this.getCurrentSubSlip = () => {\n\tif(actionList[this.getActionIndex()] instanceof Slip)\n\t    return actionList[this.getActionIndex()];\n\tif(this.pauseSlipList[this.getActionIndex()] instanceof Slip)\n\t    return this.pauseSlipList[this.getActionIndex()];\n\treturn false;\n    };\n    this.nextStageNeedGoto = () => {\n\tif(actionList[this.getActionIndex()+1] instanceof Slip)\n\t    return false;\n\tif(this.pauseSlipList[this.getActionIndex()+1] instanceof Slip)\n\t    return false;\n\tif(this.getActionIndex() >= this.getMaxNext())\n\t    return false;\n\treturn true;\n    };\n    this.getSubSlipList = function () {\n\treturn this.getActionList().filter((action) => action instanceof Slip);\n    };\n\n    // ******************************\n    // Action Index\n    // ******************************\n    let actionIndex = -1;\n    this.setActionIndex = (actionI) => actionIndex = actionI;\n    this.getActionIndex = () => actionIndex;\n    this.getMaxNext = () => {\n\tif(this.maxNext)\n\t    return this.maxNext;\n\tlet maxTemp = actionList.length;\n\t[\"mk-visible-at\",\n\t \"mk-hidden-at\",\n\t \"mk-emphasize-at\",\n\t \"mk-unemphasize-at\",\n\t \"emphasize-at\",\n\t \"chg-visib-at\",\n\t \"up-at\",\n\t \"down-at\",\n\t \"center-at\",\n\t \"static-at\",\n\t \"exec-at\",\n\t \"enter-at\",\n\t \"focus-at\",\n\t \"unfocus-at\",\n\t \"figure-next-at\",\n\t \"figure-previous-at\",\n\t].forEach((attr) => {\n\t    this.queryAll(\"*[\"+attr+\"]\").forEach((elem) => {\n\t\telem.getAttribute(attr).split(\" \").forEach((strMax) => {\n\t\t    maxTemp = Math.max(Math.abs(parseInt(strMax)),maxTemp);\n\t\t});\n\t    });\n\t});\n\tlet sumArray = this.queryAll(\"[pause], [step], [auto-enter], [immediate-enter]\").map((elem) => {\n\t    if(elem.hasAttribute(\"pause\") && elem.getAttribute(\"pause\") != \"\")\n\t\treturn parseInt(elem.getAttribute(\"pause\"));\n\t    if(elem.hasAttribute(\"step\") && elem.getAttribute(\"step\") != \"\")\n\t\treturn parseInt(elem.getAttribute(\"step\"));\n\t    return 1; });\n\tmaxTemp = Math.max(maxTemp, sumArray.reduce((a,b) => a+b, 0));\n\tthis.maxNext = maxTemp;\n\treturn maxTemp;\t\n    };\n    \n    // ******************************\n    // Queries\n    // ******************************\n    this.queryAll = (quer) => {\n\treturn myQueryAll(this.element, quer);\n\t// let allElem = Array.from(this.element.querySelectorAll(quer));\n\t// let other = Array.from(this.element.querySelectorAll(\"#\"+this.name+\" slip \"+quer));\n\t// return allElem.filter(value => !other.includes(value));\n    };\n    this.query = (quer) => {\n\tif(typeof quer != \"string\") return quer;\n\treturn this.queryAll(quer)[0];\n    };\n    this.findSubslipByID = (id) => {\n\tlet goodSubslip = this.getSubSlipList().find((subslip) => {\n\t    if(subslip.name == id)\n\t\treturn 1;\n\t    return subslip.findSubslipByID(id);\n\t});\n\tif(!goodSubslip)\n\t    return false;\n\tif (goodSubslip.name == id) \n\t    return goodSubslip;\n\treturn goodSubslip.findSubslipByID(id);\n    };\n    \n    // ******************************\n    // Coordinates\n    // ******************************\n    this.findSlipCoordinate = () => { // rename to getCoordInUniverse\n\tlet coord = engine.getCoordinateInUniverse(this.element);\n\tconsole.log(\"debug findslipcoordinate\", coord);\n\tcoord.scale *= this.scale;\n\tcoord.y = coord.y + 0.5*coord.scale;\n\tcoord.x = coord.centerX;\n\tconsole.log(\"debug findslipcoordinate\", coord);\n\treturn coord;\n    };\n\n\n    // ******************************\n    // Pause functions\n    // ******************************\n    this.updatePauseAncestors = () => {\n\tthis.queryAll(\".pauseAncestor\").forEach((elem) => {elem.classList.remove(\"pauseAncestor\");});\n\tlet pause = this.query(\"[pause]\");\n\twhile(pause && pause.tagName != \"SLIP-SLIP\") {\n\t    pause.classList.add(\"pauseAncestor\");\n\t    pause = pause.parentElement;\n\t};\n    };\n    this.unpause = (pause) => {\n\tif(pause.hasAttribute(\"static-at-unpause\")) {\n\t    if(pause.getAttribute(\"static-at-unpause\") == \"\")\n\t\tthis.makeStatic(pause);\n\t    else\n\t\tpause.getAttribute(\"static-at-unpause\").split(\" \").map((strID) => {\n\t\t    this.makeStatic(\"#\"+strID);\n\t\t});\n\t}\n\tif(pause.hasAttribute(\"unstatic-at-unpause\")) {\n\t    if(pause.getAttribute(\"unstatic-at-unpause\") == \"\")\n\t\tthis.makeUnStatic(pause);\n\t    else\n\t\tpause.getAttribute(\"unstatic-at-unpause\").split(\" \").map((strID) => {\n\t\t    this.makeUnStatic(\"#\"+strID);\n\t\t});\n\t}\n\tif(pause.hasAttribute(\"down-at-unpause\")) {\n\t    if(pause.getAttribute(\"down-at-unpause\") == \"\")\n\t\tthis.moveDownTo(pause, 1);\n\t    else\n\t\tthis.moveDownTo(\"#\"+pause.getAttribute(\"down-at-unpause\"), 1);\t\t\t\n\t}\n\tif(pause.hasAttribute(\"up-at-unpause\")) {\n\t    if(pause.getAttribute(\"up-at-unpause\") == \"\")\n\t\tthis.moveUpTo(pause, 1);\n\t    else\n\t\tthis.moveUpTo(\"#\"+pause.getAttribute(\"up-at-unpause\"), 1);\n\t}\n\tif(pause.hasAttribute(\"center-at-unpause\")) {\n\t    if(pause.getAttribute(\"center-at-unpause\") == \"\")\n\t\tthis.moveCenterTo(pause, 1);\n\t    else\n\t\tthis.moveCenterTo(\"#\"+pause.getAttribute(\"center-at-unpause\"), 1);\n\t}\n\tif(pause.hasAttribute(\"exec-at-unpause\")) {\n\t    if(pause.getAttribute(\"exec-at-unpause\") == \"\")\n\t\tthis.executeScript(pause);\n\t    else\n\t\tpause.getAttribute(\"exec-at-unpause\").split(\" \").map((strID) => {\n\t\t    this.executeScript(\"#\"+strID);\t\n\t\t});\n\t}\n\tif(pause.hasAttribute(\"reveal-at-unpause\")) {\n\t    if(pause.getAttribute(\"reveal-at-unpause\") == \"\")\n\t\tthis.reveal(pause);\n\t    else\n\t\tpause.getAttribute(\"reveal-at-unpause\").split(\" \").map((strID) => {\n\t\t    this.reveal(\"#\"+strID);\n\t\t});\n\t}\n\tif(pause.hasAttribute(\"hide-at-unpause\")) {\n\t    if(pause.getAttribute(\"hide-at-unpause\") == \"\")\n\t\tthis.hide(pause);\n\t    else\n\t\tpause.getAttribute(\"hide-at-unpause\").split(\" \").map((strID) => {\n\t\t    this.hide(\"#\"+strID);\n\t\t});\n\t}\n\tif(pause.hasAttribute(\"figure-set-at-unpause\")) {\n\t    let [figureID, figureStep] = pause.getAttribute(\"figure-set-at-unpause\").split(\" \");\n\t    this.query(\"#\"+figureID).figureStep = figureStep;\n\t}\n\tif(pause.hasAttribute(\"figure-next-at-unpause\")) {\n\t    pause.getAttribute(\"figure-next-at-unpause\").split(\" \").map((figureID) => {\n\t\tthis.query(\"#\"+figureID).figureStep++;\n\t    });\n\t}\n\tif(pause.hasAttribute(\"figure-previous-at-unpause\")) {\n\t    pause.getAttribute(\"figure-previous-at-unpause\").split(\" \").map((figureID) => {\n\t\tthis.query(\"#\"+figureID).figureStep--;\n\t    });\n\t}\n\tif(pause.hasAttribute(\"focus-at-unpause\")) {\n\t    if(pause.getAttribute(\"focus-at-unpause\") == \"\")\n\t\tthis.focus(pause);\n\t    else\n\t\tthis.focus(\"#\"+pause.getAttribute(\"focus-at-unpause\"));\n\t}\n\tif(pause.hasAttribute(\"unfocus-at-unpause\")){\n\t    if(pause.getAttribute(\"unfocus-at-unpause\") == \"\")\n\t\tthis.unfocus(pause);\n\t    else\n\t\tthis.unfocus(\"#\"+pause.getAttribute(\"unfocus-at-unpause\"));\n\t}\n    };\n    this.incrPause = () => {\n\tlet pause = this.query(\"[pause], [auto-enter]:not([auto-enter=\\\"0\\\"]), [immediate-enter]:not([immediate-enter=\\\"0\\\"]), [step]\");\n\t// let pause = this.query(\"[pause]\");\n\tif(pause) {\n\t    console.log(\"pause is\", this.name, pause);\n\t    if(pause.hasAttribute(\"step\")) {\n\t\tif(!pause.getAttribute(\"step\")) \n\t\t    pause.setAttribute(\"step\", 1);\n\t\tlet d = pause.getAttribute(\"step\");\n\t\tif (d <= 1){\n\t\t    pause.removeAttribute(\"step\");\n\t\t    this.unpause(pause);\n\t\t} else\n\t\t    pause.setAttribute(\"step\", d-1);\n\t    }\n\t    if(pause.hasAttribute(\"auto-enter\")) {\n\t\tpause.setAttribute(\"auto-enter\", 0);\n\t\tthis.unpause(pause);\n\t    }\n\t    if(pause.hasAttribute(\"immediate-enter\")) {\n\t\tpause.setAttribute(\"immediate-enter\", 0);\n\t\tthis.unpause(pause);\n\t    }\n\t    if(pause.hasAttribute(\"pause\")) {\n\t\tif(!pause.getAttribute(\"pause\")) \n\t\t    pause.setAttribute(\"pause\", 1);\n\t\tlet d = pause.getAttribute(\"pause\");\n\t\tif (d <= 1){\n\t\t    pause.removeAttribute(\"pause\");\n\t\t    this.unpause(pause);\n\t\t} else\n\t\t    pause.setAttribute(\"pause\", d-1);\n\t\tthis.updatePauseAncestors();\n\t    }\n\t}\n    };\n\n    // ******************************\n    // Next functions\n    // ******************************\n    this.doAttributes = () => {\n\tthis.queryAll(\"*[mk-hidden-at]\").forEach((elem) => {\n\t    let hiddenAt = elem.getAttribute(\"mk-hidden-at\").split(\" \").map((str) => parseInt(str));\n\t    if(hiddenAt.includes(actionIndex))\n\t\telem.style.opacity = \"0\";});\t\n\tthis.queryAll(\"*[mk-visible-at]\").forEach((elem) => {\n\t    let visibleAt = elem.getAttribute(\"mk-visible-at\").split(\" \").map((str) => parseInt(str));\n\t    if(visibleAt.includes(actionIndex))\n\t\telem.style.opacity = \"1\";});\t\n\tthis.queryAll(\"*[mk-emphasize-at]\").forEach((elem) => {\n\t    let emphAt = elem.getAttribute(\"mk-emphasize-at\").split(\" \").map((str) => parseInt(str));\n\t    if(emphAt.includes(actionIndex))\n\t\telem.classList.add(\"emphasize\");});\t\n\tthis.queryAll(\"*[mk-unemphasize-at]\").forEach((elem) => {\n\t    let unemphAt = elem.getAttribute(\"mk-unemphasize-at\").split(\" \").map((str) => parseInt(str));\n\t    if(unemphAt.includes(actionIndex))\n\t\telem.classList.remove(\"emphasize\");});\t\n\tthis.queryAll(\"*[emphasize-at]\").forEach((elem) => {\n\t    let emphAt = elem.getAttribute(\"emphasize-at\").split(\" \").map((str) => parseInt(str));\n\t    if(emphAt.includes(actionIndex))\n\t\telem.classList.add(\"emphasize\");\n\t    else\n\t\telem.classList.remove(\"emphasize\");\n\t});\t\n\tthis.queryAll(\"*[chg-visib-at]\").forEach((elem) => {\n\t    let visibAt = elem.getAttribute(\"chg-visib-at\").split(\" \").map((str) => parseInt(str));\n\t    if(visibAt.includes(actionIndex))\n\t\telem.style.opacity = \"1\";\n\t    if(visibAt.includes(-actionIndex))\n\t\telem.style.opacity = \"0\";\n\t});\t\n\tthis.queryAll(\"*[static-at]\").forEach((elem) => {\n\t    let staticAt = elem.getAttribute(\"static-at\").split(\" \").map((str) => parseInt(str));\n\t    if(actionIndex < 0) return;\n\t    if(staticAt.includes(-actionIndex)){\n\t\tconsole.log(\"make unstatic actionIndex elem\", actionIndex, elem);\n\t\tthis.makeUnStatic(elem);\n\t\t// elem.style.position = \"absolute\";\n\t\t// elem.style.visibility = \"hidden\";\n\t    }\n\t    else if(staticAt.includes(actionIndex)) {\n\t\tthis.makeStatic(elem);\n\t\t// elem.style.position = \"static\";\n\t\t// elem.style.visibility = \"visible\";\n\t    }\n\t});\t    \n\tthis.queryAll(\"*[down-at]\").forEach((elem) => {\n\t    let goDownTo = elem.getAttribute(\"down-at\").split(\" \").map((str) => parseInt(str));\n\t    if(goDownTo.includes(actionIndex))\n\t\tthis.moveDownTo(elem, 1);\n\t});\n\tthis.queryAll(\"*[up-at]\").forEach((elem) => {\n\t    let goTo = elem.getAttribute(\"up-at\").split(\" \").map((str) => parseInt(str));\n\t    if(goTo.includes(actionIndex))\n\t\tthis.moveUpTo(elem, 1);});\n\tthis.queryAll(\"*[center-at]\").forEach((elem) => {\n\t    let goDownTo = elem.getAttribute(\"center-at\").split(\" \").map((str) => parseInt(str));\n\t    if(goDownTo.includes(actionIndex))\n\t\tthis.moveCenterTo(elem, 1);});\t\n\tthis.queryAll(\"*[focus-at]\").forEach((elem) => {\n\t    let focus = elem.getAttribute(\"focus-at\").split(\" \").map((str) => parseInt(str));\n\t    if(focus.includes(actionIndex))\n\t\tthis.focus(elem, 1);});\t\n\tthis.queryAll(\"*[unfocus-at]\").forEach((elem) => {\n\t    let focus = elem.getAttribute(\"unfocus-at\").split(\" \").map((str) => parseInt(str));\n\t    if(focus.includes(actionIndex))\n\t\tthis.unfocus(elem, 1);});\t\n\tthis.queryAll(\"*[exec-at]\").forEach((elem) => {\n\t    let toExec = elem.getAttribute(\"exec-at\").split(\" \").map((str) => parseInt(str));\n\t    if(toExec.includes(actionIndex))\n\t\tthis.executeScript(elem);});\t\n\tthis.queryAll(\"*[figure-next-at]\").forEach((elem) => {\n\t    let toFigureNext = elem.getAttribute(\"figure-next-at\").split(\" \").map((str) => parseInt(str));\n\t    if(toFigureNext.includes(actionIndex))\n\t\telem.figureStep++;});\t\n\tthis.queryAll(\"*[figure-previous-at]\").forEach((elem) => {\n\t    let toFigureNext = elem.getAttribute(\"figure-previous-at\").split(\" \").map((str) => parseInt(str));\n\t    if(toFigureNext.includes(actionIndex))\n\t\telem.figureStep--;});\t\n    };\n    this.incrIndex = () => {\n\tconsole.log(\"incrIndex\", this.name);\n\tactionIndex = actionIndex+1;\n\tthis.doAttributes();\n\tif(actionIndex>0)\n\t    this.incrPause();\n\tthis.updateToC();\n    };\n    this.next = function () {\n\tif(actionIndex >= this.getMaxNext())\n\t    return false;\n\tthis.incrIndex();\n\tif(typeof actionList[actionIndex] == \"function\") {\n\t    actionList[actionIndex](this);\n\t}\n\tif(actionList[actionIndex] instanceof Slip){\n\t    return actionList[actionIndex];\n\t}\n\tif(this.pauseSlipList[actionIndex] instanceof Slip)\n\t    return this.pauseSlipList[actionIndex];\n\t// let nextSlip = this.query(\"[pause], [auto-enter]\");\n\t// if(nextSlip.hasAttribute(\"auto-enter\"))\n\t//     return \n\treturn true;\n    };\n    this.previous = () => {\n\tlet savedActionIndex = this.getActionIndex();\n\tlet savedDelay = this.currentDelay;\n\tthis.getEngine().setDoNotMove(true);\n\tlet savedClass = this.element.className;\n\tlet r = this.doRefresh();\n\tthis.element.className = savedClass;\n\tconsole.log(\"gotoslip: we call doRefresh\",r);\n\tif(savedActionIndex == -1)\n\t    return false;\n \tlet toReturn;\n\twhile(this.getActionIndex()<savedActionIndex-1){\n\t    console.log(\"previous is ca we do next\", this.getEngine().getDoNotMove());\n\t    console.log(\"(figure) actionIndex is\", actionIndex);\n\t    toReturn = this.next();\n\t}\n\t// if(!this.nextStageNeedGoto())\n\t//     this.getEngine().setDoNotMove(false);\n\t// while(this.getActionIndex()<savedActionIndex-1)\n\t//     toReturn = this.next();\n\tsetTimeout(() => {this.getEngine().setDoNotMove(false);},0);\n\tthis.getEngine().gotoSlip(this, {delay:savedDelay});\n\treturn toReturn;\n\n\t// return this.next;\n    };\n\n    // ******************************\n    // ToC functions\n    // ******************************\n    this.setTocElem = (tocElem) => {this.tocElem = tocElem;};\n    this.updateToC = () => {\n\tif(!this.tocElem)\n\t    return;\n\tif(!this.ToCList)\n\t    this.ToCList = myQueryAll(this.tocElem, \"li\", \"li\");\n\tlet i;\n\tfor(i=0;i<this.getActionIndex(); i++) {\n\t    this.ToCList[i].classList.remove(\"before\", \"after\", \"current\");\n\t    this.ToCList[i].classList.add(\"before\");\t    \n\t}\n\tif(i<=this.getActionIndex()) {\n\t    this.ToCList[i].classList.remove(\"before\", \"after\", \"current\");\n\t    this.ToCList[i].classList.add(\"current\");\n\t    i++;\n\t}\n\tfor(i;i<=this.getMaxNext(); i++) {\n\t    this.ToCList[i].classList.remove(\"before\", \"after\", \"current\");\n\t    this.ToCList[i].classList.add(\"after\");\n\t}\t\n    };\n    this.firstVisit = () => {\n\tthis.updateToC();\n\tif(options.firstVisit)\n\t    options.firstVisit(this);\n    };\n    this.init = () => {\n\tthis.queryAll(\"*[chg-visib-at]\").forEach((elem) => {\n\t    elem.style.opacity = \"0\";\n\t});\t\n\t// this.queryAll(\"*[static-at]\").forEach((elem) => {\n\t//     elem.style.position = \"absolute\";\n\t//     elem.style.visibility = \"hidden\";\n\t// });\t\n//\tthis.doAttributes();\n\tthis.updatePauseAncestors();\n\tif(options.init)\n\t    options.init(this);\n    };\n\n    // ******************************\n    // Refreshes\n    // ******************************\n    this.refresh = () => {\n\tif(actionList[actionIndex] instanceof Slip)\n\t    actionList[actionIndex].refresh();\n\telse\n\t    this.doRefresh();\n    };\n    this.refreshAll = () => {\n\tactionList.filter((elem) => elem instanceof Slip).forEach((subslip) => { subslip.refreshAll();});\n\tthis.pauseSlipList.filter((elem) => elem instanceof Slip).forEach((subslip) => { subslip.refreshAll();});\n\tthis.doRefresh();\n    };\n    this.doRefresh = () => {\n\tconsole.log(\"to Atrament debug\",this.element);\n\tconsole.log(\"gotoslip: doRefresh has been called\");\n\tthis.setActionIndex(-1);\n\tlet subSlipList = myQueryAll(this.element, \"slip-slip\");\n\tconsole.log(\"mmdebug\", clonedElement);\n\tconsole.log(\"to Atrament debug clonedElement\",clonedElement);\n\tlet clone = clonedElement.cloneNode(true);\n\treplaceSubslips(clone, subSlipList, this.sketchpadCanvas, this.sketchpadCanvasHighlight);\n\tthis.element.replaceWith(clone);\n\tthis.element = clone;\n\tthis.init();\n\tthis.firstVisit();\n\tdelete(this.currentX);\n\tdelete(this.currentY);\n\tdelete(this.currentDelay);\n\tconsole.log(\"previous is ca GOTOSLIP FROM 3\", options, this.getEngine().getDoNotMove());\n\tthis.getEngine().gotoSlip(this);\n    };\n\n    // ******************************\n    // Movement, execution and hide/show\n    // ******************************\n    this.makeUnStatic = (selector, delay, opacity) => {\n\tlet elem = this.query(selector);\n\t// setTimeout(() => {\n\t//     elem.style.overflow = \"hidden\"; \n\t//     setTimeout(() => {\n\t// \telem.style.transition = \"height \"+ (typeof(delay) == \"undefined\" ? \"1s\" : (delay+\"s\"));\n\t// \tif(opacity)\n\t// \t    elem.style.transition += \", opacity \"+ (typeof(delay) == \"undefined\" ? \"1s\" : (delay+\"s\"));\n\t// \telem.style.height = (elem.offsetHeight+\"px\");\n\t// \tif(opacity)\n\t// \t    elem.style.opacity = \"1\";\n\t// \tsetTimeout(() => {\n\t// \t    if(opacity)\n\t// \t    \telem.style.opacity = \"0\"; \n\t// \t    elem.style.height = (\"0px\");}, 10);\n\t//     }, 0);\n\t// },0);\n\telem.style.position = \"absolute\";\n\telem.style.visibility = \"hidden\";\n    };\n    this.makeStatic = (selector) => {\n\tlet elem = this.query(selector);\n\telem.style.position = \"static\";\n\telem.style.visibility = \"visible\";\n    };\n    this.unfocus = (selector) => {\n\tthis.getEngine().gotoSlip(this, { delay: 1});\n    };\n    this.focus = (selector) => {\n\tlet elem = this.query(selector);\n\tthis.getEngine().moveToElement(elem, {});\n    };\n\n    this.executeScript = (selector) => {\n\tlet elem;\n\tif(typeof selector == \"string\") elem = this.query(selector);\n\telse elem = selector;\n\t(new Function(\"slip\",elem.innerHTML))(this);\n    };\n    this.moveUpTo = (selector, delay,  offset) => {\n\tsetTimeout(() => {\n\t    let elem;\n\t    if(typeof selector == \"string\") elem = this.query(selector);\n\t    else elem = selector;\n\t    if (typeof offset == \"undefined\") offset = 0.0125;\n\t    let coord = this.findSlipCoordinate();\n\t    let d = ((elem.offsetTop)/1080-offset)*coord.scale;\n\t    this.moveWindow(coord.x, coord.y+d, coord.scale, this.rotate, delay);\n\t    // this.currentX = coord.x;\n\t    // this.currentY = coord.y+d;\n\t    // this.currentDelay = delay;\n\t    // engine.moveWindow(coord.x, coord.y+d, coord.scale, this.rotate, delay);\n\t},0);\n    };\n    this.moveDownTo = (selector, delay, offset) => {\n\tsetTimeout(() => {\n\t    let elem;\n\t    if(typeof selector == \"string\") elem = this.query(selector);\n\t    else elem = selector;\n\t    if (typeof offset == \"undefined\") offset = 0.0125;\n\t    let coord = this.findSlipCoordinate();\n\t    let d = ((elem.offsetTop+elem.offsetHeight)/1080 - 1 + offset)*coord.scale;\n\t    this.moveWindow(coord.x, coord.y+d, coord.scale, this.rotate, delay);\n\t    // this.currentX = coord.x;\n\t    // this.currentY = coord.y+d;\n\t    // this.currentDelay = delay;\n\t    // engine.moveWindow(coord.x, coord.y+d, coord.scale, this.rotate, delay);\n\t},0);\n    };\n    this.moveCenterTo = (selector, delay, offset) => {\n\tsetTimeout(() => {\n\t    let elem;\n\t    if(typeof selector == \"string\") elem = this.query(selector);\n\t    else elem = selector;\n\t    if (typeof offset == \"undefined\") offset = 0;\n\t    let coord = this.findSlipCoordinate();\n\t    let d = ((elem.offsetTop+elem.offsetHeight/2)/1080-1/2+offset)*coord.scale;\n\t    this.moveWindow(coord.x, coord.y+d, coord.scale, this.rotate, delay);\n\t    // this.currentX = coord.x;\n\t    // this.currentY = coord.y+d;\n\t    // this.currentDelay = delay;\n\t    // engine.moveWindow(coord.x, coord.y+d, coord.scale, this.rotate, delay);\n\t},0);\n    };\n    this.restoreWindow = () => {\n\tthis.getEngine\n    };\n    this.moveWindow = (x,y,scale,rotate, delay) => {\n\tthis.currentX = x;\n\tthis.currentY = y;\n\tthis.currentDelay = delay;\n\tconsole.log(\"previous is ca we try to move win\", this.getEngine().getDoNotMove());\n\tconsole.log(\"previous is ca ORIGIN 3\", x, y, this.getEngine().getDoNotMove());\n//\tsetTimeout(() => {\n\t    this.getEngine().moveWindow(x, y, scale, rotate, delay);\n//\t}, 0);\n    };\n    this.reveal = (selector) => {\n\tlet elem;\n\tif(typeof selector == \"string\") elem = this.query(selector);\n\telse elem = selector;\n\telem.style.opacity = \"1\";\n    };\n    this.revealAll = (selector) => {\n\tthis.queryAll(selector).forEach((elem) => { elem.style.opacity = \"1\";});\n    };\n    this.hide = (selector) => {\n\tthis.query(selector).style.opacity = \"0\";\n    };\n    this.hideAll = (selector) => {\n\tthis.queryAll(selector).forEach((elem) => { elem.style.opacity = \"0\";});\n    };\n\n    // ******************************\n    // Function for writing and highlighting\n    // ******************************\n    this.tool = \"no-tool\";\n    this.getTool = (tool) => {return this.tool;};\n    this.setTool = (tool) => {\n\tif(tool == \"clear-all\") {\n\t    this.sketchpad.clear();\n\t    this.sketchpadHighlight.clear();\n\t    return;\n\t}\n\tthis.tool = tool;\n\tthis.element.classList.remove(\"drawing\", \"highlighting\");\n\tif(tool == \"highlighting\") {\n\t    this.element.classList.add(\"highlighting\");\n\t    this.sketchpadHighlight.mode = \"draw\";\n\t} else if(tool == \"highlighting-erase\") {\n\t    this.element.classList.add(\"highlighting\");\n\t    this.sketchpadHighlight.mode = \"erase\";\n\t} else if(tool == \"drawing\") {\n\t    this.element.classList.add(\"drawing\");\n\t    this.sketchpad.mode = \"draw\";\n\t    this.sketchpad.weight = 1;\n\t} else if(tool == \"drawing-erase\") {\n\t    this.element.classList.add(\"drawing\");\n\t    this.sketchpad.weight = 20;\n\t    this.sketchpad.mode = \"erase\";\n\t} else if(tool == \"clear-all\") {\n\t}\n    };\n    this.color = \"blue\";\n    this.colorHighlight = \"yellow\";\n    this.getColor = () => {\n\tconsole.log(\"slip getting color : \", this.colorHighlight, this.color);\n\tif([\"highlighting\",\"highlighting-erase\"].includes(this.getTool())) {\n\t    return this.colorHighlight;\n\t}\n\telse if([\"drawing\",\"drawing-erase\"].includes(this.getTool())) {\n\t    return this.color;\n\t}\n\treturn \"no-color\";\n    };\n    this.setColor = (color) => {\n\tconsole.log(\"slip : setting color: \", color, \"for tool :\", this.getTool());\n\tswitch(this.getTool()) {\n\tcase(\"highlighting\"):\n\tcase(\"highlighting-erase\"):\n\t    this.colorHighlight = color;\n\t    this.sketchpadHighlight.color = color;\t    \n\t    break;\n\tcase(\"drawing\"):\n\tcase(\"drawing-erase\"):\n\t    this.color = color;\n\t    this.sketchpad.color = color;\t    \n\t    break;\n\t}\n    };\n    this.lineWidth = \"medium\";\n    this.lineWidthErase = \"medium\";\n    this.lineWidthHighlight = \"medium\";\n    this.getLineWidth = () => {\n\tif([\"highlighting\",\"highlighting-erase\"].includes(this.getTool())) \n\t    return this.lineWidthHighlight;\n\telse if([\"drawing\"].includes(this.getTool())) \n\t    return this.lineWidth;\n\telse if([\"drawing-erase\"].includes(this.getTool()))\n\t    return this.lineWidthErase;\n\treturn \"no-line-width\";\n    };\n    this.setLineWidth = (lineWidth) => {\n\tconsole.log(\"slip : setting linewidth: \", lineWidth, \"for tool :\", this.getTool());\n\tif([\"highlighting\",\"highlighting-erase\"].includes(this.getTool())) {\n\t    this.lineWidthHighlight = lineWidth;\n\t    switch(lineWidth) {\n\t    case(\"small\"):\n\t\tthis.sketchpadHighlight.weight = 10;\t    \n\t\tbreak;\n\t    case(\"medium\"):\n\t\tthis.sketchpadHighlight.weight = 30;\t    \n\t\tbreak;\n\t    case(\"large\"):\n\t\tthis.sketchpadHighlight.weight = 90;\t    \n\t\tbreak;\n\t\t\n\t    }\n\t}\n\telse if([\"drawing\"].includes(this.getTool())) {\n\t    this.lineWidth = lineWidth;\n\t    switch(lineWidth) {\n\t    case(\"small\"):\n\t\tthis.sketchpad.weight = 0.25;\t    \n\t\tbreak;\n\t    case(\"medium\"):\n\t\tthis.sketchpad.weight = 1;\t    \n\t\tbreak;\n\t    case(\"large\"):\n\t\tthis.sketchpad.weight = 5;\t    \n\t\tbreak;\n\t    }\n\t}\n\telse if([\"drawing-erase\"].includes(this.getTool())) {\n\t    this.lineWidthErase = lineWidth;\n\t    switch(lineWidth) {\n\t    case(\"small\"):\n\t\tthis.sketchpad.weight = 5;\t    \n\t\tbreak;\n\t    case(\"medium\"):\n\t\tthis.sketchpad.weight = 20;\t    \n\t\tbreak;\n\t    case(\"large\"):\n\t\tthis.sketchpad.weight = 80;\t    \n\t\tbreak;\n\t    }\n\t}\n\tconsole.log(\"setting new line width values :\", this.sketchpad.weight, this.sketchpadHighlight.weight);\n    };\n\n    // ******************************\n    // Initialisation of the object\n    // ******************************\n    // engine\n    let engine = ng;\n    this.getEngine = () => engine;\n    this.setEngine = (ng) => engine = ng;\n    // element\n    this.element =\n\ttypeof name == \"string\" ?\n\tdocument.querySelector(name[0]==\"#\" ? name : (\"#\"+name)):\n\tname;\n    // scale, rotate, delay\n    this.scale = parseFloat(this.element.getAttribute(\"scale\"));\n    if(typeof this.scale == \"undefined\" || isNaN(this.scale)) this.scale = 1;\n    this.rotate = parseFloat(this.element.getAttribute(\"rotate\")) || 0;\n    this.delay = isNaN(parseFloat(this.element.getAttribute(\"delay\"))) ? 0 : (parseFloat(this.element.getAttribute(\"delay\")));\n    // canvas for drawing\n    var that = this;\n    console.log(\"element bug before\", this.element, that.element);\n    let element = this.element;\n    setTimeout(function() {\n\tlet canvas = document.createElement('canvas');\n\tcanvas.height = element.offsetHeight/that.scale;\n\tcanvas.width = element.offsetWidth/that.scale;\n\tconsole.log(\"element bug after\", element, that.element);\n\tcanvas.classList.add(\"sketchpad\", \"drawing\");\n\tcanvas.style.opacity = \"1\";\n\tthat.sketchpadCanvas = canvas;\n\tif(element && element.firstChild && element.firstChild.firstChild)\n\t    element.firstChild.firstChild.appendChild(canvas);\n\telse\n\t    element.appendChild(canvas);\n\tthat.sketchpad = new Atrament(canvas);\n\tthat.sketchpad.smoothing = 0.2;\n\tthat.sketchpad.color = \"blue\";\n    // }, 0);\n    // canvas for highlighting \n    // setTimeout(function() {\n\tlet canvas2 = document.createElement('canvas');\n\tcanvas2.height = that.element.offsetHeight/that.scale;\n\tcanvas2.width = that.element.offsetWidth/that.scale;\n\tcanvas2.classList.add(\"sketchpad\", \"sketchpad-highlighting\");\n\tcanvas2.style.opacity = \"0.5\";\n\tthat.sketchpadCanvasHighlight = canvas2;\n\tif(element && element.firstChild && element.firstChild.firstChild)\n\t    element.firstChild.firstChild.appendChild(canvas2);\n\telse\n\t    element.appendChild(canvas);\n\tthat.sketchpadHighlight = new Atrament(canvas2);\n\tthat.sketchpadHighlight.color = \"yellow\";\n\tthat.sketchpadHighlight.weight = 30;\n\tthat.sketchpadHighlight.smoothing = 0.2;\n    }, 0);\n    this.reloadCanvas = () => {\n\tvar that = this;\n\tconsole.log(\"element bug before\", this.element, that.element);\n\tlet element = this.element;\n\tsetTimeout(function() {\n\t    let canvas = document.createElement('canvas');\n\t    canvas.height = element.offsetHeight/that.scale;\n\t    canvas.width = element.offsetWidth/that.scale;\n\t    console.log(\"element bug after\", element, that.element);\n\t    canvas.classList.add(\"sketchpad\", \"drawing\");\n\t    canvas.style.opacity = \"1\";\n\t    that.sketchpadCanvas = canvas;\n\t    let q = that.queryAll(\".sketchpad\");\n\t    q[0].replaceWith(canvas);\n\t    //     if(element && element.firstChild && element.firstChild.firstChild)\n\t    //     element.firstChild.firstChild.appendChild(canvas);\n\t    // else\n\t    //     element.appendChild(canvas);\n\t    that.sketchpad = new Atrament(canvas);\n\t    that.sketchpad.smoothing = 0.2;\n\t    that.sketchpad.color = \"blue\";\n\t    // }, 0);\n\t    // canvas for highlighting \n\t    // setTimeout(function() {\n\t    let canvas2 = document.createElement('canvas');\n\t    canvas2.height = that.element.offsetHeight/that.scale;\n\t    canvas2.width = that.element.offsetWidth/that.scale;\n\t    canvas2.classList.add(\"sketchpad\", \"sketchpad-highlighting\");\n\t    canvas2.style.opacity = \"0.5\";\n\t    that.sketchpadCanvasHighlight = canvas2;\n\t    q[0].replaceWith(canvas2);\n\t    // if(element && element.firstChild && element.firstChild.firstChild)\n\t    //     element.firstChild.firstChild.appendChild(canvas2);\n\t    // else\n\t    //     element.appendChild(canvas);\n\t    that.sketchpadHighlight = new Atrament(canvas2);\n\t    that.sketchpadHighlight.color = \"yellow\";\n\t    that.sketchpadHighlight.weight = 30;\n\t    that.sketchpadHighlight.smoothing = 0.2;\n\t}, 0);\n\n    };\n    // names\n    this.name =\n\ttypeof name == \"string\" ?\n\tname:\n\tname.id;\n    if(typeof(fullName) == \"string\")\n\tthis.fullName = fullName ;\n    else if (this.element.hasAttribute(\"toc-title\"))\n\tthis.fullName = this.element.getAttribute(\"toc-title\");\n    else\n\tthis.fullName = this.name;\n    console.log(\"this name is \", this.name);\n    // clonedElement\n    let clonedElement;\n    if(typeof MathJax != \"undefined\")\n\tMathJax.startup.promise.then(() => {\n\t    setTimeout(() => {clonedElement = cloneNoSubslip(this.element);},0);\n\t});\n    else\n\tsetTimeout(() => {clonedElement = cloneNoSubslip(this.element);},0);\n    console.log(\"to Atrament debug before\",this.element);\n\n    this.getCloned = () => clonedElement;\n    this.setCloned = (c) => clonedElement = c;\n    // coord\n    let coord = this.findSlipCoordinate();\n    console.log(coord);\n    this.x = coord.x;\n    this.y = coord.y;\n    // Preparing the slip\n    this.init(this, engine);\n    // Adding \"enter-at\" subslips\n    this.addSubSlips();\n    // Adding \"paused-flow\" subslips\n    this.generatePauseFlowSlipList = function () {\n\tlet slipList = [];\n\tlet bla = this.queryAll(\"[pause], [step], [auto-enter], [immediate-enter]\");\n\tlet step = 1;\n\tbla.forEach((elem) => {\n\t    console.log(\"debug generatePauseFlowsliplist\", elem, step);\n\t    if(elem.hasAttribute(\"auto-enter\")){\n\t\tslipList[step] = new Slip(elem, elem.getAttribute(\"toc-title\") || \"\", [], ng, {});\n\t\tstep++;\n\t    }\n\t    if(elem.hasAttribute(\"immediate-enter\")){\n\t\t// the slip is entered before the pause\n\t\tslipList[step-1] = new Slip(elem, elem.getAttribute(\"toc-title\") || \"\", [], ng, {});\n\t\tstep++;\n\t    }\n\t    if(elem.hasAttribute(\"step\")){\n\t\tconsole.log(\"has enter-at-unpause?\");\n\t\tif(elem.hasAttribute(\"enter-at-unpause\")) {\n\t\t    console.log(\"has enter-at-unpause\");\n\t\t    if(elem.getAttribute(\"enter-at-unpause\") != \"\") {\n\t\t\tlet s = this.query(\"#\"+elem.getAttribute(\"enter-at-unpause\"));\n\t\t\tslipList[step] = new Slip(s, s.getAttribute(\"toc-title\") || \"\", [], ng, {});\n//\t\t\tslipList[step + (parseInt(elem.getAttribute(\"step\")) || 1) - 1] = new Slip(s, s.getAttribute(\"toc-title\") || \"\", [], ng, {});\n\t\t    }\n\t\t    else\n\t\t\tslipList[step + (parseInt(elem.getAttribute(\"step\")) || 1) - 1] = new Slip(elem, elem.getAttribute(\"toc-title\") || \"\", [], ng, {});\n\t\t}\n\t\tconsole.log(\"debug generatePauseFlowsliplist1\", elem, step);\n\t\tstep += parseInt(elem.getAttribute(\"step\")) || 1 ;\n\t\tconsole.log(\"debug generatePauseFlowsliplist2\", elem, step);\n\t    }\n\t    if(elem.hasAttribute(\"pause\")){\n\t\tif(elem.hasAttribute(\"enter-at-unpause\")) {\n\t\t    if(elem.getAttribute(\"enter-at-unpause\") != \"\") {\n\t\t\tlet s = this.query(elem.getAttribute(\"enter-at-unpause\"));\n\t\t\tslipList[step + (parseInt(elem.getAttribute(\"step\")) || 1) - 1] = new Slip(s, s.getAttribute(\"toc-title\") || \"\", [], ng, {});\n\t\t    }\n\t\t    else\n\t\t\tslipList[step + (parseInt(elem.getAttribute(\"step\")) || 1) - 1] = new Slip(elem, elem.getAttribute(\"toc-title\") || \"\", [], ng, {});\n\t\t}\n\t\tconsole.log(\"debug generatePauseFlowsliplist1\", elem, step);\n\t\tstep += parseInt(elem.getAttribute(\"pause\")) || 1 ;\n\t\tconsole.log(\"debug generatePauseFlowsliplist1\", elem, step);\n\t    }\n\t});\n\treturn slipList;\n    };\n    this.pauseSlipList = this.generatePauseFlowSlipList();\n    // this.pauseSlipList = this.queryAll(\"[pause], [step], [auto-enter]\").map((elem) => {\n    // \tif(elem.hasAttribute(\"auto-enter\"))\n    // \t    return new Slip(elem, elem.getAttribute(\"toc-title\") || \"\", [], ng, {});\n    // \treturn null;\n    // });\n}\n","import { myQueryAll } from './util';\nimport Controller from './controller';\nimport Slip from './slip';\n\nexport default function (root) {\n    function prepareRoot (rootElem) {\n\tlet container = document.createElement(\"div\");\n\tcontainer.innerHTML = \n\t    `\t\n\t<div class=\"toc-slip\" style=\"display:none;\"></div>\n        <div id=\"open-window\">\n\t  <div class=\"cpt-slip\">0</div>\n\t  <div class=\"slip-writing-toolbar\">\n              <div class=\"slip-toolbar-tool no-tool\">\n                  <div class=\"slip-toolbar-pen\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\" focusable=\"false\" width=\"20\" height=\"20\" style=\"-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 36 36\"><path class=\"clr-i-outline clr-i-outline-path-1\" d=\"M33.87 8.32L28 2.42a2.07 2.07 0 0 0-2.92 0L4.27 23.2l-1.9 8.2a2.06 2.06 0 0 0 2 2.5a2.14 2.14 0 0 0 .43 0l8.29-1.9l20.78-20.76a2.07 2.07 0 0 0 0-2.92zM12.09 30.2l-7.77 1.63l1.77-7.62L21.66 8.7l6 6zM29 13.25l-6-6l3.48-3.46l5.9 6z\" fill=\"#000000\"/><rect x=\"0\" y=\"0\" width=\"36\" height=\"36\" fill=\"rgba(0, 0, 0, 0)\" /></svg>\n                  </div>\n                  <div class=\"slip-toolbar-highlighter\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\" focusable=\"false\" width=\"25\" height=\"25\" style=\"-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 36 36\"><path d=\"M15.82 26.06a1 1 0 0 1-.71-.29l-6.44-6.44a1 1 0 0 1-.29-.71a1 1 0 0 1 .29-.71L23 3.54a5.55 5.55 0 1 1 7.85 7.86L16.53 25.77a1 1 0 0 1-.71.29zm-5-7.44l5 5L29.48 10a3.54 3.54 0 0 0 0-5a3.63 3.63 0 0 0-5 0z\" class=\"clr-i-outline clr-i-outline-path-1\" fill=\"#000000\"/><path d=\"M10.38 28.28a1 1 0 0 1-.71-.28l-3.22-3.23a1 1 0 0 1-.22-1.09l2.22-5.44a1 1 0 0 1 1.63-.33l6.45 6.44A1 1 0 0 1 16.2 26l-5.44 2.22a1.33 1.33 0 0 1-.38.06zm-2.05-4.46l2.29 2.28l3.43-1.4l-4.31-4.31z\" class=\"clr-i-outline clr-i-outline-path-2\" fill=\"#000000\"/><path d=\"M8.94 30h-5a1 1 0 0 1-.84-1.55l3.22-4.94a1 1 0 0 1 1.55-.16l3.21 3.22a1 1 0 0 1 .06 1.35L9.7 29.64a1 1 0 0 1-.76.36zm-3.16-2h2.69l.53-.66l-1.7-1.7z\" class=\"clr-i-outline clr-i-outline-path-3\" fill=\"#000000\"/><rect x=\"0\" y=\"0\" width=\"36\" height=\"36\" fill=\"rgba(0, 0, 0, 0)\" /></svg>\n</div>\n                  <div class=\"slip-toolbar-eraser\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\" focusable=\"false\" width=\"20\" height=\"20\" style=\"-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 36 36\"><path d=\"M35.62 12a2.82 2.82 0 0 0-.84-2l-7.29-7.35a2.9 2.9 0 0 0-4 0L2.83 23.28a2.84 2.84 0 0 0 0 4L7.53 32H3a1 1 0 0 0 0 2h25a1 1 0 0 0 0-2H16.74l18-18a2.82 2.82 0 0 0 .88-2zM13.91 32h-3.55l-6.11-6.11a.84.84 0 0 1 0-1.19l5.51-5.52l8.49 8.48zm19.46-19.46L19.66 26.25l-8.48-8.49l13.7-13.7a.86.86 0 0 1 1.19 0l7.3 7.29a.86.86 0 0 1 .25.6a.82.82 0 0 1-.25.59z\" class=\"clr-i-outline clr-i-outline-path-1\" fill=\"#000000\"/><rect x=\"0\" y=\"0\" width=\"36\" height=\"36\" fill=\"rgba(0, 0, 0, 0)\" /></svg>\n</div>\n                  <div class=\"slip-toolbar-cursor\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\" focusable=\"false\" width=\"20\" height=\"20\" style=\"-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 36 36\"><path class=\"clr-i-outline clr-i-outline-path-1\" d=\"M14.58 32.31a1 1 0 0 1-.94-.65L4 5.65a1 1 0 0 1 1.25-1.28l26 9.68a1 1 0 0 1-.05 1.89l-8.36 2.57l8.3 8.3a1 1 0 0 1 0 1.41l-3.26 3.26a1 1 0 0 1-.71.29a1 1 0 0 1-.71-.29l-8.33-8.33l-2.6 8.45a1 1 0 0 1-.93.71zm3.09-12a1 1 0 0 1 .71.29l8.79 8.79L29 27.51l-8.76-8.76a1 1 0 0 1 .41-1.66l7.13-2.2L6.6 7l7.89 21.2l2.22-7.2a1 1 0 0 1 .71-.68z\" fill=\"#000000\"/><rect x=\"0\" y=\"0\" width=\"36\" height=\"36\" fill=\"rgba(0, 0, 0, 0)\" /></svg>\n</div>\n              </div>\n              <div class=\"slip-toolbar-color\">\n                  <div class=\"slip-toolbar-black\"></div>\n                  <div class=\"slip-toolbar-blue\"></div>\n                  <div class=\"slip-toolbar-red\"></div>\n                  <div class=\"slip-toolbar-green\"></div>\n                  <div class=\"slip-toolbar-yellow\"></div>\n              </div>\n\n              <div class=\"slip-toolbar-width\">\n                  <div class=\"slip-toolbar-small\"><div></div></div>\n                  <div class=\"slip-toolbar-medium\"><div></div></div>\n                  <div class=\"slip-toolbar-large\"><div></div></div>\n              </div>\n              <div class=\"slip-toolbar-control\">\n                  <!-- <div class=\"slip-toolbar-stop\">✓</div> -->\n                  <div class=\"slip-toolbar-clear\">✗</div>\n              </div>\n          </div>\n\t  <div class=\"format-container\">\n\t    <div class=\"rotate-container\">\n\t\t<div class=\"scale-container\">\n\t\t    <div class=\"universe movable\" id=\"universe\">\n\t\t\t<div width=\"10000\" height=\"10000\" class=\"fog\"></div>\n                        <div class=\"placeHolder\"></div>\n\t\t    </div>\n\t\t</div>\n              </div>\n\t    </div>\n\t</div>`;\n\trootElem.replaceWith(container);\n\tcontainer.querySelector(\".placeHolder\").replaceWith(rootElem);\n\trootElem.querySelectorAll(\"slip-slip\").forEach((slipElem) => {\n\t    setTimeout(() => {\n\t\tvar scaleContainer = document.createElement('div');\n\t\tvar slipContainer = document.createElement('div');\n\t\tscaleContainer.classList.add(\"slip-scale-container\");\n\t\tslipContainer.classList.add(\"slip-container\");\n\t\tlet fChild;\n\t\twhile((fChild = slipElem.firstChild)) {\n\t\t    slipContainer.appendChild(fChild);\n\t\t}\n\t\tscaleContainer.appendChild(slipContainer);\n\t\tslipElem.appendChild(scaleContainer);\n\t\tsetTimeout(() => {\n\t\t    // let canvas = document.createElement('canvas');\n\t\t    // canvas.height = slipContainer.offsetHeight;\n\t\t    // canvas.width = slipContainer.offsetWidth;\n\t\t    // canvas.classList.add(\"sketchpad\");\n\t\t    // canvas.style.opacity = \"1\";\n\t\t    // slipContainer.appendChild(canvas);\n\t\t    // let sketchpad = new Atrament(canvas);\n\t\t    // sketchpad.smoothing = 0.2;\n\t\t},0);\n\t    },0);\n\t});\n\trootElem.style.width = \"unset\";\n\trootElem.style.height = \"unset\";\n\tdocument.querySelectorAll(\".background-canvas\").forEach((elem)=> {elem.addEventListener(\"click\", (ev) => { console.log(\"vous avez cliquez aux coordonnées : \", ev.layerX, ev.layerY); });});\t\n    }\n    if (typeof(root) == \"string\") {\n\tif(root[0] != \"#\")\n\t    root = \"#\"+root;\n\troot = document.querySelector(root);\n    }\n    else if (typeof(root) == \"undefined\")\n\troot = document.querySelector(\"slip-slipshow\");\n    prepareRoot(root);\n\n    // Constants\n    document.body.style.cursor = \"auto\";\n    let timeOutIds = [];\n    document.body.addEventListener(\"mousemove\", (ev) => {\n\ttimeOutIds.forEach((id) => { clearTimeout(id); });\n\tdocument.body.style.cursor = \"auto\";\n\ttimeOutIds.push(setTimeout(() => { document.body.style.cursor = \"none\";}, 5000));\n    });\n    let openWindow = document.querySelector(\"#open-window\");\n    let universe = document.querySelector(\"#universe\");\n    let slips = universe.querySelectorAll(\"slip-slip:not(slip-slipshow)\");\n    let browserHeight, openWindowWidth;\n    let browserWidth, openWindowHeight;\n    this.getOpenWindowHeight = () => openWindowHeight;\n    this.getOpenWindowWidth = () => openWindowWidth;\n\n    let winX, winY;\n    let currentScale, currentRotate;\n    this.getCoord = () => { return {x: winX, y: winY, scale: currentScale};};\n    let doNotMove = false;\n    this.setDoNotMove = m => doNotMove = m;\n    this.getDoNotMove = m => doNotMove;\n    this.moveWindow = function (x, y, scale, rotate, delay) {\n\tif(this.getDoNotMove()) {\n\t    console.log(\"we cannot move\");\n\t    console.log(\"previous is ca we cannot move !\");\n\t    return;\n\t}\n\tconsole.log(\"previous is ca getDoNotMove !\", x,y,scale, rotate, delay, this.getDoNotMove());\n\tconsole.log(\"move to\", x, y, \"with scale, rotate, delay\", scale, rotate, delay);\n\tcurrentScale = scale;\n\tcurrentRotate = rotate;\n\twinX = x ;\n\twinY = y;\n\tconsole.log(x,y);\n\tsetTimeout(() => {\n\t    document.querySelector(\".scale-container\").style.transitionDuration = delay+\"s\";\n\t    document.querySelector(\".rotate-container\").style.transitionDuration = delay+\"s\";\n\t    universe.style.transitionDuration = delay+\"s, \"+delay+ \"s\"; \n\t    setTimeout(() => {\n\t\tuniverse.style.left = -(x*1440 - 1440/2)+\"px\";\n\t\tuniverse.style.top = -(y*1080 - 1080/2)+\"px\";\n\t\tdocument.querySelector(\".scale-container\").style.transform = \"scale(\"+(1/scale)+\")\";\n\t\tdocument.querySelector(\".rotate-container\").style.transform = \"rotate(\"+(rotate)+\"deg)\";\n\t    },0);\n\t},0);\n\treturn;\n    };\n    this.moveWindowRelative = function(dx, dy, dscale, drotate, delay) {\n\tthis.moveWindow(winX+dx, winY+dy, currentScale+dscale, currentRotate+drotate, delay);\n    };\n    this.placeSlip = function(slip) {\n\t// console.log(\"debug Previous (slip)\", slip);\n\t// let posX = 0.5;\n\t// let posY = 0.5;\n\t// let x=parseFloat(slip.getAttribute(\"pos-x\")), y=parseFloat(slip.getAttribute(\"pos-y\"));\n\tlet scale = parseFloat(slip.getAttribute(\"scale\"));\n\t// // console.log(slip);\n\tlet slipScaleContainer = slip.querySelector(\".slip-scale-container\");\n\t// let rotate = 0;\n\tscale = isNaN(scale) ? 1 : scale ;\n\t// x = (isNaN(x) ? posX : x);\n\t// y = (isNaN(y) ? posY : y);\n\t// slip.setAttribute(\"pos-x\", x);\n\t// slip.setAttribute(\"pos-y\", y);\n\t// slip.setAttribute(\"scale\", scale);\n\t// slip.setAttribute(\"rotate\", rotate);\n\t// posX = x + 1;\n\t// posY = y;\n\t// slip.style.top = (y*1080 - 1080/2)+\"px\";\n\t// slip.style.left = (x*1440 - 1440/2)+\"px\";\n\t// if(!slip.classList.contains(\"permanent\"))\n\t// \tslip.style.zIndex = \"-1\";\n\t// slip.style.transformOrigin = \"50% 50%\";\n\tslipScaleContainer.style.transform = \"scale(\"+scale+\")\";\n\tslip.style.width = (Math.max(slipScaleContainer.offsetWidth, 1440))*scale+\"px\";\n\tslip.style.height = (Math.max(slipScaleContainer.offsetHeight, 1080))*scale+\"px\";\t\n    };\n    this.placeSlips = function () {\n\t// let posX = 0.5;\n\t// let posY = 0.5;\n\tlet depth = function (elem) {\n\t    console.log(\"debug depth (elem)\", elem);\n\t    let subslips = myQueryAll(elem, \"slip-slip\");\n\t    console.log(\"debug depth (subslips)\", elem);\n\t    return 1+subslips.map(depth).reduce((a,b) => Math.max(a,b),0);\n\t};\n\tlet rootDepth = depth(document.body);\n\tconsole.log(\"debug\", rootDepth);\n\tfor(let i= 0; i<rootDepth; i++)\n\t    slips.forEach(this.placeSlip);\t\n    };\n    setTimeout(() => {\n\tthis.placeSlips();\n    },0);\n    this.placeOpenWindow = function () {\n\tbrowserHeight = window.innerHeight;\n\tbrowserWidth = window.innerWidth;\n\tif(browserHeight/3 < browserWidth/4) {\n\t    openWindowWidth = Math.floor((browserHeight*4)/3);\n\t    openWindowHeight = browserHeight;\n\t    openWindow.style.left = ((window.innerWidth - openWindowWidth) /2)+\"px\";\n\t    openWindow.style.right = ((window.innerWidth - openWindowWidth) /2)+\"px\";\n\t    openWindow.style.width = (openWindowWidth)+\"px\";\n\t    openWindow.style.top = \"0\";\n\t    openWindow.style.bottom = \"0\";\n\t    openWindow.style.height = (openWindowHeight)+\"px\";\n\t}\n\telse {\n\t    openWindowHeight = Math.floor((browserWidth*3)/4);\n\t    openWindowWidth = browserWidth;\n\t    openWindow.style.top = ((window.innerHeight - openWindowHeight) /2)+\"px\";\n\t    openWindow.style.bottom = ((window.innerHeight - openWindowHeight) /2)+\"px\";\n\t    openWindow.style.height = (openWindowHeight)+\"px\";\n\t    openWindow.style.right = \"0\";\n\t    openWindow.style.left = \"0\";\n\t    openWindow.style.width = openWindowWidth+\"px\";\n\t}\n\tdocument.querySelector(\".scale-container\").style.transformOrigin = (1440/2)+\"px \"+(1080/2)+\"px\";\n\tdocument.querySelector(\".rotate-container\").style.transformOrigin = (1440/2)+\"px \"+(1080/2)+\"px\";\n\tdocument.querySelector(\".format-container\").style.transform = \"scale(\"+(openWindowWidth/1440)+\")\";\n\tdocument.querySelector(\".cpt-slip\").style.right =  (parseInt(openWindow.style.left)) + \"px\";\n\tdocument.querySelector(\".cpt-slip\").style.bottom =  \"0\";\n\tdocument.querySelector(\".cpt-slip\").style.zIndex =  \"10\";\n    };\n    this.placeOpenWindow();\n    window.addEventListener(\"resize\", (ev) => {\n\tthis.placeOpenWindow();\n\tthis.moveWindow(winX, winY, currentScale, currentRotate, 0);\n    });\n\n    // Taken from https://selftaughtjs.com/algorithm-sundays-converting-roman-numerals\n    // Use in showing roman numbers for slip number\n    function counterToString(num, depth) {\n\tif(depth == 1 || depth > 3)\n\t    return num.toString();\n\tlet result = '';\n\tlet decimal = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1];\n\tlet roman;\n\tif(depth == 0)\n\t    roman = [\"M\", \"CM\",\"D\",\"CD\",\"C\", \"XC\", \"L\", \"XL\", \"X\",\"IX\",\"V\",\"IV\",\"I\"];\n\telse\n\t    roman = [\"m\", \"cm\",\"d\",\"cd\",\"c\", \"xc\", \"l\", \"xl\", \"x\",\"ix\",\"v\",\"iv\",\"i\"];\n\tfor (var i = 0;i<=decimal.length;i++) {\n\t    while (num%decimal[i] < num) {     \n\t\tresult += roman[i];\n\t\tnum -= decimal[i];\n\t    }\n\t}\n\treturn result;\n    }\n    this.countersToString = (counterList) => {\n\tlet res = '';\n\tres += counterToString(counterList[0]+1, 0);\n\tfor(let i = 1; i < counterList.length; i++)\n\t    res += \".\" + counterToString(counterList[i]+1, i);\n\treturn res;\t\n    };\n    this.updateCounter = function () {\n\tlet counters = stack.map((slip) => slip.getActionIndex());\n\tdocument.querySelector(\".cpt-slip\").innerHTML = this.countersToString(counters);\t\n    };\n    this.enter = (n) => {\n\tthis.gotoSlip(n);\n\tthis.push(n);\n\tthis.next();\n    };\n    this.next = () => {\n\tif(document.querySelector(\".toc-slip\").innerHTML == \"\")\n\t    this.showToC();\n\t// return true if and only if the stack changed\n\tlet currentSlide = this.getCurrentSlip();\n\tlet n = currentSlide.next();\n\tthis.updateCounter();\n\tif(n instanceof Slip) {\n\t    this.enter(n);\n\t    // this.gotoSlip(n);\n\t    // this.push(n);\n\t    // this.next();\n\t    // this.showToC();\n\t    return true;\n\t}\n\telse if(!n) {\n\t    this.pop();\n\t    let newCurrentSlip = this.getCurrentSlip();\n\t    if(newCurrentSlip.nextStageNeedGoto())\n\t\tthis.gotoSlip(newCurrentSlip);\n\t    // newCurrentSlip.incrIndex();\n\t    if(stack.length > 1 || newCurrentSlip.getActionIndex() < newCurrentSlip.getMaxNext())\n\t\tthis.next();\n\t    else\n\t\tthis.gotoSlip(newCurrentSlip);\n\t    // this.showToC();\n\t    return true;\n\t    // console.log(stack);\n\t}\n\t// this.showToC();\n\treturn false;\n    };\n    this.nextSlip = function () {\n\t// Do this.next() untill the stack change\n\twhile(!this.next()) {}\n    };\n    this.previous = (options) => {\n\tconsole.log(\"previous is called with option\", options);\n\tlet currentSlip = this.getCurrentSlip();\n\t// setDoNotMove(true);\n\t// let stage = currentSlip.previous2();\n\t// setDoNotMove(false);\n\tlet n = currentSlip.previous();\n\t// if(stage == \"\")\n\tconsole.log(\"debug previous (currentSlip, n)\", currentSlip, n);\n\tif(n instanceof Slip) {\n\t    while(n.getCurrentSubSlip() instanceof Slip) {\n\t\tthis.push(n);\n\t\tn = n.getCurrentSubSlip();\n\t    }\n\t    this.push(n);\n\t    console.log(\"previous is ca GOTOSLIP FROM 1\", options);\n\t    \n\t    this.gotoSlip(n, options);\n\t    // this.gotoSlip(n, {delay: currentSlip.delay});\n\t\t\n\t    // this.showToC();\n\t    this.updateCounter();\n\t    return true;\n\t}\n\telse if(!n) {\n\t    this.pop();\n\t    let newCurrentSlide = this.getCurrentSlip();\n\t    // newCurrentSlide.incrIndex();\n\t    console.log(\"previous is ca currentDelay, delay\", currentSlip.currentDelay , currentSlip.delay);\n\t    \n\t    if(stack.length > 1 || newCurrentSlide.getActionIndex() > -1)\n\t\tthis.previous({delay: (currentSlip.currentDelay ? currentSlip.currentDelay : currentSlip.delay )});\n\t    else {\n\t\tthis.gotoSlip(newCurrentSlide, options);\n\t\tconsole.log(\"previous is ca GOTOSLIP FROM 2\", options);\n\t    }\n\t\t// this.gotoSlip(newCurrentSlide, {delay: currentSlip.delay});\n\t    // console.log(stack);\n\t    // this.showToC();\n\t    this.updateCounter();\n\t    return true;\n\t} else if(options){\n\t    setTimeout(() => {\n\t\tthis.gotoSlip(currentSlip, options);\n\t    },0);\n\t}\n\t// this.showToC();\n\tthis.updateCounter();\n\treturn false;\n\t// console.log(\"returned\", n);\n    };\n    this.previousSlip = function () {\n\t// Do this.previous() untill the stack change\n\twhile(!this.previous()) {}\n    };\n\n    this.getCoordinateInUniverse = function (elem) {\n\tconsole.log(\"debug getcoord elem\", elem);\n\tlet getCoordInParen = (elem) => {\n\t    return {x: elem.offsetLeft, y:elem.offsetTop};\t    \n\t};\n\tlet globalScale = 1;\n\tlet parseScale = function(transform) {\n\t    if (transform == \"none\")\n\t\treturn 1;\n\t    return parseFloat(transform.split(\"(\")[1].split(\",\")[0]);\n\t};\n\tlet getCoordIter = (elem) => {\n\t    console.log(\"debug getcoorditer elem\", elem);\n\t    let cInParent = getCoordInParen(elem);\n\t    if(!elem.offsetParent)\n\t\treturn { x: 0,\n\t\t\t y: 0,\n\t\t\t centerX: 0,\n\t\t\t centerY: 0,\n\t\t\t width: 0,\n\t\t\t height: 0,\n\t\t\t scale: 0 };\n\t    if(elem.offsetParent.classList.contains(\"universe\"))\n\t    {\n\t\tconsole.log(\"universe\", cInParent);\n\t\treturn cInParent;\n\t    }\n\t    let cParent = getCoordIter(elem.offsetParent);\n\t    let style = window.getComputedStyle(elem.offsetParent);\n\t    // console.log(style);\n\t    let scale;\n\t    // console.log(\"style\", style.transform);\n\t    // if (style.transform == \"none\")\n\t    // \tscale = 1;\n\t    // else\n\t    // \tscale = parseFloat(style.transform.split(\"(\")[1].split(\",\")[0]);\n\t    scale = parseScale(style.transform);\n\t    // console.log(style.transform);\n\t    // console.log(\"scale\", scale);\n\t    // console.log(\"globalScale\", globalScale);\n\t    globalScale *= scale;\n\t    // let scale = 1 ; // Has to parse/compute the scale, for now always 1\n\t    // console.log(\"at step\",  \"cParent.x\", cParent.x, \"cInParen.x\", cInParent.x, \"scale\", scale);\n\t    return {x:cParent.x+cInParent.x*globalScale, y:cParent.y+cInParent.y*globalScale };\n\t};\n\tlet c = getCoordIter(elem);\n\tlet style = window.getComputedStyle(elem);\n\tlet scale = parseScale(style.transform);\n\tglobalScale *= scale;\n\tconsole.log(\"getCoord\", {x:c.x/1440+0.5, y:c.y/1080+0.5}, \"globalScale\", globalScale, style.transform, scale);\n\tlet ret = { x: c.x/1440,\n\t\t    y: c.y/1080,\n\t\t    centerX:c.x/1440+0.5*elem.offsetWidth/1440*globalScale,\n\t\t    centerY:c.y/1080+0.5*elem.offsetHeight/1080*globalScale,\n\t\t    width: elem.offsetWidth/1440*globalScale,\n\t\t    height: elem.offsetHeight/1080*globalScale,\n\t\t    scale: globalScale };\n\tconsole.log(ret);\n\treturn ret;\n\t// return {x:c.x/1440+elem*globalScale*scale, y:c.y/1080+0.5*globalScale*scale, scale: globalScale*scale};\n\t// return {x: this.element.offsetLeft/1440+0.5, y:this.element.offsetTop/1080+0.5};\n    };\n    this.moveToElement = function(element, options) {\n\tlet coord = this.getCoordinateInUniverse(element);\n\tlet actualSize = {width: element.offsetWidth*coord.scale, height: element.offsetHeight*coord.scale};\n\tif(options)\n\t    this.moveWindow(coord.centerX, coord.centerY, Math.max(coord.width, coord.height)// coord.scale\n\t\t\t    , 0, options.delay ? options.delay : 1);\n    };\n    this.gotoSlip = function(slip, options) {\n\tconsole.log(\"previous is ca goto slip\", options, slip.element, this.getDoNotMove());\n\tconsole.log(\"we goto slip\", slip.element, this.getDoNotMove());\n\toptions = options ? options : {};\n\tconsole.log(\"options is \", options);\n\tif(slip.element.tagName == \"SLIP-SLIP\")\n\t{\n\t     setTimeout(() => {\n\t\tlet coord = slip.findSlipCoordinate();\n\t\tif(typeof slip.currentX != \"undefined\" && typeof slip.currentY != \"undefined\") {\n\t\t    console.log(\"previous is ca ORIGIN 1\", slip.currentX, slip.currentY, this.getDoNotMove(), options);\n\t\t    this.moveWindow(slip.currentX, slip.currentY, coord.scale, slip.rotate, typeof(options.delay)!=\"undefined\" ? options.delay : (typeof(slip.currentDelay)!=\"undefined\" ? slip.currentDelay : slip.delay));\n\t\t} else {\n\t\t    slip.currentX = coord.x; slip.currentY = coord.y; slip.currentDelay = slip.delay;\n\t\t    console.log(\"previous is ca ORIGIN 2\", coord.x, coord.y, this.getDoNotMove());\n\t\t    this.moveWindow(coord.x, coord.y, coord.scale, slip.rotate, typeof(options.delay)!=\"undefined\" ? options.delay : (typeof(slip.currentDelay)!=\"undefined\" ? slip.currentDelay : slip.delay));\n\t\t}\n\t     },0);\n\t}\n\telse {\n\t     setTimeout(() => {\n\t\tconsole.log(\"debug slip element\", slip.element);\n\t\tlet coord = this.getCoordinateInUniverse(slip.element);\n\t\t this.moveWindow(coord.centerX, coord.centerY, Math.max(coord.width, coord.height), 0, typeof(options.delay)!=\"undefined\" ? options.delay : slip.delay);\n\t     },0);\n\t}\n    };\n    let rootSlip = new Slip(root, \"Presentation\", [], this, {});\n    let stack = [rootSlip];\n\n    // Stack Management:\n    this.push = function (n) {\n\tthis.getToC().querySelectorAll(\".toc-slip .active-slip\").forEach(elem => elem.classList.remove(\"active-slip\"));\n\tif(n.tocElem)\n\t    n.tocElem.classList.add(\"active-slip\");\n\tn.element.classList.add(\"active-true-slip\");\n\tif(stack.length>0)\n\t    stack[stack.length-1].element.classList.remove(\"active-true-slip\");\n\tstack.push(n);\n\treturn ;\n    };\n    this.pop = function () {\n\tthis.getToC().querySelectorAll(\".toc-slip .active-slip\").forEach(elem => elem.classList.remove(\"active-slip\"));\n\tlet n = stack.pop();\n\tn.element.classList.remove(\"active-true-slip\");\n\tif(stack.length == 0)\n\t    stack.push(n);\n\tstack[stack.length-1].element.classList.add(\"active-true-slip\");\n\tif(stack[stack.length -1].tocElem)\n\t    stack[stack.length -1].tocElem.classList.add(\"active-slip\");\n\treturn n;\n    };\n    this.getCurrentSlip = function () {\n\treturn stack[stack.length -1];\n    };\n    this.getSlipTree = function (slip) {\n\tslip = slip || rootSlip;\n\tif(slip instanceof Slip) \n\t    return {name: slip.name, slip: slip, subslips: slip.getActionList().map((e) => this.getSlipTree(e))};\n\treturn {function: true};\n    };\n\n    this.goToState = function(state) {\n\tlet iter = (state) => {\n\t    if(state.length == 0)\n\t\treturn;\n\t    iter(state[0]);\n\t    while(state[1].getActionIndex()<state[2])\n\t\tthis.next();\n\t};\n\tstack = [rootSlip];\n\trootSlip.refreshAll();\n\titer(state);\n\tthis.gotoSlip(state[1]);\n    };\n    let toc;\n    this.getToC = function() {\n\tif (toc)\n\t    return toc;\n\ttoc = document.querySelector(\".toc-slip\");\n\treturn toc;\n    };\n    this.showToC = function () {\n\tconsole.log(\"debug showtoc\");\n\tlet toc = document.querySelector(\".toc-slip\");\n\t// let innerHTML = \"\";\n\tlet globalElem = document.createElement(\"div\");\n\tlet tree = this.getSlipTree();\n\t// let before = true;\n\tlet displayTree = (tree, stackWithNumbers) => {\n\t    console.log(\"debug treee\", tree);\n\t    let containerElement = document.createElement(\"div\");\n\t    let nameElement = document.createElement(\"div\");\n\t    // if(before)\n\t    // \tnameElement.style.color = \"blue\";\n\t    // else\n\t    // \tnameElement.style.color = \"yellow\";\n\t    // if(tree.slip == this.getCurrentSlip()) {\n\t    // \tnameElement.style.color = \"red\";\n\t    // \tbefore = false;\n\t    // }\n\t\t\n\t    nameElement.innerText = tree.slip.fullName; //? tree.slip.fullName : tree.slip.name ; //+ \" (\" + (tree.slip.getActionIndex()+1) + \"/\" + (tree.slip.getMaxNext()+1) + \")\";\n\t    containerElement.appendChild(nameElement);\n\t    // innerHTML += \"<div>\"+tree.name+\"</div>\";\n\t    if(tree.subslips.length > 0) {\n\t\tlet ulElement = document.createElement(\"ul\");\n\t\t// innerHTML += \"<ul>\";\n\t\ttree.subslips.forEach((subtree, index) => {\n\t\t    let newStackWithNumbers = [stackWithNumbers, tree.slip, index];\n\t\t    let liElement = document.createElement(\"li\");\n\t\t    // innerHTML += \"<li>\";\n\t\t    if(subtree.function) {\n\t\t\tlet toCounter = (c) => {\n\t\t\t    if(c.length == 0)\n\t\t\t\treturn [];\n\t\t\t    return toCounter(c[0]).concat([c[2]]);\n\t\t\t};\n\t\t\tliElement.innerText = this.countersToString(toCounter(newStackWithNumbers));\n\t\t\t//\t\t\tliElement.innerText = \"\"+(index+1);\n\t\t\tliElement.classList.add(\"toc-function\");\n\t\t    } else\n\t\t\tliElement.appendChild(displayTree(subtree, newStackWithNumbers));\n\t\t    liElement.addEventListener(\"click\", (ev) => {\n\t\t    \tif(ev.target == liElement) {\n\t\t    \t    this.goToState(newStackWithNumbers);\n\t\t    \t    console.log(\"newstack\", newStackWithNumbers);\n\t\t    \t}\n\t\t    });\n\t\t    ulElement.appendChild(liElement);\n\t\t    \n\t\t    // innerHTML += \"</li>\";\n\t\t});\n\t\tcontainerElement.appendChild(ulElement);\n\t\ttree.slip.setTocElem(containerElement);\n\t\t// innerHTML += \"</ul>\";\n\t    }\n\t    console.log(\"debug tree, will return\", containerElement);\n\t    // containerElement.addEventListener(\"click\", () => { console.log(stackWithNumbers);});\n\t    return containerElement;\n\t};\n\ttoc.innerHTML = \"\";\n\t// toc.innerHTML = innerHTML;\n\ttoc.appendChild(displayTree(tree, []));\n    };\n\n    // ******************************\n    // Function for writing and highlighting\n    // ******************************\n\n    this.getTool = () => {\n\treturn this.getCurrentSlip().getTool();\n    };\n    this.setTool = (tool) => {\n\tconsole.log(\"setting tool: \", tool);\n\tthis.getCurrentSlip().setTool(tool);\n\tthis.updateToolClasses();\n    };\n    this.getColor = () => {\n\treturn this.getCurrentSlip().getColor();\n    };\n    this.setColor = (color) => {\n\tconsole.log(\"setting color: \", color);\n\tthis.getCurrentSlip().setColor(color);\n\tthis.updateToolClasses();\n    };\n    this.setLineWidth = (lw) => {\n\tconsole.log(\"setting line width: \", lw);\n\tthis.getCurrentSlip().setLineWidth(lw);\n\tthis.updateToolClasses();\n    };\n    this.getLineWidth = () => {\n\tconsole.log(\"getting line width \");\n\treturn this.getCurrentSlip().getLineWidth();\n    };\n    this.reloadCanvas = () => {\n\tthis.getCurrentSlip().reloadCanvas();\n    };\n    let that = this;\n    function addToolEvents() {\n\tdocument.querySelector(\".slip-toolbar-pen\").addEventListener(\"click\", function(ev) {\n\t    that.setTool(\"drawing\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-cursor\").addEventListener(\"click\", function(ev) {\n\t    that.setTool(\"no-tool\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-eraser\").addEventListener(\"click\", function(ev) {\n\t    console.log(\"that.getTool\", that.getTool());\n\t    switch(that.getTool()) {\n\t    case \"drawing-erase\":\n\t\tthat.setTool(\"drawing\");\n\t\tbreak;\n\t    case \"highlighting\":\n\t\tthat.setTool(\"highlighting-erase\");\n\t\tbreak;\n\t    case \"highlighting-erase\":\n\t\tthat.setTool(\"highlighting\");\n\t\tbreak;\n\t    case \"no-tool\":\n\t\tthat.setTool(\"no-tool\");\n\t\tbreak;\n\t    case \"drawing\":\n\t\tthat.setTool(\"drawing-erase\");\n\t\tbreak;\n\t    }\n\t});\n\tdocument.querySelector(\".slip-toolbar-highlighter\").addEventListener(\"click\", function(ev) {\n\t    that.setTool(\"highlighting\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-black\").addEventListener(\"click\", function(ev) {\n\t    that.setColor(\"black\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-blue\").addEventListener(\"click\", function(ev) {\n\t    that.setColor(\"blue\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-red\").addEventListener(\"click\", function(ev) {\n\t    that.setColor(\"red\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-green\").addEventListener(\"click\", function(ev) {\n\t    that.setColor(\"green\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-yellow\").addEventListener(\"click\", function(ev) {\n\t    that.setColor(\"yellow\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-small\").addEventListener(\"click\", function(ev) {\n\t    that.setLineWidth(\"small\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-medium\").addEventListener(\"click\", function(ev) {\n\t    that.setLineWidth(\"medium\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-large\").addEventListener(\"click\", function(ev) {\n\t    that.setLineWidth(\"large\");\n\t});\n\tdocument.querySelector(\".slip-toolbar-clear\").addEventListener(\"click\", function(ev) {\n\t    that.setTool(\"clear-all\");\n\t});\n    }\n    this.updateToolClasses = () => {\n\tdocument.querySelector(\".slip-toolbar-tool\").classList.remove(\"drawing\",\"highlighting\", \"drawing-erase\", \"highlighting-erase\", \"no-tool\");\n\tif(this.getTool()==\"no-tool\" || this.getTool()==\"cursor\")\n\t    document.querySelector(\".slip-writing-toolbar\").classList.remove(\"active\");\n\telse\n\t    document.querySelector(\".slip-writing-toolbar\").classList.add(\"active\");\n\tdocument.querySelector(\".slip-toolbar-tool\").classList.add(this.getTool());\n\tdocument.querySelector(\".slip-toolbar-color\").classList.remove(\"black\",\"blue\", \"red\", \"green\", \"yellow\");\n\tdocument.querySelector(\".slip-toolbar-color\").classList.add(this.getColor());\n\tdocument.querySelector(\".slip-toolbar-width\").classList.remove(\"small\",\"medium\", \"large\");\n\tdocument.querySelector(\".slip-toolbar-width\").classList.add(this.getLineWidth());\n    };\n    setTimeout(addToolEvents, 0);\n\n    // ******************************\n    // \n    // ******************************\n\n\n    \n    // this.getRootSlip = () => rootSlip;\n    this.setRootSlip = (root) => {\n\trootSlip = root;\n\tstack = [rootSlip];\n    };\n    this.getRootSlip = () => rootSlip;\n    this.start = () => {\n\tstack = [rootSlip];\n\tthis.next();\n\treturn this;\n    };\n    this.restart = () => {\n\tstack = [rootSlip];\n\trootSlip.refreshAll();\n\tthis.next();\n    };\n    let controller = new Controller(this);\n    this.getController = () => controller;\n};\n","import './modules/slip-figure'\n\nimport IEngine from './modules/engine'\nimport IController from './modules/controller.mjs'\nimport ISlip from './modules/slip'\nimport * as IUtil from './modules/util'\n\n// import \"./css/slip.css\";\n// import \"./css/theorem.css\";\n\n/**\n * Allows slip-js to be used as a module\n */\nexport const Engine = IEngine;\nexport const Controller = IController;\nexport const Slip = ISlip;\nexport const Util = IUtil;\n\nexport let startSlipshow = () => {\n    let engine;\n    if(typeof MathJax != \"undefined\")\n\tMathJax.startup.promise.then(() => {\n\t    engine = new Engine(document.querySelector(\"slip-slipshow\")).start();\n\t});\n    else\n\tengine = new Engine(document.querySelector(\"slip-slipshow\")).start();\n    return engine;\n};\n\n/**\n * Allows slip-js to be used as simple CDN-included file\n */\n// window.Engine = IEngine;\n// window.Controller = IController;\n// window.Slip = ISlip;\n// window.Util = IUtil;\n"],"names":["SlipFigure","HTMLImageElement","observedAttributes","constructor","internalStep","img","maxStep","figureName","getAttribute","promise","preloadImages","then","updateSRC","preloadImage","i","Promise","resolve","reject","Image","onload","onerror","src","getURL","catch","connectedCallback","figureStep","step","attributeChangedCallback","name","oldValue","newValue","nextFigure","figuresStep","customElements","define","extends","myQueryAll","root","selector","avoid","id","Math","random","toString","substr","allElem","Array","from","querySelectorAll","separatedSelector","split","map","selec","join","other","filter","value","includes","window","cloneNoSubslip","elem","newElem","cloneNode","childNodes","forEach","child","tagName","placeholder","document","createElement","classList","add","appendChild","contains","console","log","replaceSubslips","clone","subslips","sketchpad","sketchpadHighlight","placeholders","subslip","index","replaceWith","sketchPlaceholder","ng","engine","getEngine","setEngine","activated","activate","deactivate","left_keys","right_keys","up_keys","down_keys","rotate_keys","unrotate_keys","zoom_keys","unzoom_keys","show_toc_keys","show_toc2_keys","next_keys","previous_keys","refresh_keys","change_speed_keys","up_slip_keys","draw_on_slip_keys","erase_on_slip_keys","highlight_on_slip_keys","erase_highlight_on_slip_keys","stop_writing_on_slip_keys","clear_annotations_keys","reload_canvas_keys","background_canvas_keys","speedMove","addEventListener","ev","key","getCurrentSlip","refresh","setTool","reloadCanvas","slip","style","zIndex","canvas","openWindowHeight","getOpenWindowHeight","openWindowWidth","getOpenWindowWidth","moveWindowRelative","showToC","querySelector","display","shiftKey","nextSlip","next","previousSlip","previous","pop","Point","x","y","set","Mouse","down","C","floodFillInterval","maxLineThickness","minLineThickness","lineThicknessRange","thicknessIncrement","minSmoothingFactor","initialSmoothingFactor","weightSpread","initialThickness","AtramentEventTarget","eventListeners","Map","eventName","handler","handlers","get","Set","removeEventListener","delete","dispatchEvent","data","exports","x1","y1","x2","y2","xs","pow","ys","sqrt","hexColor","m","match","parseInt","compR","compG","compB","compA","pixelPos","r","g","b","a","fillR","fillG","fillB","startColor","alpha","matcher","matchColor","require$$0","require$$1","DrawingMode","DRAW","ERASE","FILL","DISABLED","PathDrawingModes","Atrament","config","Error","Node","width","height","mouse","mouseMove","event","cancelable","preventDefault","rect","getBoundingClientRect","position","changedTouches","offsetX","offsetY","clientX","left","clientY","top","mode","newX","newY","draw","_dirty","fireDirty","mouseDown","fill","beginStroke","mouseUp","e","nx","ny","endStroke","destroy","clear","context","getContext","globalCompositeOperation","globalAlpha","strokeStyle","color","lineCap","lineJoin","translate","_filling","_fillStack","recordStrokes","strokeMemory","smoothing","Constants","_thickness","_targetThickness","_weight","_maxWeight","_mode","adaptiveStroke","undefined","beginPath","moveTo","push","closePath","stroke","points","slice","weight","prevX","prevY","rawDist","Pixels","lineDistance","smoothingFactor","min","procX","procY","dist","lineWidth","quadraticCurveTo","c","w","isDirty","clearRect","toImage","toDataURL","getImageData","setTimeout","_floodFill","_startX","_startY","startX","floor","startY","canvasWidth","canvasHeight","pixelStack","fillColor","hexToRgb","colorLayer","colorPixel","matchFillColor","length","newPos","reachLeft","reachRight","putImageData","shift","Slip","fullName","actionL","options","generateActionList","newActionList","queryAll","addSubSlips","setNthAction","actionList","setAction","getActionList","ret","getMaxNext","pauseSlipList","n","action","getCurrentSubSlip","getActionIndex","nextStageNeedGoto","getSubSlipList","actionIndex","setActionIndex","actionI","maxNext","maxTemp","attr","strMax","max","abs","sumArray","hasAttribute","reduce","quer","element","query","findSubslipByID","goodSubslip","find","findSlipCoordinate","coord","getCoordinateInUniverse","scale","centerX","updatePauseAncestors","remove","pause","parentElement","unpause","makeStatic","strID","makeUnStatic","moveDownTo","moveUpTo","moveCenterTo","executeScript","reveal","hide","figureID","focus","unfocus","incrPause","setAttribute","d","removeAttribute","doAttributes","hiddenAt","str","opacity","visibleAt","emphAt","unemphAt","visibAt","staticAt","goDownTo","goTo","toExec","toFigureNext","incrIndex","updateToC","savedActionIndex","savedDelay","currentDelay","setDoNotMove","savedClass","className","doRefresh","toReturn","getDoNotMove","gotoSlip","delay","setTocElem","tocElem","ToCList","firstVisit","init","refreshAll","subSlipList","clonedElement","sketchpadCanvas","sketchpadCanvasHighlight","currentX","currentY","visibility","moveToElement","Function","innerHTML","offset","offsetTop","moveWindow","rotate","offsetHeight","restoreWindow","revealAll","hideAll","tool","getTool","colorHighlight","getColor","setColor","lineWidthErase","lineWidthHighlight","getLineWidth","setLineWidth","parseFloat","isNaN","that","offsetWidth","firstChild","canvas2","q","MathJax","startup","getCloned","setCloned","generatePauseFlowSlipList","slipList","bla","s","prepareRoot","rootElem","container","slipElem","scaleContainer","slipContainer","fChild","layerX","layerY","body","cursor","timeOutIds","clearTimeout","openWindow","universe","slips","browserHeight","browserWidth","winX","winY","currentScale","currentRotate","getCoord","doNotMove","transitionDuration","transform","dx","dy","dscale","drotate","placeSlip","slipScaleContainer","placeSlips","depth","rootDepth","placeOpenWindow","innerHeight","innerWidth","right","bottom","transformOrigin","counterToString","num","result","decimal","roman","countersToString","counterList","res","updateCounter","counters","stack","enter","currentSlide","newCurrentSlip","currentSlip","newCurrentSlide","getCoordInParen","offsetLeft","globalScale","parseScale","getCoordIter","cInParent","offsetParent","centerY","cParent","getComputedStyle","actualSize","rootSlip","getToC","getSlipTree","function","goToState","state","iter","toc","globalElem","tree","displayTree","stackWithNumbers","containerElement","nameElement","innerText","ulElement","subtree","newStackWithNumbers","liElement","toCounter","concat","target","updateToolClasses","lw","addToolEvents","setRootSlip","getRootSlip","start","restart","controller","Controller","getController","Engine","IEngine","IController","ISlip","Util","IUtil","startSlipshow"],"mappings":";;;CAAA,MAAMA,UAAN,SAAyBC,gBAAzB,CAA0C;CACtC;CACA,aAAWC,kBAAX,GAAgC;CAAC,WAAO,CAAC,aAAD,CAAP;CAAyB;;CAE1DC,EAAAA,WAAW,GAAG;CACjB;CACA;;CACA,QAAI,OAAO,KAAKC,YAAZ,IAA6B,WAAjC,EAA8C;CACzC,WAAKA,YAAL,GAAoB,CAApB;CACJ;;CACD,SAAKC,GAAL,GAAW,EAAX;CACA,SAAKC,OAAL,GAAe,CAAf;CACA,SAAKC,UAAL,GAAkB,KAAKC,YAAL,CAAkB,aAAlB,CAAlB;CACA,SAAKC,OAAL,GAAe,KAAKC,aAAL,CAAmB,CAAnB,EAAsBC,IAAtB,CAA2B,MAAM;CAC5C,WAAKC,SAAL;CACH,KAFc,CAAf;CAGI;;CACDC,EAAAA,YAAY,CAACC,CAAD,EAAI;CACnB,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;CACpC,WAAKZ,GAAL,CAASS,CAAT,IAAc,IAAII,KAAJ,EAAd;;CACA,WAAKb,GAAL,CAASS,CAAT,EAAYK,MAAZ,GAAqB,MAAMH,OAAO,EAAlC;;CACA,WAAKX,GAAL,CAASS,CAAT,EAAYM,OAAZ,GAAsBH,MAAtB;CACA,WAAKZ,GAAL,CAASS,CAAT,EAAYO,GAAZ,GAAkB,KAAKC,MAAL,CAAYR,CAAZ,CAAlB;CACH,KALM,CAAP;CAMI;;CACDJ,EAAAA,aAAa,CAACI,CAAD,EAAI;CACpB,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;CACpC,WAAKJ,YAAL,CAAkBC,CAAlB,EAAqBH,IAArB,CAA0B,MAAK;CAClC,aAAKD,aAAL,CAAmBI,CAAC,GAAC,CAArB,EAAwBH,IAAxB,CAA6B,MAAM;CAAEK,UAAAA,OAAO;CAAK,SAAjD;CACI,OAFD,EAEGO,KAFH,CAES,MAAM;CAClB,aAAKjB,OAAL,GAAeQ,CAAC,GAAC,CAAjB;CACAE,QAAAA,OAAO;CACH,OALD;CAMH,KAPM,CAAP;CAQI;;CACDQ,EAAAA,iBAAiB,GAAG;;CAGpBF,EAAAA,MAAM,CAACR,CAAD,EAAI;CACb,WAAO,aAAW,KAAKP,UAAhB,GAA2B,GAA3B,GAA+B,KAAKA,UAApC,GAA+C,GAA/C,GAAmDO,CAAnD,GAAqD,MAA5D;CACI;;CACDF,EAAAA,SAAS,GAAG;CACf,SAAKS,GAAL,GAAW,KAAKC,MAAL,CAAY,KAAKG,UAAjB,CAAX;CACI;;CAED,MAAIA,UAAJ,CAAeC,IAAf,EAAqB;CACxB,SAAKjB,OAAL,GAAe,KAAKA,OAAL,CAAaE,IAAb,CAAkB,MAAM;CACnC,UAAGe,IAAI,GAAG,KAAKpB,OAAf,EACH,KAAKF,YAAL,GAAoB,KAAKE,OAAzB,CADG,KAEK,IAAIoB,IAAI,GAAG,CAAX,EACR,KAAKtB,YAAL,GAAoB,CAApB,CADQ,KAGR,KAAKA,YAAL,GAAkBsB,IAAlB;CACG,WAAKd,SAAL;CACH,KARc,CAAf;CASI;;CACD,MAAIa,UAAJ,GAAiB;CACpB,WAAO,KAAKrB,YAAZ;CACI;;CAEDuB,EAAAA,wBAAwB,CAACC,IAAD,EAAOC,QAAP,EAAiBC,QAAjB,EAA2B;CACtD,QAAGF,IAAI,IAAI,aAAX,EAA0B;CACtB,WAAKrB,UAAL,GAAkBuB,QAAlB;CACA,WAAKrB,OAAL,GAAe,KAAKA,OAAL,CAAaE,IAAb,CAAkB,MAAM;CAC1C,aAAKD,aAAL,CAAmB,CAAnB,EAAsBC,IAAtB,CAA2B,MAAM;CAC7B,eAAKC,SAAL;CACH,SAFD;CAGI,OAJc,CAAf;CAKH;CACG;;CACDmB,EAAAA,UAAU,GAAG;CAChB,SAAKC,WAAL;CACI;;CAxEqC;;CA2E1CC,cAAc,CAACC,MAAf,CAAsB,aAAtB,EAAqClC,UAArC,EAAiD;CAAEmC,EAAAA,OAAO,EAAE;CAAX,CAAjD;;CC3EO,IAAIC,UAAU,GAAG,CAACC,IAAD,EAAOC,QAAP,EAAiBC,KAAjB,KAA2B;CAC/CA,EAAAA,KAAK,GAAGA,KAAK,IAAI,WAAjB;CACA,MAAI,CAACF,IAAI,CAACG,EAAV,EACHH,IAAI,CAACG,EAAL,GAAU,MAAMC,IAAI,CAACC,MAAL,GAAcC,QAAd,CAAuB,EAAvB,EAA2BC,MAA3B,CAAkC,CAAlC,EAAqC,EAArC,CAAhB;CACG,MAAIC,OAAO,GAAGC,KAAK,CAACC,IAAN,CAAWV,IAAI,CAACW,gBAAL,CAAsBV,QAAtB,CAAX,CAAd;CACA,MAAIW,iBAAiB,GAAGX,QAAQ,CAACY,KAAT,CAAe,GAAf,EAAoBC,GAApB,CAAwBC,KAAK,IAAI,MAAIf,IAAI,CAACG,EAAT,GAAY,GAAZ,GAAkBD,KAAlB,GAA0B,GAA1B,GAAgCa,KAAjE,EAAwEC,IAAxE,EAAxB,CAL+C;;CAO/C,MAAIC,KAAK,GAAGR,KAAK,CAACC,IAAN,CAAWV,IAAI,CAACW,gBAAL,CAAsBC,iBAAtB,CAAX,CAAZ,CAP+C;;CAS/C,SAAOJ,OAAO,CAACU,MAAR,CAAeC,KAAK,IAAI,CAACF,KAAK,CAACG,QAAN,CAAeD,KAAf,CAAzB,CAAP;CACH,CAVM;CAWPE,MAAM,CAACtB,UAAP,GAAoBA,UAApB;CAEO,SAASuB,cAAT,CAAyBC,IAAzB,EAA+B;CAClC,MAAIC,OAAO,GAAGD,IAAI,CAACE,SAAL,CAAe,KAAf,CAAd;CACAF,EAAAA,IAAI,CAACG,UAAL,CAAgBC,OAAhB,CAAyBC,KAAD,IAAW;CACtC,QAAGA,KAAK,CAACC,OAAN,IAAiBD,KAAK,CAACC,OAAN,IAAiB,WAArC,EAAiD;CAC7C,UAAIC,WAAW,GAAGC,QAAQ,CAACC,aAAT,CAAuBJ,KAAK,CAACC,OAA7B,CAAlB;CACAC,MAAAA,WAAW,CAACG,SAAZ,CAAsBC,GAAtB,CAA0B,WAA1B;CACAV,MAAAA,OAAO,CAACW,WAAR,CAAoBL,WAApB;CACH,KAJD,MAKK,IAAGF,KAAK,CAACC,OAAN,IAAiBD,KAAK,CAACC,OAAN,IAAiB,QAAlC,IAA8CD,KAAK,CAACK,SAAN,CAAgBG,QAAhB,CAAyB,WAAzB,CAAjD,EAAuF;CACxF,UAAIN,WAAW,GAAGC,QAAQ,CAACC,aAAT,CAAuBJ,KAAK,CAACC,OAA7B,CAAlB;CACAC,MAAAA,WAAW,CAACG,SAAZ,CAAsBC,GAAtB,CAA0B,oBAA1B;CACAV,MAAAA,OAAO,CAACW,WAAR,CAAoBL,WAApB;CACH,KAJI,MAMDN,OAAO,CAACW,WAAR,CAAoBb,cAAc,CAACM,KAAD,CAAlC;CACA,GAbD;CAcA,MAAGJ,OAAO,CAACK,OAAR,IAAmB,WAAtB,EACHQ,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoCd,OAApC;CACG,SAAOA,OAAP;CACH;CACM,SAASe,eAAT,CAAyBC,KAAzB,EAAgCC,QAAhC,EAA0CC,SAA1C,EAAqDC,kBAArD,EAAyE;CAC5E,MAAIC,YAAY,GAAG7C,UAAU,CAACyC,KAAD,EAAQ,YAAR,CAA7B;CACAC,EAAAA,QAAQ,CAACd,OAAT,CAAiB,CAACkB,OAAD,EAAUC,KAAV,KAAoB;CACxCF,IAAAA,YAAY,CAACE,KAAD,CAAZ,CAAoBC,WAApB,CAAgCF,OAAhC;CACI,GAFD;CAGAR,EAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCvC,UAAU,CAACyC,KAAD,EAAQ,qBAAR,CAA/C;CACA,MAAIQ,iBAAiB,GAAGjD,UAAU,CAACyC,KAAD,EAAQ,qBAAR,CAAlC;CACA,MAAGQ,iBAAiB,CAAC,CAAD,CAApB,EACHA,iBAAiB,CAAC,CAAD,CAAjB,CAAqBD,WAArB,CAAiCL,SAAjC;CACG,MAAGM,iBAAiB,CAAC,CAAD,CAApB,EACHA,iBAAiB,CAAC,CAAD,CAAjB,CAAqBD,WAArB,CAAiCJ,kBAAjC;CACA;;;;;;;;;CC5CD;CAEe,sBAAUM,EAAV,EAAc;CACzB,MAAIC,MAAM,GAAGD,EAAb;;CACA,OAAKE,SAAL,GAAiB,MAAM,KAAKD,MAA5B;;CACA,OAAKE,SAAL,GAAkBH,EAAD,IAAQ,KAAKC,MAAL,GAAcD,EAAvC;;CAEA,MAAII,SAAS,GAAG,IAAhB;;CACA,OAAKC,QAAL,GAAgB,MAAM;CACzBD,IAAAA,SAAS,GAAG,IAAZ;CACI,GAFD;;CAGA,OAAKE,UAAL,GAAkB,MAAM;CAC3BF,IAAAA,SAAS,GAAG,KAAZ;CACI,GAFD;;CAIA,MAAIG,SAAS,GAAG,CAAC,GAAD,CAAhB;CAAA,MACHC,UAAU,GAAG,CAAC,GAAD,CADV;CAAA,MAEHC,OAAO,GAAG,CAAC,GAAD,CAFP;CAAA,MAGHC,SAAS,GAAG,CAAC,GAAD,CAHT;CAAA,MAIHC,WAAW,GAAG,CAAC,GAAD,CAJX;CAAA,MAKHC,aAAa,GAAG,CAAC,GAAD,CALb;CAAA,MAMHC,SAAS,GAAG,CAAC,GAAD,CANT;CAAA,MAOHC,WAAW,GAAG,CAAC,GAAD,CAPX;CAAA,MAQHC,aAAa,GAAG,CAAC,GAAD,CARb;CAAA,MASHC,cAAc,GAAG,CAAC,GAAD,CATd;CAAA,MAUHC,SAAS,GAAG,CAAC,YAAD,EAAe,WAAf,CAVT;CAAA,MAWHC,aAAa,GAAG,CAAC,WAAD,EAAc,SAAd,CAXb;CAAA,MAYHC,YAAY,GAAG,CAAC,GAAD,CAZZ;CAAA,MAaHC,iBAAiB,GAAG,CAAC,GAAD,CAbjB;CAAA,MAcHC,YAAY,GAAG,EAdZ;CAAA,MAeHC,iBAAiB,GAAG,CAAC,GAAD,CAfjB;CAAA,MAgBHC,kBAAkB,GAAG,CAAC,GAAD,CAhBlB;CAAA,MAiBHC,sBAAsB,GAAG,CAAC,GAAD,CAjBtB;CAAA,MAkBHC,4BAA4B,GAAG,CAAC,GAAD,CAlB5B;CAAA,MAmBHC,yBAAyB,GAAG,CAAC,GAAD,CAnBzB;CAAA,MAoBHC,sBAAsB,GAAG,CAAC,GAAD,CApBtB;CAAA,MAqBHC,kBAAkB,GAAG,CAAC,GAAD,CArBlB;CAAA,MAsBHC,sBAAsB,GAAG,CAAC,GAAD,CAtBtB,CAbyB;CAsCzB;CACA;CAEA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;;CACA,MAAIC,SAAS,GAAC,CAAd;CACAhD,EAAAA,QAAQ,CAACiD,gBAAT,CAA0B,UAA1B,EAAuCC,EAAD,IAAQ;CACjD,QAAGZ,iBAAiB,CAACjD,QAAlB,CAA2B6D,EAAE,CAACC,GAA9B,KAAsC7B,SAAzC,EAAoD;CAAE0B,MAAAA,SAAS,GAAG,CAACA,SAAS,GAAG,CAAb,IAAgB,EAAhB,GAAmB,CAA/B;CAAmC;;CACzF,QAAGX,YAAY,CAAChD,QAAb,CAAsB6D,EAAE,CAACC,GAAzB,KAAiC7B,SAApC,EAA+C;CAAEH,MAAAA,MAAM,CAACiC,cAAP,GAAwBC,OAAxB;CAAoC;;CACrF,QAAGb,iBAAiB,CAACnD,QAAlB,CAA2B6D,EAAE,CAACC,GAA9B,KAAsC7B,SAAzC,EAAoD;CAAEH,MAAAA,MAAM,CAACmC,OAAP,CAAe,SAAf;CAA4B;;CAClF,QAAGb,kBAAkB,CAACpD,QAAnB,CAA4B6D,EAAE,CAACC,GAA/B,KAAuC7B,SAA1C,EAAqD;CAAEH,MAAAA,MAAM,CAACmC,OAAP,CAAe,eAAf;CAAkC;;CACzF,QAAGZ,sBAAsB,CAACrD,QAAvB,CAAgC6D,EAAE,CAACC,GAAnC,KAA2C7B,SAA9C,EAAyD;CAAEH,MAAAA,MAAM,CAACmC,OAAP,CAAe,cAAf;CAAiC;;CAC5F,QAAGX,4BAA4B,CAACtD,QAA7B,CAAsC6D,EAAE,CAACC,GAAzC,KAAiD7B,SAApD,EAA+D;CAAEH,MAAAA,MAAM,CAACmC,OAAP,CAAe,oBAAf;CAAuC;;CACxG,QAAGV,yBAAyB,CAACvD,QAA1B,CAAmC6D,EAAE,CAACC,GAAtC,KAA8C7B,SAAjD,EAA4D;CAAEH,MAAAA,MAAM,CAACmC,OAAP,CAAe,SAAf;CAA4B;;CAC1F,QAAGT,sBAAsB,CAACxD,QAAvB,CAAgC6D,EAAE,CAACC,GAAnC,KAA2C7B,SAA9C,EAAyD;CAAEH,MAAAA,MAAM,CAACmC,OAAP,CAAe,WAAf;CAA8B;;CACzF,QAAGR,kBAAkB,CAACzD,QAAnB,CAA4B6D,EAAE,CAACC,GAA/B,KAAuC7B,SAA1C,EAAqD;CAAEH,MAAAA,MAAM,CAACoC,YAAP;CAAwB;;CAC/E,QAAGR,sBAAsB,CAAC1D,QAAvB,CAAgC6D,EAAE,CAACC,GAAnC,KAA2C7B,SAA9C,EAAyD;CACrDtB,MAAAA,QAAQ,CAACpB,gBAAT,CAA0B,WAA1B,EAAuCgB,OAAvC,CAAgD4D,IAAD,IAAU;CAACA,QAAAA,IAAI,CAACC,KAAL,CAAWC,MAAX,GAAoB,IAApB;CAA0B,OAApF;CACA1D,MAAAA,QAAQ,CAACpB,gBAAT,CAA0B,oBAA1B,EAAgDgB,OAAhD,CAAyD+D,MAAD,IAAY;CAACA,QAAAA,MAAM,CAACF,KAAP,CAAaC,MAAb,GAAsB,GAAtB;CAA2B,OAAhG;CACH;CACG,GAdD;CAeA1D,EAAAA,QAAQ,CAACiD,gBAAT,CAA0B,SAA1B,EAAsCC,EAAD,IAAQ;CAChD,QAAIU,gBAAgB,GAAGzC,MAAM,CAAC0C,mBAAP,EAAvB;CACA,QAAIC,eAAe,GAAG3C,MAAM,CAAC4C,kBAAP,EAAtB;;CACA,QAAGnC,SAAS,CAACvC,QAAV,CAAmB6D,EAAE,CAACC,GAAtB,KAA8B7B,SAAjC,EAA4C;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA2B,CAA3B,EAA0DhB,SAAD,GAAYY,gBAArE,EAAuF,CAAvF,EAA0F,CAA1F,EAA6F,GAA7F;CAAoG,KAHlG;;;CAIhD,QAAGjC,OAAO,CAACtC,QAAR,CAAiB6D,EAAE,CAACC,GAApB,KAA4B7B,SAA/B,EAA0C;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA2B,CAA3B,EAAwD,CAAEhB,SAAF,GAAaY,gBAArE,EAAuF,CAAvF,EAA0F,CAA1F,EAA6F,GAA7F;CAAoG,KAJhG;;;CAKhD,QAAGnC,SAAS,CAACpC,QAAV,CAAmB6D,EAAE,CAACC,GAAtB,KAA8B7B,SAAjC,EAA4C;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA0B,CAAEhB,SAAF,GAAac,eAAvC,EAAyD,CAAzD,EAAuF,CAAvF,EAA0F,CAA1F,EAA6F,GAA7F;CAAoG,KALlG;;;CAMhD,QAAGpC,UAAU,CAACrC,QAAX,CAAoB6D,EAAE,CAACC,GAAvB,KAA+B7B,SAAlC,EAA6C;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA4BhB,SAAD,GAAYc,eAAvC,EAAyD,CAAzD,EAAuF,CAAvF,EAA0F,CAA1F,EAA6F,GAA7F;CAAoG,KANnG;;;CAOhD,QAAGjC,WAAW,CAACxC,QAAZ,CAAqB6D,EAAE,CAACC,GAAxB,KAAgC7B,SAAnC,EAA8C;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA0B,CAA1B,EAA6B,CAA7B,EAAiC,CAAjC,EAAwC,CAAxC,EAA2C,GAA3C;CAAkD,KAPlD;;;CAQhD,QAAGlC,aAAa,CAACzC,QAAd,CAAuB6D,EAAE,CAACC,GAA1B,KAAkC7B,SAArC,EAAgD;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA0B,CAA1B,EAA6B,CAA7B,EAAiC,CAAjC,EAAuC,CAAC,CAAxC,EAA2C,GAA3C;CAAkD,KARpD;;;CAShD,QAAGjC,SAAS,CAAC1C,QAAV,CAAmB6D,EAAE,CAACC,GAAtB,KAA8B7B,SAAjC,EAA4C;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA0B,CAA1B,EAA6B,CAA7B,EAAiC,IAAjC,EAAwC,CAAxC,EAA2C,GAA3C;CAAkD,KAThD;;;CAUhD,QAAGhC,WAAW,CAAC3C,QAAZ,CAAqB6D,EAAE,CAACC,GAAxB,KAAgC7B,SAAnC,EAA8C;CAAEH,MAAAA,MAAM,CAAC6C,kBAAP,CAA0B,CAA1B,EAA6B,CAA7B,EAAgC,CAAC,IAAjC,EAAwC,CAAxC,EAA2C,GAA3C;CAAkD,KAVlD;;;CAWhD,QAAG/B,aAAa,CAAC5C,QAAd,CAAuB6D,EAAE,CAACC,GAA1B,KAAkC7B,SAArC,EAAgD;CAC5CH,MAAAA,MAAM,CAAC8C,OAAP,GAD4C;CAG/C;;CACD,QAAG/B,cAAc,CAAC7C,QAAf,CAAwB6D,EAAE,CAACC,GAA3B,KAAmC7B,SAAtC,EAAiD;CAC7C;CACAtB,MAAAA,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,EAAoCT,KAApC,CAA0CU,OAA1C,GAAoDnE,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,EAAoCT,KAApC,CAA0CU,OAA1C,IAAqD,MAArD,GAA8D,OAA9D,GAAwE,MAA5H;CACH;;CACD,QAAGhC,SAAS,CAAC9C,QAAV,CAAmB6D,EAAE,CAACC,GAAtB,KAA8B7B,SAAjC,EAA4C;CACxChB,MAAAA,OAAO,CAACC,GAAR,CAAY2C,EAAZ;CACA,UAAGA,EAAE,CAACkB,QAAN,EACHjD,MAAM,CAACkD,QAAP,GADG,KAGHlD,MAAM,CAACmD,IAAP;CACA,KAND,MAOK,IAAIlC,aAAa,CAAC/C,QAAd,CAAuB6D,EAAE,CAACC,GAA1B,KAAkC7B,SAAtC,EAAiD;CAClD,UAAG4B,EAAE,CAACkB,QAAN,EACHjD,MAAM,CAACoD,YAAP,GADG,KAGHpD,MAAM,CAACqD,QAAP;CACA,KALI,MAMA,IAAIjC,YAAY,CAAClD,QAAb,CAAsB6D,EAAE,CAACC,GAAzB,KAAiC7B,SAArC,EAAgD;CACjDH,MAAAA,MAAM,CAACsD,GAAP;CACH;CACG,GAnCD;CAoCH;;CCxGD;CACA,MAAMC,KAAN,CAAY;CACV3I,EAAAA,WAAW,CAAC4I,CAAD,EAAIC,CAAJ,EAAO;CAChB,SAAKD,CAAL,GAASA,CAAT;CACA,SAAKC,CAAL,GAASA,CAAT;CACD;;CAEDC,EAAAA,GAAG,CAACF,CAAD,EAAIC,CAAJ,EAAO;CACR,SAAKD,CAAL,GAASA,CAAT;CACA,SAAKC,CAAL,GAASA,CAAT;CACD;;CATS;;;CAaZ,MAAME,KAAN,SAAoBJ,KAApB,CAA0B;CACxB3I,EAAAA,WAAW,GAAG;CACZ,UAAM,CAAN,EAAS,CAAT;CACA,SAAKgJ,IAAL,GAAY,KAAZ;CACA,SAAKP,QAAL,GAAgB,IAAIE,KAAJ,CAAU,CAAV,EAAa,CAAb,CAAhB;CACD;;CALuB;;CAQ1B,SAAc,GAAG;CAAEI,EAAAA,KAAF;CAASJ,EAAAA;CAAT,CAAjB;;CCtBA,MAAMM,CAAC,GAAG,EAAV;CACAA,CAAC,CAACC,iBAAF,GAAsB,GAAtB;CACAD,CAAC,CAACE,gBAAF,GAAqB,EAArB;CACAF,CAAC,CAACG,gBAAF,GAAqB,CAArB;CACAH,CAAC,CAACI,kBAAF,GAAuBJ,CAAC,CAACE,gBAAF,GAAqBF,CAAC,CAACG,gBAA9C;CACAH,CAAC,CAACK,kBAAF,GAAuB,GAAvB;CACAL,CAAC,CAACM,kBAAF,GAAuB,IAAvB;CACAN,CAAC,CAACO,sBAAF,GAA2B,IAA3B;CACAP,CAAC,CAACQ,YAAF,GAAiB,EAAjB;CACAR,CAAC,CAACS,gBAAF,GAAqB,CAArB;CAEA,aAAc,GAAGT,CAAjB;;CCXA,MAAMU,mBAAN,CAA0B;CACxB3J,EAAAA,WAAW,GAAG;CACZ,SAAK4J,cAAL,GAAsB,IAAIC,GAAJ,EAAtB;CACD;;CAED3C,EAAAA,gBAAgB,CAAC4C,SAAD,EAAYC,OAAZ,EAAqB;CACnC,UAAMC,QAAQ,GAAG,KAAKJ,cAAL,CAAoBK,GAApB,CAAwBH,SAAxB,KAAsC,IAAII,GAAJ,EAAvD;CACAF,IAAAA,QAAQ,CAAC5F,GAAT,CAAa2F,OAAb;CACA,SAAKH,cAAL,CAAoBd,GAApB,CAAwBgB,SAAxB,EAAmCE,QAAnC;CACD;;CAEDG,EAAAA,mBAAmB,CAACL,SAAD,EAAYC,OAAZ,EAAqB;CACtC,UAAMC,QAAQ,GAAG,KAAKJ,cAAL,CAAoBK,GAApB,CAAwBH,SAAxB,CAAjB;CACA,QAAI,CAACE,QAAL,EAAe;CACfA,IAAAA,QAAQ,CAACI,MAAT,CAAgBL,OAAhB;CACD;;CAEDM,EAAAA,aAAa,CAACP,SAAD,EAAYQ,IAAZ,EAAkB;CAC7B,UAAMN,QAAQ,GAAG,KAAKJ,cAAL,CAAoBK,GAApB,CAAwBH,SAAxB,CAAjB;CACA,QAAI,CAACE,QAAL,EAAe;CACf,KAAC,GAAGA,QAAJ,EAAcnG,OAAd,CAAsBkG,OAAO,IAAIA,OAAO,CAACO,IAAD,CAAxC;CACD;;CArBuB;;CAwB1B,UAAc,GAAG;CAAEX,EAAAA;CAAF,CAAjB;;;;;;;CCxBAY,EAAAA,oBAAA,GAAuB,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,EAAaC,EAAb,KAAoB;;CAEzC,UAAMC,EAAE,GAAGtI,IAAI,CAACuI,GAAL,CAASH,EAAE,GAAGF,EAAd,EAAkB,CAAlB,CAAX;CACA,UAAMM,EAAE,GAAGxI,IAAI,CAACuI,GAAL,CAASF,EAAE,GAAGF,EAAd,EAAkB,CAAlB,CAAX;CACA,WAAOnI,IAAI,CAACyI,IAAL,CAAUH,EAAE,GAAGE,EAAf,CAAP;CACD,GALD;;CAOAP,EAAAA,gBAAA,GAAoBS,QAAD,IAAc;;CAE/B,UAAMC,CAAC,GAAGD,QAAQ,CAACE,KAAT,CAAe,2CAAf,CAAV;CACA,WAAO,CACLC,QAAQ,CAACF,CAAC,CAAC,CAAD,CAAF,EAAO,EAAP,CADH,EAELE,QAAQ,CAACF,CAAC,CAAC,CAAD,CAAF,EAAO,EAAP,CAFH,EAGLE,QAAQ,CAACF,CAAC,CAAC,CAAD,CAAF,EAAO,EAAP,CAHH,CAAP;CAKD,GARD;;CAUAV,EAAAA,kBAAA,GAAqB,CAACD,IAAD,EAAOc,KAAP,EAAcC,KAAd,EAAqBC,KAArB,EAA4BC,KAA5B,KAAuCC,QAAD,IAAc;;CAEvE,UAAMC,CAAC,GAAGnB,IAAI,CAACkB,QAAD,CAAd;CACA,UAAME,CAAC,GAAGpB,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAd;CACA,UAAMG,CAAC,GAAGrB,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAd;CACA,UAAMI,CAAC,GAAGtB,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAd;CAEA,WAAQC,CAAC,KAAKL,KAAN,IAAeM,CAAC,KAAKL,KAArB,IAA8BM,CAAC,KAAKL,KAApC,IAA6CM,CAAC,KAAKL,KAA3D;CACD,GARD;;CAUAhB,EAAAA,kBAAA,GAAqB,CAACD,IAAD,EAAOuB,KAAP,EAAcC,KAAd,EAAqBC,KAArB,EAA4BC,UAA5B,EAAwCC,KAAxC,KAAkD;CACrE,UAAMC,OAAO,GAAG3B,OAAO,CAAC4B,UAAR,CAAmB7B,IAAnB,EAAyB,GAAG0B,UAA5B,CAAhB;CAEA,WAAQR,QAAD,IAAc;;CAEnBlB,MAAAA,IAAI,CAACkB,QAAD,CAAJ,GAAiBK,KAAjB;CACAvB,MAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAJ,GAAqBM,KAArB;CACAxB,MAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAJ,GAAqBO,KAArB;CACAzB,MAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAJ,GAAqBS,KAArB;;CAEA,UAAI,CAACC,OAAO,CAACV,QAAQ,GAAG,CAAZ,CAAZ,EAA4B;CAC1BlB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAJ,GAAqBlB,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAJ,GAAqB,IAArB,GAA4BK,KAAK,GAAG,IAAzD;CACAvB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyBlB,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyB,IAAzB,GAAgCM,KAAK,GAAG,IAAjE;CACAxB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyBlB,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyB,IAAzB,GAAgCO,KAAK,GAAG,IAAjE;CACAzB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyBlB,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyB,IAAzB,GAAgCS,KAAK,GAAG,IAAjE;CACD;;CAED,UAAI,CAACC,OAAO,CAACV,QAAQ,GAAG,CAAZ,CAAZ,EAA4B;CAC1BlB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAJ,GAAqBlB,IAAI,CAACkB,QAAQ,GAAG,CAAZ,CAAJ,GAAqB,IAArB,GAA4BK,KAAK,GAAG,IAAzD;CACAvB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyBlB,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyB,IAAzB,GAAgCM,KAAK,GAAG,IAAjE;CACAxB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyBlB,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyB,IAAzB,GAAgCO,KAAK,GAAG,IAAjE;CACAzB,QAAAA,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyBlB,IAAI,CAACkB,QAAQ,GAAG,CAAX,GAAe,CAAhB,CAAJ,GAAyB,IAAzB,GAAgCS,KAAK,GAAG,IAAjE;CACD;CACF,KApBD;CAqBD,GAxBD;;;;;;;CC3BA,MAAM;CAAElD,SAAAA,OAAF;CAASJ,SAAAA;CAAT,IAAmByD,KAAzB;CAEA,MAAM;CAAEzC,uBAAAA;CAAF,IAA0B0C,MAAhC;CAGA,MAAMC,WAAW,GAAG;CAClBC,EAAAA,IAAI,EAAE,MADY;CAElBC,EAAAA,KAAK,EAAE,OAFW;CAGlBC,EAAAA,IAAI,EAAE,MAHY;CAIlBC,EAAAA,QAAQ,EAAE;CAJQ,CAApB;CAOA,MAAMC,gBAAgB,GAAG,CAACL,WAAW,CAACC,IAAb,EAAmBD,WAAW,CAACE,KAA/B,CAAzB;CAEA,YAAc,GAAG,MAAMI,QAAN,SAAuBjD,qBAAvB,CAA2C;CAC1D3J,EAAAA,WAAW,CAACmC,QAAD,EAAwB;CAAA,QAAb0K,MAAa,uEAAJ,EAAI;;CACjC,QAAI,OAAOtJ,MAAP,KAAkB,WAAtB,EAAmC;CACjC,YAAM,IAAIuJ,KAAJ,CAAU,4CAAV,CAAN;CACD;;CAED,YALiC;;CAQjC,QAAI3K,QAAQ,YAAYoB,MAAM,CAACwJ,IAA3B,IAAmC5K,QAAQ,CAAC4B,OAAT,KAAqB,QAA5D,EAAsE,KAAK6D,MAAL,GAAczF,QAAd,CAAtE,KACK,IAAI,OAAOA,QAAP,KAAoB,QAAxB,EAAkC,KAAKyF,MAAL,GAAc3D,QAAQ,CAACkE,aAAT,CAAuBhG,QAAvB,CAAd,CAAlC,KACA,MAAM,IAAI2K,KAAJ,2CAA6C3K,QAA7C,OAAN;CACL,QAAI,CAAC,KAAKyF,MAAV,EAAkB,MAAM,IAAIkF,KAAJ,CAAU,kBAAV,CAAN,CAXe;;CAcjC,SAAKlF,MAAL,CAAYoF,KAAZ,GAAoBH,MAAM,CAACG,KAAP,IAAgB,KAAKpF,MAAL,CAAYoF,KAAhD;CACA,SAAKpF,MAAL,CAAYqF,MAAZ,GAAqBJ,MAAM,CAACI,MAAP,IAAiB,KAAKrF,MAAL,CAAYqF,MAAlD,CAfiC;;CAkBjC,SAAKC,KAAL,GAAa,IAAInE,OAAJ,EAAb,CAlBiC;;CAqBjC,UAAMoE,SAAS,GAAIC,KAAD,IAAW;CAC3B,UAAIA,KAAK,CAACC,UAAV,EAAsB;CACpBD,QAAAA,KAAK,CAACE,cAAN;CACD;;CAED,YAAMC,IAAI,GAAG,KAAK3F,MAAL,CAAY4F,qBAAZ,EAAb;CACA,YAAMC,QAAQ,GAAGL,KAAK,CAACM,cAAN,IAAwBN,KAAK,CAACM,cAAN,CAAqB,CAArB,CAAxB,IAAmDN,KAApE;CACA,UAAIxE,CAAC,GAAG6E,QAAQ,CAACE,OAAjB;CACA,UAAI9E,CAAC,GAAG4E,QAAQ,CAACG,OAAjB;;CAEA,UAAI,OAAOhF,CAAP,KAAa,WAAjB,EAA8B;CAC5BA,QAAAA,CAAC,GAAG6E,QAAQ,CAACI,OAAT,GAAmBN,IAAI,CAACO,IAA5B;CACD;;CACD,UAAI,OAAOjF,CAAP,KAAa,WAAjB,EAA8B;CAC5BA,QAAAA,CAAC,GAAG4E,QAAQ,CAACM,OAAT,GAAmBR,IAAI,CAACS,GAA5B;CACD;;CAED,YAAM;CAAEd,QAAAA;CAAF,UAAY,IAAlB,CAjB2B;;CAmB3B,UAAIA,KAAK,CAAClE,IAAN,IAAc2D,gBAAgB,CAACrJ,QAAjB,CAA0B,KAAK2K,IAA/B,CAAlB,EAAwD;CACtD,cAAM;CAAErF,UAAAA,CAAC,EAAEsF,IAAL;CAAWrF,UAAAA,CAAC,EAAEsF;CAAd,YAAuB,KAAKC,IAAL,CAAUxF,CAAV,EAAaC,CAAb,EAAgBqE,KAAK,CAACzE,QAAN,CAAeG,CAA/B,EAAkCsE,KAAK,CAACzE,QAAN,CAAeI,CAAjD,CAA7B;;CAEA,YAAI,CAAC,KAAKwF,MAAN,IAAgB,KAAKJ,IAAL,KAAc3B,WAAW,CAACC,IAA1C,KAAmD3D,CAAC,KAAKsE,KAAK,CAACtE,CAAZ,IAAiBC,CAAC,KAAKqE,KAAK,CAACrE,CAAhF,CAAJ,EAAwF;CACtF,eAAKwF,MAAL,GAAc,IAAd;CACA,eAAKC,SAAL;CACD;;CAEDpB,QAAAA,KAAK,CAACpE,GAAN,CAAUF,CAAV,EAAaC,CAAb;CACAqE,QAAAA,KAAK,CAACzE,QAAN,CAAeK,GAAf,CAAmBoF,IAAnB,EAAyBC,IAAzB;CACD,OAVD,MAWK;CACHjB,QAAAA,KAAK,CAACpE,GAAN,CAAUF,CAAV,EAAaC,CAAb;CACD;CACF,KAjCD,CArBiC;;;CAyDjC,UAAM0F,SAAS,GAAInB,KAAD,IAAW;CAC3B,UAAIA,KAAK,CAACC,UAAV,EAAsB;CACpBD,QAAAA,KAAK,CAACE,cAAN;CACD,OAH0B;;;CAK3BH,MAAAA,SAAS,CAACC,KAAD,CAAT,CAL2B;;CAQ3B,UAAI,KAAKa,IAAL,KAAc3B,WAAW,CAACG,IAA9B,EAAoC;CAClC,aAAK+B,IAAL;CACA;CACD,OAX0B;;;CAa3B,YAAM;CAAEtB,QAAAA;CAAF,UAAY,IAAlB;CACAA,MAAAA,KAAK,CAACzE,QAAN,CAAeK,GAAf,CAAmBoE,KAAK,CAACtE,CAAzB,EAA4BsE,KAAK,CAACrE,CAAlC;CACAqE,MAAAA,KAAK,CAAClE,IAAN,GAAa,IAAb;CAEA,WAAKyF,WAAL,CAAiBvB,KAAK,CAACzE,QAAN,CAAeG,CAAhC,EAAmCsE,KAAK,CAACzE,QAAN,CAAeI,CAAlD;CACD,KAlBD;;CAoBA,UAAM6F,OAAO,GAAIC,CAAD,IAAO;CACrB,UAAI,KAAKV,IAAL,KAAc3B,WAAW,CAACG,IAA9B,EAAoC;CAClC;CACD;;CAED,YAAM;CAAES,QAAAA;CAAF,UAAY,IAAlB;;CAEA,UAAI,CAACA,KAAK,CAAClE,IAAX,EAAiB;CACf;CACD;;CAED,YAAMyE,QAAQ,GAAGkB,CAAC,CAACjB,cAAF,IAAoBiB,CAAC,CAACjB,cAAF,CAAiB,CAAjB,CAApB,IAA2CiB,CAA5D;CACA,YAAM/F,CAAC,GAAG6E,QAAQ,CAACE,OAAnB;CACA,YAAM9E,CAAC,GAAG4E,QAAQ,CAACG,OAAnB;CACAV,MAAAA,KAAK,CAAClE,IAAN,GAAa,KAAb;;CAEA,UAAIkE,KAAK,CAACtE,CAAN,KAAYA,CAAZ,IAAiBsE,KAAK,CAACrE,CAAN,KAAYA,CAA7B,IAAkC8D,gBAAgB,CAACrJ,QAAjB,CAA0B,KAAK2K,IAA/B,CAAtC,EAA4E;CAC1E,cAAM;CAAErF,UAAAA,CAAC,EAAEgG,EAAL;CAAS/F,UAAAA,CAAC,EAAEgG;CAAZ,YAAmB,KAAKT,IAAL,CAAUlB,KAAK,CAACtE,CAAhB,EAAmBsE,KAAK,CAACrE,CAAzB,EAA4BqE,KAAK,CAACzE,QAAN,CAAeG,CAA3C,EAA8CsE,KAAK,CAACzE,QAAN,CAAeI,CAA7D,CAAzB;CACAqE,QAAAA,KAAK,CAACzE,QAAN,CAAeK,GAAf,CAAmB8F,EAAnB,EAAuBC,EAAvB;CACD;;CAED,WAAKC,SAAL,CAAe5B,KAAK,CAACtE,CAArB,EAAwBsE,KAAK,CAACrE,CAA9B;CACD,KAtBD,CA7EiC;;;CAsGjC,SAAKjB,MAAL,CAAYV,gBAAZ,CAA6B,WAA7B,EAA0CiG,SAA1C;CACA,SAAKvF,MAAL,CAAYV,gBAAZ,CAA6B,WAA7B,EAA0CqH,SAA1C;CACAtK,IAAAA,QAAQ,CAACiD,gBAAT,CAA0B,SAA1B,EAAqCwH,OAArC;CACA,SAAK9G,MAAL,CAAYV,gBAAZ,CAA6B,YAA7B,EAA2CqH,SAA3C;CACA,SAAK3G,MAAL,CAAYV,gBAAZ,CAA6B,UAA7B,EAAyCwH,OAAzC;CACA,SAAK9G,MAAL,CAAYV,gBAAZ,CAA6B,WAA7B,EAA0CiG,SAA1C,EA3GiC;;CA8GjC,SAAK4B,OAAL,GAAe,MAAM;CACnB,WAAKC,KAAL;CACA,WAAKpH,MAAL,CAAYuC,mBAAZ,CAAgC,WAAhC,EAA6CgD,SAA7C;CACA,WAAKvF,MAAL,CAAYuC,mBAAZ,CAAgC,WAAhC,EAA6CoE,SAA7C;CACAtK,MAAAA,QAAQ,CAACkG,mBAAT,CAA6B,SAA7B,EAAwCuE,OAAxC;CACA,WAAK9G,MAAL,CAAYuC,mBAAZ,CAAgC,YAAhC,EAA8CoE,SAA9C;CACA,WAAK3G,MAAL,CAAYuC,mBAAZ,CAAgC,UAAhC,EAA4CuE,OAA5C;CACA,WAAK9G,MAAL,CAAYuC,mBAAZ,CAAgC,WAAhC,EAA6CgD,SAA7C;CACD,KARD,CA9GiC;;;CAyHjC,SAAK8B,OAAL,GAAe,KAAKrH,MAAL,CAAYsH,UAAZ,CAAuB,IAAvB,CAAf;CACA,SAAKD,OAAL,CAAaE,wBAAb,GAAwC,aAAxC;CACA,SAAKF,OAAL,CAAaG,WAAb,GAA2B,CAA3B;CACA,SAAKH,OAAL,CAAaI,WAAb,GAA2BxC,MAAM,CAACyC,KAAP,IAAgB,eAA3C;CACA,SAAKL,OAAL,CAAaM,OAAb,GAAuB,OAAvB;CACA,SAAKN,OAAL,CAAaO,QAAb,GAAwB,OAAxB;CACA,SAAKP,OAAL,CAAaQ,SAAb,CAAuB,GAAvB,EAA4B,GAA5B;CAEA,SAAKC,QAAL,GAAgB,KAAhB;CACA,SAAKC,UAAL,GAAkB,EAAlB,CAlIiC;;CAqIjC,SAAKC,aAAL,GAAqB,KAArB;CACA,SAAKC,YAAL,GAAoB,EAApB;CAEA,SAAKC,SAAL,GAAiBC,SAAS,CAACvG,sBAA3B;CACA,SAAKwG,UAAL,GAAkBD,SAAS,CAACrG,gBAA5B;CACA,SAAKuG,gBAAL,GAAwB,KAAKD,UAA7B;CACA,SAAKE,OAAL,GAAe,KAAKF,UAApB;CACA,SAAKG,UAAL,GAAkB,KAAKH,UAAL,GAAkBD,SAAS,CAACtG,YAA9C;CAEA,SAAK2G,KAAL,GAAa9D,WAAW,CAACC,IAAzB;CACA,SAAK8D,cAAL,GAAsB,IAAtB,CA/IiC;;CAkJjC,KAAC,QAAD,EAAW,WAAX,EAAwB,gBAAxB,EAA0C,MAA1C,EACGxM,OADH,CACWuD,GAAG,IAAIyF,MAAM,CAACzF,GAAD,CAAN,KAAgBkJ,SAAhB,GAA4B,CAA5B,GAAgC,KAAKlJ,GAAL,IAAYyF,MAAM,CAACzF,GAAD,CADpE;CAED;;;;;;;;;CAQDqH,EAAAA,WAAW,CAAC7F,CAAD,EAAIC,CAAJ,EAAO;CAChB,SAAKoG,OAAL,CAAasB,SAAb;CACA,SAAKtB,OAAL,CAAauB,MAAb,CAAoB5H,CAApB,EAAuBC,CAAvB;;CAEA,QAAI,KAAK+G,aAAT,EAAwB;CACtB,WAAKC,YAAL,CAAkBY,IAAlB,CAAuB,IAAI9H,OAAJ,CAAUC,CAAV,EAAaC,CAAb,CAAvB;CACD;;CACD,SAAKwB,aAAL,CAAmB,aAAnB,EAAkC;CAAEzB,MAAAA,CAAF;CAAKC,MAAAA;CAAL,KAAlC;CACD;;;;;;;;;CAQDiG,EAAAA,SAAS,CAAClG,CAAD,EAAIC,CAAJ,EAAO;CACd,SAAKoG,OAAL,CAAayB,SAAb;;CAEA,QAAI,KAAKd,aAAT,EAAwB;CACtB,WAAKC,YAAL,CAAkBY,IAAlB,CAAuB,IAAI9H,OAAJ,CAAUC,CAAV,EAAaC,CAAb,CAAvB;CACD;;CACD,SAAKwB,aAAL,CAAmB,WAAnB,EAAgC;CAAEzB,MAAAA,CAAF;CAAKC,MAAAA;CAAL,KAAhC;;CAEA,QAAI,KAAK+G,aAAT,EAAwB;CACtB,YAAMe,MAAM,GAAG;CACbC,QAAAA,MAAM,EAAE,KAAKf,YAAL,CAAkBgB,KAAlB,EADK;CAEb5C,QAAAA,IAAI,EAAE,KAAKA,IAFE;CAGb6C,QAAAA,MAAM,EAAE,KAAKA,MAHA;CAIbhB,QAAAA,SAAS,EAAE,KAAKA,SAJH;CAKbR,QAAAA,KAAK,EAAE,KAAKA,KALC;CAMbe,QAAAA,cAAc,EAAE,KAAKA;CANR,OAAf;CASA,WAAKhG,aAAL,CAAmB,gBAAnB,EAAqC;CAAEsG,QAAAA;CAAF,OAArC;CACD;;CACD,SAAKd,YAAL,GAAoB,EAApB;CACD;;;;;;;;;;;;CAWDzB,EAAAA,IAAI,CAACxF,CAAD,EAAIC,CAAJ,EAAOkI,KAAP,EAAcC,KAAd,EAAqB;CACvB,QAAI,KAAKpB,aAAT,EAAwB;CACtB,WAAKC,YAAL,CAAkBY,IAAlB,CAAuB,IAAI9H,OAAJ,CAAUC,CAAV,EAAaC,CAAb,CAAvB;CACD;;CAED,UAAM;CAAEoG,MAAAA;CAAF,QAAc,IAApB,CALuB;;CAOvB,UAAMgC,OAAO,GAAGC,MAAM,CAACC,YAAP,CAAoBvI,CAApB,EAAuBC,CAAvB,EAA0BkI,KAA1B,EAAiCC,KAAjC,CAAhB,CAPuB;;;;;CAavB,UAAMI,eAAe,GAAG9O,IAAI,CAAC+O,GAAL,CAAStB,SAAS,CAACxG,kBAAnB,EAAuC,KAAKuG,SAAL,GAAiB,CAACmB,OAAO,GAAG,EAAX,IAAiB,IAAzE,CAAxB,CAbuB;;CAgBvB,UAAMK,KAAK,GAAG1I,CAAC,GAAG,CAACA,CAAC,GAAGmI,KAAL,IAAcK,eAAhC;CACA,UAAMG,KAAK,GAAG1I,CAAC,GAAG,CAACA,CAAC,GAAGmI,KAAL,IAAcI,eAAhC,CAjBuB;;CAoBvB,UAAMI,IAAI,GAAGN,MAAM,CAACC,YAAP,CAAoBG,KAApB,EAA2BC,KAA3B,EAAkCR,KAAlC,EAAyCC,KAAzC,CAAb;;CAEA,QAAI,KAAKX,cAAT,EAAyB;;CAEvB,WAAKJ,gBAAL,GAAwB,CAACuB,IAAI,GAAGzB,SAAS,CAAC3G,gBAAlB,IACpB2G,SAAS,CAAC1G,kBADU,IACY,KAAK8G,UAAL,GAAkB,KAAKD,OADnC,IAC8C,KAAKA,OAD3E,CAFuB;;CAKvB,UAAI,KAAKF,UAAL,GAAkB,KAAKC,gBAA3B,EAA6C;CAC3C,aAAKD,UAAL,IAAmBD,SAAS,CAACzG,kBAA7B;CACD,OAFD,MAGK,IAAI,KAAK0G,UAAL,GAAkB,KAAKC,gBAA3B,EAA6C;CAChD,aAAKD,UAAL,IAAmBD,SAAS,CAACzG,kBAA7B;CACD,OAVsB;;;CAYvB2F,MAAAA,OAAO,CAACwC,SAAR,GAAoB,KAAKzB,UAAzB;CACD,KAbD,MAcK;;CAEHf,MAAAA,OAAO,CAACwC,SAAR,GAAoB,KAAKvB,OAAzB;CACD,KAvCsB;;;CA0CvBjB,IAAAA,OAAO,CAACyC,gBAAR,CAAyBX,KAAzB,EAAgCC,KAAhC,EAAuCM,KAAvC,EAA8CC,KAA9C;CACAtC,IAAAA,OAAO,CAAC0B,MAAR;CAEA,WAAO;CAAE/H,MAAAA,CAAC,EAAE0I,KAAL;CAAYzI,MAAAA,CAAC,EAAE0I;CAAf,KAAP;CACD;;CAED,MAAIjC,KAAJ,GAAY;CACV,WAAO,KAAKL,OAAL,CAAaI,WAApB;CACD;;CAED,MAAIC,KAAJ,CAAUqC,CAAV,EAAa;CACX,QAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,MAAM,IAAI7E,KAAJ,CAAU,qBAAV,CAAN;CAC3B,SAAKmC,OAAL,CAAaI,WAAb,GAA2BsC,CAA3B;CACD;;CAED,MAAIb,MAAJ,GAAa;CACX,WAAO,KAAKZ,OAAZ;CACD;;CAED,MAAIY,MAAJ,CAAWc,CAAX,EAAc;CACZ,QAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,MAAM,IAAI9E,KAAJ,CAAU,qBAAV,CAAN;CAC3B,SAAKoD,OAAL,GAAe0B,CAAf;CACA,SAAK5B,UAAL,GAAkB4B,CAAlB;CACA,SAAK3B,gBAAL,GAAwB2B,CAAxB;CACA,SAAKzB,UAAL,GAAkByB,CAAC,GAAG7B,SAAS,CAACtG,YAAhC;CACD;;CAED,MAAIwE,IAAJ,GAAW;CACT,WAAO,KAAKmC,KAAZ;CACD;;CAED,MAAInC,IAAJ,CAAShD,CAAT,EAAY;CACV,QAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,MAAM,IAAI6B,KAAJ,CAAU,qBAAV,CAAN;;CAC3B,YAAQ7B,CAAR;CACE,WAAKqB,WAAW,CAACE,KAAjB;CACE,aAAK4D,KAAL,GAAa9D,WAAW,CAACE,KAAzB;CACA,aAAKyC,OAAL,CAAaE,wBAAb,GAAwC,iBAAxC;CACA;;CACF,WAAK7C,WAAW,CAACG,IAAjB;CACE,aAAK2D,KAAL,GAAa9D,WAAW,CAACG,IAAzB;CACA,aAAKwC,OAAL,CAAaE,wBAAb,GAAwC,aAAxC;CACA;;CACF,WAAK7C,WAAW,CAACI,QAAjB;CACE,aAAK0D,KAAL,GAAa9D,WAAW,CAACI,QAAzB;CACA;;CACF;CACE,aAAK0D,KAAL,GAAa9D,WAAW,CAACC,IAAzB;CACA,aAAK0C,OAAL,CAAaE,wBAAb,GAAwC,aAAxC;CACA;CAfJ;CAiBD;;CAED0C,EAAAA,OAAO,GAAG;CACR,WAAO,CAAC,CAAC,KAAKxD,MAAd;CACD;;CAEDC,EAAAA,SAAS,GAAG;CACV,SAAKjE,aAAL,CAAmB,OAAnB;CACD;;CAED2E,EAAAA,KAAK,GAAG;CACN,QAAI,CAAC,KAAK6C,OAAV,EAAmB;CACjB;CACD;;CAED,SAAKxD,MAAL,GAAc,KAAd;CACA,SAAKhE,aAAL,CAAmB,OAAnB,EANM;;CASN,QAAI,KAAK4D,IAAL,KAAc3B,WAAW,CAACE,KAA9B,EAAqC;CACnC,WAAKyB,IAAL,GAAY3B,WAAW,CAACC,IAAxB;CACA,WAAK0C,OAAL,CAAa6C,SAAb,CAAuB,CAAC,EAAxB,EAA4B,CAAC,EAA7B,EAAiC,KAAKlK,MAAL,CAAYoF,KAAZ,GAAoB,EAArD,EAAyD,KAAKpF,MAAL,CAAYqF,MAAZ,GAAqB,EAA9E;CACA,WAAKgB,IAAL,GAAY3B,WAAW,CAACE,KAAxB;CACD,KAJD,MAKK;CACH,WAAKyC,OAAL,CAAa6C,SAAb,CAAuB,CAAC,EAAxB,EAA4B,CAAC,EAA7B,EAAiC,KAAKlK,MAAL,CAAYoF,KAAZ,GAAoB,EAArD,EAAyD,KAAKpF,MAAL,CAAYqF,MAAZ,GAAqB,EAA9E;CACD;CACF;;CAED8E,EAAAA,OAAO,GAAG;CACR,WAAO,KAAKnK,MAAL,CAAYoK,SAAZ,EAAP;CACD;;CAEDxD,EAAAA,IAAI,GAAG;CACL,UAAM;CAAEtB,MAAAA;CAAF,QAAY,IAAlB;CACA,UAAM;CAAE+B,MAAAA;CAAF,QAAc,IAApB,CAFK;;CAIL,UAAMjD,UAAU,GAAGrJ,KAAK,CAACC,IAAN,CAAWqM,OAAO,CAACgD,YAAR,CAAqB/E,KAAK,CAACtE,CAA3B,EAA8BsE,KAAK,CAACrE,CAApC,EAAuC,CAAvC,EAA0C,CAA1C,EAA6CyB,IAAxD,CAAnB;;CAEA,QAAI,CAAC,KAAKoF,QAAV,EAAoB;CAClB,YAAM;CAAE9G,QAAAA,CAAF;CAAKC,QAAAA;CAAL,UAAWqE,KAAjB;CACA,WAAK7C,aAAL,CAAmB,WAAnB,EAAgC;CAAEzB,QAAAA,CAAF;CAAKC,QAAAA;CAAL,OAAhC;CACA,WAAK6G,QAAL,GAAgB,IAAhB;CACAwC,MAAAA,UAAU,CAAC,MAAM;CAAE,aAAKC,UAAL,CAAgBjF,KAAK,CAACtE,CAAtB,EAAyBsE,KAAK,CAACrE,CAA/B,EAAkCmD,UAAlC;CAAgD,OAAzD,EAA2D+D,SAAS,CAAC7G,iBAArE,CAAV;CACD,KALD,MAMK;CACH,WAAKyG,UAAL,CAAgBc,IAAhB,CAAqB,CACnBvD,KAAK,CAACtE,CADa,EAEnBsE,KAAK,CAACrE,CAFa,EAGnBmD,UAHmB,CAArB;CAKD;CACF;;CAEDmG,EAAAA,UAAU,CAACC,OAAD,EAAUC,OAAV,EAAmBrG,UAAnB,EAA+B;CACvC,UAAM;CAAEiD,MAAAA;CAAF,QAAc,IAApB;CACA,UAAMqD,MAAM,GAAGhQ,IAAI,CAACiQ,KAAL,CAAWH,OAAX,CAAf;CACA,UAAMI,MAAM,GAAGlQ,IAAI,CAACiQ,KAAL,CAAWF,OAAX,CAAf;CACA,UAAMI,WAAW,GAAGxD,OAAO,CAACrH,MAAR,CAAeoF,KAAnC;CACA,UAAM0F,YAAY,GAAGzD,OAAO,CAACrH,MAAR,CAAeqF,MAApC;CACA,UAAM0F,UAAU,GAAG,CAAC,CAACL,MAAD,EAASE,MAAT,CAAD,CAAnB,CANuC;;CAQvC,UAAMI,SAAS,GAAG1B,MAAM,CAAC2B,QAAP,CAAgB,KAAKvD,KAArB,CAAlB,CARuC;;CAUvC,UAAMwD,UAAU,GAAG7D,OAAO,CAACgD,YAAR,CAAqB,CAArB,EAAwB,CAAxB,EAA2BhD,OAAO,CAACrH,MAAR,CAAeoF,KAA1C,EAAiDiC,OAAO,CAACrH,MAAR,CAAeqF,MAAhE,CAAnB;CACA,UAAMhB,KAAK,GAAG3J,IAAI,CAAC+O,GAAL,CAASpC,OAAO,CAACG,WAAR,GAAsB,EAAtB,GAA2B,GAApC,EAAyC,GAAzC,CAAd;CACA,UAAM2D,UAAU,GAAG7B,MAAM,CAAC6B,UAAP,CAAkBD,UAAU,CAACxI,IAA7B,EAAmC,GAAGsI,SAAtC,EAAiD5G,UAAjD,EAA6DC,KAA7D,CAAnB;CACA,UAAME,UAAU,GAAG+E,MAAM,CAAC/E,UAAP,CAAkB2G,UAAU,CAACxI,IAA7B,EAAmC,GAAG0B,UAAtC,CAAnB;CACA,UAAMgH,cAAc,GAAG9B,MAAM,CAAC/E,UAAP,CAAkB2G,UAAU,CAACxI,IAA7B,EAAmC,GAAG,CAAC,GAAGsI,SAAJ,EAAe,GAAf,CAAtC,CAAvB,CAduC;;CAiBvC,QAAII,cAAc,CAAC,CAACR,MAAM,GAAGvD,OAAO,CAACrH,MAAR,CAAeoF,KAAxB,GAAgCsF,MAAjC,IAA2C,CAA5C,CAAlB,EAAkE;CAChE,WAAK5C,QAAL,GAAgB,KAAhB;CACA,WAAKrF,aAAL,CAAmB,SAAnB,EAA8B,EAA9B;CACA;CACD;;CAED,WAAOsI,UAAU,CAACM,MAAlB,EAA0B;CACxB,YAAMC,MAAM,GAAGP,UAAU,CAACjK,GAAX,EAAf;CACA,YAAME,CAAC,GAAGsK,MAAM,CAAC,CAAD,CAAhB;CACA,UAAIrK,CAAC,GAAGqK,MAAM,CAAC,CAAD,CAAd;CAEA,UAAI1H,QAAQ,GAAG,CAAC3C,CAAC,GAAG4J,WAAJ,GAAkB7J,CAAnB,IAAwB,CAAvC;;CAEA,aAAOC,CAAC,MAAM,CAAP,IAAYsD,UAAU,CAACX,QAAD,CAA7B,EAAyC;CACvCA,QAAAA,QAAQ,IAAIiH,WAAW,GAAG,CAA1B;CACD;;CACDjH,MAAAA,QAAQ,IAAIiH,WAAW,GAAG,CAA1B;CAEA,QAAE5J,CAAF;CAEA,UAAIsK,SAAS,GAAG,KAAhB;CACA,UAAIC,UAAU,GAAG,KAAjB;;CAEA,aAAOvK,CAAC,KAAK6J,YAAY,GAAG,CAArB,IAA0BvG,UAAU,CAACX,QAAD,CAA3C,EAAuD;CACrDuH,QAAAA,UAAU,CAACvH,QAAD,CAAV;;CAEA,YAAI5C,CAAC,GAAG,CAAR,EAAW;CACT,cAAIuD,UAAU,CAACX,QAAQ,GAAG,CAAZ,CAAd,EAA8B;CAC5B,gBAAI,CAAC2H,SAAL,EAAgB;CACdR,cAAAA,UAAU,CAAClC,IAAX,CAAgB,CAAC7H,CAAC,GAAG,CAAL,EAAQC,CAAR,CAAhB;CACAsK,cAAAA,SAAS,GAAG,IAAZ;CACD;CACF,WALD,MAMK,IAAIA,SAAJ,EAAe;CAClBA,YAAAA,SAAS,GAAG,KAAZ;CACD;CACF;;CAED,YAAIvK,CAAC,GAAG6J,WAAW,GAAG,CAAtB,EAAyB;CACvB,cAAItG,UAAU,CAACX,QAAQ,GAAG,CAAZ,CAAd,EAA8B;CAC5B,gBAAI,CAAC4H,UAAL,EAAiB;CACfT,cAAAA,UAAU,CAAClC,IAAX,CAAgB,CAAC7H,CAAC,GAAG,CAAL,EAAQC,CAAR,CAAhB;CACAuK,cAAAA,UAAU,GAAG,IAAb;CACD;CACF,WALD,MAMK,IAAIA,UAAJ,EAAgB;CACnBA,YAAAA,UAAU,GAAG,KAAb;CACD;CACF;;CAED5H,QAAAA,QAAQ,IAAIiH,WAAW,GAAG,CAA1B;CACD;CACF,KArEsC;;;CAwEvCxD,IAAAA,OAAO,CAACoE,YAAR,CAAqBP,UAArB,EAAiC,CAAjC,EAAoC,CAApC;;CAEA,QAAI,KAAKnD,UAAL,CAAgBsD,MAApB,EAA4B;CAC1B,WAAKd,UAAL,CAAgB,GAAG,KAAKxC,UAAL,CAAgB2D,KAAhB,EAAnB;CACD,KAFD,MAGK;CACH,WAAK5D,QAAL,GAAgB,KAAhB;CACA,WAAKrF,aAAL,CAAmB,SAAnB,EAA8B,EAA9B;CACD;CACF;;CAhbyD,CAA5D;;CCdA,cAAc,GAAG+B,QAAjB;;CCEe,SAASmH,IAAT,CAAc9R,IAAd,EAAoB+R,QAApB,EAA8BC,OAA9B,EAAuCtO,EAAvC,EAA2CuO,OAA3C,EAAoD;CAE/D;CACA;CACA;CAEA,OAAKC,kBAAL,GAA0B,YAAW;CACxCpP,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwC,KAAK/C,IAA7C;CACA,QAAImS,aAAa,GAAG,EAApB;CACA,SAAKC,QAAL,CAAc,qBAAd,EAAqChQ,OAArC,CAA8C4D,IAAD,IAAU;CACnDlD,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BiD,IAA9B,EAAoC,IAApC,EAA0C,IAA1C,EAAgDtC,EAAhD,EAAoD,EAApD;CACAyO,MAAAA,aAAa,CAACnM,IAAI,CAACpH,YAAL,CAAkB,UAAlB,CAAD,CAAb,GAA+C,IAAIkT,IAAJ,CAAS9L,IAAT,EAAe,EAAf,EAAmB,EAAnB,EAAuBtC,EAAvB,EAA2B,EAA3B,CAA/C;CACH,KAHD;CAIA,WAAOyO,aAAP;CACI,GARD;;CASA,OAAKE,WAAL,GAAmB,YAAW;CACjCvP,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwC,KAAK/C,IAA7C;CACA,QAAImS,aAAa,GAAG,EAApB;CACA,SAAKC,QAAL,CAAc,qBAAd,EAAqChQ,OAArC,CAA8C4D,IAAD,IAAU;CACnDlD,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BiD,IAA9B,EAAoC,IAApC,EAA0C,IAA1C,EAAgDtC,EAAhD,EAAoD,EAApD;CACA,WAAK4O,YAAL,CAAkBtM,IAAI,CAACpH,YAAL,CAAkB,UAAlB,CAAlB,EAAiD,IAAIkT,IAAJ,CAAS9L,IAAT,EAAe,EAAf,EAAmB,EAAnB,EAAuBtC,EAAvB,EAA2B,EAA3B,CAAjD;CACH,KAHD;CAIA,WAAOyO,aAAP;CACI,GARD;;CASA,MAAII,UAAU,GAAGP,OAAjB,CAxB+D;;CAyB/D,OAAKQ,SAAL,GAAkBR,OAAD,IAAa;CAACO,IAAAA,UAAU,GAAGP,OAAb;CAAsB,GAArD;;CACA,OAAKS,aAAL,GAAqB,MAAM;CAC9B,QAAIC,GAAG,GAAG,EAAV;;CACA,SAAI,IAAIxT,CAAC,GAAG,CAAZ,EAAcA,CAAC,IAAI,KAAKyT,UAAL,EAAnB,EAAsCzT,CAAC,EAAvC,EAA2C;CACvC,UAAG,KAAK0T,aAAL,CAAmB1T,CAAnB,aAAiC4S,IAApC,EACHY,GAAG,CAACxT,CAAD,CAAH,GAAS,KAAK0T,aAAL,CAAmB1T,CAAnB,CAAT,CADG,KAEK,IAAG,OAAOqT,UAAU,CAACrT,CAAD,CAAjB,IAAwB,UAAxB,IAAsCqT,UAAU,CAACrT,CAAD,CAAV,YAAyB4S,IAAlE,EACRY,GAAG,CAACxT,CAAD,CAAH,GAASqT,UAAU,CAACrT,CAAD,CAAnB,CADQ,KAGRwT,GAAG,CAACxT,CAAD,CAAH,GAAS,MAAM,EAAf;CACA;;CACD,WAAOwT,GAAP;CACI,GAXD;;CAYA,OAAKJ,YAAL,GAAoB,CAACO,CAAD,EAAGC,MAAH,KAAc;CAACP,IAAAA,UAAU,CAACM,CAAD,CAAV,GAAgBC,MAAhB;CAAwB,GAA3D;;CACA,OAAKC,iBAAL,GAAyB,MAAM;CAClC,QAAGR,UAAU,CAAC,KAAKS,cAAL,EAAD,CAAV,YAA6ClB,IAAhD,EACI,OAAOS,UAAU,CAAC,KAAKS,cAAL,EAAD,CAAjB;CACJ,QAAG,KAAKJ,aAAL,CAAmB,KAAKI,cAAL,EAAnB,aAAqDlB,IAAxD,EACI,OAAO,KAAKc,aAAL,CAAmB,KAAKI,cAAL,EAAnB,CAAP;CACJ,WAAO,KAAP;CACI,GAND;;CAOA,OAAKC,iBAAL,GAAyB,MAAM;CAClC,QAAGV,UAAU,CAAC,KAAKS,cAAL,KAAsB,CAAvB,CAAV,YAA+ClB,IAAlD,EACI,OAAO,KAAP;CACJ,QAAG,KAAKc,aAAL,CAAmB,KAAKI,cAAL,KAAsB,CAAzC,aAAuDlB,IAA1D,EACI,OAAO,KAAP;CACJ,QAAG,KAAKkB,cAAL,MAAyB,KAAKL,UAAL,EAA5B,EACI,OAAO,KAAP;CACJ,WAAO,IAAP;CACI,GARD;;CASA,OAAKO,cAAL,GAAsB,YAAY;CACrC,WAAO,KAAKT,aAAL,GAAqB9Q,MAArB,CAA6BmR,MAAD,IAAYA,MAAM,YAAYhB,IAA1D,CAAP;CACI,GAFD,CAvD+D;CA4D/D;CACA;;;CACA,MAAIqB,WAAW,GAAG,CAAC,CAAnB;;CACA,OAAKC,cAAL,GAAuBC,OAAD,IAAaF,WAAW,GAAGE,OAAjD;;CACA,OAAKL,cAAL,GAAsB,MAAMG,WAA5B;;CACA,OAAKR,UAAL,GAAkB,MAAM;CAC3B,QAAG,KAAKW,OAAR,EACI,OAAO,KAAKA,OAAZ;CACJ,QAAIC,OAAO,GAAGhB,UAAU,CAACf,MAAzB;CACA,KAAC,eAAD,EACC,cADD,EAEC,iBAFD,EAGC,mBAHD,EAIC,cAJD,EAKC,cALD,EAMC,OAND,EAOC,SAPD,EAQC,WARD,EASC,WATD,EAUC,SAVD,EAWC,UAXD,EAYC,UAZD,EAaC,YAbD,EAcC,gBAdD,EAeC,oBAfD,EAgBEpP,OAhBF,CAgBWoR,IAAD,IAAU;CAChB,WAAKpB,QAAL,CAAc,OAAKoB,IAAL,GAAU,GAAxB,EAA6BpR,OAA7B,CAAsCJ,IAAD,IAAU;CAClDA,QAAAA,IAAI,CAACpD,YAAL,CAAkB4U,IAAlB,EAAwBlS,KAAxB,CAA8B,GAA9B,EAAmCc,OAAnC,CAA4CqR,MAAD,IAAY;CACnDF,UAAAA,OAAO,GAAG1S,IAAI,CAAC6S,GAAL,CAAS7S,IAAI,CAAC8S,GAAL,CAASjK,QAAQ,CAAC+J,MAAD,CAAjB,CAAT,EAAoCF,OAApC,CAAV;CACH,SAFD;CAGI,OAJD;CAKH,KAtBD;CAuBA,QAAIK,QAAQ,GAAG,KAAKxB,QAAL,CAAc,kDAAd,EAAkE7Q,GAAlE,CAAuES,IAAD,IAAU;CAC3F,UAAGA,IAAI,CAAC6R,YAAL,CAAkB,OAAlB,KAA8B7R,IAAI,CAACpD,YAAL,CAAkB,OAAlB,KAA8B,EAA/D,EACH,OAAO8K,QAAQ,CAAC1H,IAAI,CAACpD,YAAL,CAAkB,OAAlB,CAAD,CAAf;CACG,UAAGoD,IAAI,CAAC6R,YAAL,CAAkB,MAAlB,KAA6B7R,IAAI,CAACpD,YAAL,CAAkB,MAAlB,KAA6B,EAA7D,EACH,OAAO8K,QAAQ,CAAC1H,IAAI,CAACpD,YAAL,CAAkB,MAAlB,CAAD,CAAf;CACG,aAAO,CAAP;CAAW,KALA,CAAf;CAMA2U,IAAAA,OAAO,GAAG1S,IAAI,CAAC6S,GAAL,CAASH,OAAT,EAAkBK,QAAQ,CAACE,MAAT,CAAgB,CAAC3J,CAAD,EAAGD,CAAH,KAASC,CAAC,GAACD,CAA3B,EAA8B,CAA9B,CAAlB,CAAV;CACA,SAAKoJ,OAAL,GAAeC,OAAf;CACA,WAAOA,OAAP;CACI,GApCD,CAjE+D;CAwG/D;CACA;;;CACA,OAAKnB,QAAL,GAAiB2B,IAAD,IAAU;CAC7B,WAAOvT,UAAU,CAAC,KAAKwT,OAAN,EAAeD,IAAf,CAAjB,CAD6B;CAG7B;CACA;CACI,GALD;;CAMA,OAAKE,KAAL,GAAcF,IAAD,IAAU;CAC1B,QAAG,OAAOA,IAAP,IAAe,QAAlB,EAA4B,OAAOA,IAAP;CAC5B,WAAO,KAAK3B,QAAL,CAAc2B,IAAd,EAAoB,CAApB,CAAP;CACI,GAHD;;CAIA,OAAKG,eAAL,GAAwBtT,EAAD,IAAQ;CAClC,QAAIuT,WAAW,GAAG,KAAKjB,cAAL,GAAsBkB,IAAtB,CAA4B9Q,OAAD,IAAa;CACtD,UAAGA,OAAO,CAACtD,IAAR,IAAgBY,EAAnB,EACH,OAAO,CAAP;CACG,aAAO0C,OAAO,CAAC4Q,eAAR,CAAwBtT,EAAxB,CAAP;CACH,KAJiB,CAAlB;CAKA,QAAG,CAACuT,WAAJ,EACI,OAAO,KAAP;CACJ,QAAIA,WAAW,CAACnU,IAAZ,IAAoBY,EAAxB,EACI,OAAOuT,WAAP;CACJ,WAAOA,WAAW,CAACD,eAAZ,CAA4BtT,EAA5B,CAAP;CACI,GAXD,CApH+D;CAkI/D;CACA;;;CACA,OAAKyT,kBAAL,GAA0B,MAAM;CAAE;CACrC,QAAIC,KAAK,GAAG3Q,MAAM,CAAC4Q,uBAAP,CAA+B,KAAKP,OAApC,CAAZ;CACAlR,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCuR,KAAxC;CACAA,IAAAA,KAAK,CAACE,KAAN,IAAe,KAAKA,KAApB;CACAF,IAAAA,KAAK,CAAClN,CAAN,GAAUkN,KAAK,CAAClN,CAAN,GAAU,MAAIkN,KAAK,CAACE,KAA9B;CACAF,IAAAA,KAAK,CAACnN,CAAN,GAAUmN,KAAK,CAACG,OAAhB;CACA3R,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCuR,KAAxC;CACA,WAAOA,KAAP;CACI,GARD,CApI+D;CAgJ/D;CACA;;;CACA,OAAKI,oBAAL,GAA4B,MAAM;CACrC,SAAKtC,QAAL,CAAc,gBAAd,EAAgChQ,OAAhC,CAAyCJ,IAAD,IAAU;CAACA,MAAAA,IAAI,CAACU,SAAL,CAAeiS,MAAf,CAAsB,eAAtB;CAAwC,KAA3F;CACA,QAAIC,KAAK,GAAG,KAAKX,KAAL,CAAW,SAAX,CAAZ;;CACA,WAAMW,KAAK,IAAIA,KAAK,CAACtS,OAAN,IAAiB,WAAhC,EAA6C;CACzCsS,MAAAA,KAAK,CAAClS,SAAN,CAAgBC,GAAhB,CAAoB,eAApB;CACAiS,MAAAA,KAAK,GAAGA,KAAK,CAACC,aAAd;CACH;CACG,GAPD;;CAQA,OAAKC,OAAL,GAAgBF,KAAD,IAAW;CAC7B,QAAGA,KAAK,CAACf,YAAN,CAAmB,mBAAnB,CAAH,EAA4C;CACxC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,mBAAnB,KAA2C,EAA9C,EACH,KAAKmW,UAAL,CAAgBH,KAAhB,EADG,KAGHA,KAAK,CAAChW,YAAN,CAAmB,mBAAnB,EAAwC0C,KAAxC,CAA8C,GAA9C,EAAmDC,GAAnD,CAAwDyT,KAAD,IAAW;CAC9D,aAAKD,UAAL,CAAgB,MAAIC,KAApB;CACH,OAFD;CAGA;;CACD,QAAGJ,KAAK,CAACf,YAAN,CAAmB,qBAAnB,CAAH,EAA8C;CAC1C,UAAGe,KAAK,CAAChW,YAAN,CAAmB,qBAAnB,KAA6C,EAAhD,EACH,KAAKqW,YAAL,CAAkBL,KAAlB,EADG,KAGHA,KAAK,CAAChW,YAAN,CAAmB,qBAAnB,EAA0C0C,KAA1C,CAAgD,GAAhD,EAAqDC,GAArD,CAA0DyT,KAAD,IAAW;CAChE,aAAKC,YAAL,CAAkB,MAAID,KAAtB;CACH,OAFD;CAGA;;CACD,QAAGJ,KAAK,CAACf,YAAN,CAAmB,iBAAnB,CAAH,EAA0C;CACtC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,iBAAnB,KAAyC,EAA5C,EACH,KAAKsW,UAAL,CAAgBN,KAAhB,EAAuB,CAAvB,EADG,KAGH,KAAKM,UAAL,CAAgB,MAAIN,KAAK,CAAChW,YAAN,CAAmB,iBAAnB,CAApB,EAA2D,CAA3D;CACA;;CACD,QAAGgW,KAAK,CAACf,YAAN,CAAmB,eAAnB,CAAH,EAAwC;CACpC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,eAAnB,KAAuC,EAA1C,EACH,KAAKuW,QAAL,CAAcP,KAAd,EAAqB,CAArB,EADG,KAGH,KAAKO,QAAL,CAAc,MAAIP,KAAK,CAAChW,YAAN,CAAmB,eAAnB,CAAlB,EAAuD,CAAvD;CACA;;CACD,QAAGgW,KAAK,CAACf,YAAN,CAAmB,mBAAnB,CAAH,EAA4C;CACxC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,mBAAnB,KAA2C,EAA9C,EACH,KAAKwW,YAAL,CAAkBR,KAAlB,EAAyB,CAAzB,EADG,KAGH,KAAKQ,YAAL,CAAkB,MAAIR,KAAK,CAAChW,YAAN,CAAmB,mBAAnB,CAAtB,EAA+D,CAA/D;CACA;;CACD,QAAGgW,KAAK,CAACf,YAAN,CAAmB,iBAAnB,CAAH,EAA0C;CACtC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,iBAAnB,KAAyC,EAA5C,EACH,KAAKyW,aAAL,CAAmBT,KAAnB,EADG,KAGHA,KAAK,CAAChW,YAAN,CAAmB,iBAAnB,EAAsC0C,KAAtC,CAA4C,GAA5C,EAAiDC,GAAjD,CAAsDyT,KAAD,IAAW;CAC5D,aAAKK,aAAL,CAAmB,MAAIL,KAAvB;CACH,OAFD;CAGA;;CACD,QAAGJ,KAAK,CAACf,YAAN,CAAmB,mBAAnB,CAAH,EAA4C;CACxC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,mBAAnB,KAA2C,EAA9C,EACH,KAAK0W,MAAL,CAAYV,KAAZ,EADG,KAGHA,KAAK,CAAChW,YAAN,CAAmB,mBAAnB,EAAwC0C,KAAxC,CAA8C,GAA9C,EAAmDC,GAAnD,CAAwDyT,KAAD,IAAW;CAC9D,aAAKM,MAAL,CAAY,MAAIN,KAAhB;CACH,OAFD;CAGA;;CACD,QAAGJ,KAAK,CAACf,YAAN,CAAmB,iBAAnB,CAAH,EAA0C;CACtC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,iBAAnB,KAAyC,EAA5C,EACH,KAAK2W,IAAL,CAAUX,KAAV,EADG,KAGHA,KAAK,CAAChW,YAAN,CAAmB,iBAAnB,EAAsC0C,KAAtC,CAA4C,GAA5C,EAAiDC,GAAjD,CAAsDyT,KAAD,IAAW;CAC5D,aAAKO,IAAL,CAAU,MAAIP,KAAd;CACH,OAFD;CAGA;;CACD,QAAGJ,KAAK,CAACf,YAAN,CAAmB,uBAAnB,CAAH,EAAgD;CAC5C,UAAI,CAAC2B,QAAD,EAAW3V,UAAX,IAAyB+U,KAAK,CAAChW,YAAN,CAAmB,uBAAnB,EAA4C0C,KAA5C,CAAkD,GAAlD,CAA7B;CACA,WAAK2S,KAAL,CAAW,MAAIuB,QAAf,EAAyB3V,UAAzB,GAAsCA,UAAtC;CACH;;CACD,QAAG+U,KAAK,CAACf,YAAN,CAAmB,wBAAnB,CAAH,EAAiD;CAC7Ce,MAAAA,KAAK,CAAChW,YAAN,CAAmB,wBAAnB,EAA6C0C,KAA7C,CAAmD,GAAnD,EAAwDC,GAAxD,CAA6DiU,QAAD,IAAc;CAC7E,aAAKvB,KAAL,CAAW,MAAIuB,QAAf,EAAyB3V,UAAzB;CACI,OAFD;CAGH;;CACD,QAAG+U,KAAK,CAACf,YAAN,CAAmB,4BAAnB,CAAH,EAAqD;CACjDe,MAAAA,KAAK,CAAChW,YAAN,CAAmB,4BAAnB,EAAiD0C,KAAjD,CAAuD,GAAvD,EAA4DC,GAA5D,CAAiEiU,QAAD,IAAc;CACjF,aAAKvB,KAAL,CAAW,MAAIuB,QAAf,EAAyB3V,UAAzB;CACI,OAFD;CAGH;;CACD,QAAG+U,KAAK,CAACf,YAAN,CAAmB,kBAAnB,CAAH,EAA2C;CACvC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,kBAAnB,KAA0C,EAA7C,EACH,KAAK6W,KAAL,CAAWb,KAAX,EADG,KAGH,KAAKa,KAAL,CAAW,MAAIb,KAAK,CAAChW,YAAN,CAAmB,kBAAnB,CAAf;CACA;;CACD,QAAGgW,KAAK,CAACf,YAAN,CAAmB,oBAAnB,CAAH,EAA4C;CACxC,UAAGe,KAAK,CAAChW,YAAN,CAAmB,oBAAnB,KAA4C,EAA/C,EACH,KAAK8W,OAAL,CAAad,KAAb,EADG,KAGH,KAAKc,OAAL,CAAa,MAAId,KAAK,CAAChW,YAAN,CAAmB,oBAAnB,CAAjB;CACA;CACG,GArFD;;CAsFA,OAAK+W,SAAL,GAAiB,MAAM;CAC1B,QAAIf,KAAK,GAAG,KAAKX,KAAL,CAAW,uGAAX,CAAZ,CAD0B;;CAG1B,QAAGW,KAAH,EAAU;CACN9R,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwB,KAAK/C,IAA7B,EAAmC4U,KAAnC;;CACA,UAAGA,KAAK,CAACf,YAAN,CAAmB,MAAnB,CAAH,EAA+B;CAClC,YAAG,CAACe,KAAK,CAAChW,YAAN,CAAmB,MAAnB,CAAJ,EACIgW,KAAK,CAACgB,YAAN,CAAmB,MAAnB,EAA2B,CAA3B;CACJ,YAAIC,CAAC,GAAGjB,KAAK,CAAChW,YAAN,CAAmB,MAAnB,CAAR;;CACA,YAAIiX,CAAC,IAAI,CAAT,EAAW;CACPjB,UAAAA,KAAK,CAACkB,eAAN,CAAsB,MAAtB;CACA,eAAKhB,OAAL,CAAaF,KAAb;CACH,SAHD,MAIIA,KAAK,CAACgB,YAAN,CAAmB,MAAnB,EAA2BC,CAAC,GAAC,CAA7B;CACA;;CACD,UAAGjB,KAAK,CAACf,YAAN,CAAmB,YAAnB,CAAH,EAAqC;CACxCe,QAAAA,KAAK,CAACgB,YAAN,CAAmB,YAAnB,EAAiC,CAAjC;CACA,aAAKd,OAAL,CAAaF,KAAb;CACI;;CACD,UAAGA,KAAK,CAACf,YAAN,CAAmB,iBAAnB,CAAH,EAA0C;CAC7Ce,QAAAA,KAAK,CAACgB,YAAN,CAAmB,iBAAnB,EAAsC,CAAtC;CACA,aAAKd,OAAL,CAAaF,KAAb;CACI;;CACD,UAAGA,KAAK,CAACf,YAAN,CAAmB,OAAnB,CAAH,EAAgC;CACnC,YAAG,CAACe,KAAK,CAAChW,YAAN,CAAmB,OAAnB,CAAJ,EACIgW,KAAK,CAACgB,YAAN,CAAmB,OAAnB,EAA4B,CAA5B;CACJ,YAAIC,CAAC,GAAGjB,KAAK,CAAChW,YAAN,CAAmB,OAAnB,CAAR;;CACA,YAAIiX,CAAC,IAAI,CAAT,EAAW;CACPjB,UAAAA,KAAK,CAACkB,eAAN,CAAsB,OAAtB;CACA,eAAKhB,OAAL,CAAaF,KAAb;CACH,SAHD,MAIIA,KAAK,CAACgB,YAAN,CAAmB,OAAnB,EAA4BC,CAAC,GAAC,CAA9B;;CACJ,aAAKnB,oBAAL;CACI;CACJ;CACG,GAnCD,CAhP+D;CAsR/D;CACA;;;CACA,OAAKqB,YAAL,GAAoB,MAAM;CAC7B,SAAK3D,QAAL,CAAc,iBAAd,EAAiChQ,OAAjC,CAA0CJ,IAAD,IAAU;CAC/C,UAAIgU,QAAQ,GAAGhU,IAAI,CAACpD,YAAL,CAAkB,cAAlB,EAAkC0C,KAAlC,CAAwC,GAAxC,EAA6CC,GAA7C,CAAkD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAAlE,CAAf;CACA,UAAGD,QAAQ,CAACnU,QAAT,CAAkBsR,WAAlB,CAAH,EACHnR,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CAA0B,KAH3B;CAIA,SAAK9D,QAAL,CAAc,kBAAd,EAAkChQ,OAAlC,CAA2CJ,IAAD,IAAU;CAChD,UAAImU,SAAS,GAAGnU,IAAI,CAACpD,YAAL,CAAkB,eAAlB,EAAmC0C,KAAnC,CAAyC,GAAzC,EAA8CC,GAA9C,CAAmD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAAnE,CAAhB;CACA,UAAGE,SAAS,CAACtU,QAAV,CAAmBsR,WAAnB,CAAH,EACHnR,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CAA0B,KAH3B;CAIA,SAAK9D,QAAL,CAAc,oBAAd,EAAoChQ,OAApC,CAA6CJ,IAAD,IAAU;CAClD,UAAIoU,MAAM,GAAGpU,IAAI,CAACpD,YAAL,CAAkB,iBAAlB,EAAqC0C,KAArC,CAA2C,GAA3C,EAAgDC,GAAhD,CAAqD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAArE,CAAb;CACA,UAAGG,MAAM,CAACvU,QAAP,CAAgBsR,WAAhB,CAAH,EACHnR,IAAI,CAACU,SAAL,CAAeC,GAAf,CAAmB,WAAnB;CAAiC,KAHlC;CAIA,SAAKyP,QAAL,CAAc,sBAAd,EAAsChQ,OAAtC,CAA+CJ,IAAD,IAAU;CACpD,UAAIqU,QAAQ,GAAGrU,IAAI,CAACpD,YAAL,CAAkB,mBAAlB,EAAuC0C,KAAvC,CAA6C,GAA7C,EAAkDC,GAAlD,CAAuD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAAvE,CAAf;CACA,UAAGI,QAAQ,CAACxU,QAAT,CAAkBsR,WAAlB,CAAH,EACHnR,IAAI,CAACU,SAAL,CAAeiS,MAAf,CAAsB,WAAtB;CAAoC,KAHrC;CAIA,SAAKvC,QAAL,CAAc,iBAAd,EAAiChQ,OAAjC,CAA0CJ,IAAD,IAAU;CAC/C,UAAIoU,MAAM,GAAGpU,IAAI,CAACpD,YAAL,CAAkB,cAAlB,EAAkC0C,KAAlC,CAAwC,GAAxC,EAA6CC,GAA7C,CAAkD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAAlE,CAAb;CACA,UAAGG,MAAM,CAACvU,QAAP,CAAgBsR,WAAhB,CAAH,EACHnR,IAAI,CAACU,SAAL,CAAeC,GAAf,CAAmB,WAAnB,EADG,KAGHX,IAAI,CAACU,SAAL,CAAeiS,MAAf,CAAsB,WAAtB;CACA,KAND;CAOA,SAAKvC,QAAL,CAAc,iBAAd,EAAiChQ,OAAjC,CAA0CJ,IAAD,IAAU;CAC/C,UAAIsU,OAAO,GAAGtU,IAAI,CAACpD,YAAL,CAAkB,cAAlB,EAAkC0C,KAAlC,CAAwC,GAAxC,EAA6CC,GAA7C,CAAkD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAAlE,CAAd;CACA,UAAGK,OAAO,CAACzU,QAAR,CAAiBsR,WAAjB,CAAH,EACHnR,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CACG,UAAGI,OAAO,CAACzU,QAAR,CAAiB,CAACsR,WAAlB,CAAH,EACHnR,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CACA,KAND;CAOA,SAAK9D,QAAL,CAAc,cAAd,EAA8BhQ,OAA9B,CAAuCJ,IAAD,IAAU;CAC5C,UAAIuU,QAAQ,GAAGvU,IAAI,CAACpD,YAAL,CAAkB,WAAlB,EAA+B0C,KAA/B,CAAqC,GAArC,EAA0CC,GAA1C,CAA+C0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAA/D,CAAf;CACA,UAAG9C,WAAW,GAAG,CAAjB,EAAoB;;CACpB,UAAGoD,QAAQ,CAAC1U,QAAT,CAAkB,CAACsR,WAAnB,CAAH,EAAmC;CACtCrQ,QAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8CoQ,WAA9C,EAA2DnR,IAA3D;CACA,aAAKiT,YAAL,CAAkBjT,IAAlB,EAFsC;CAItC;CACI,OALD,MAMK,IAAGuU,QAAQ,CAAC1U,QAAT,CAAkBsR,WAAlB,CAAH,EAAmC;CAC3C,aAAK4B,UAAL,CAAgB/S,IAAhB,EAD2C;CAG3C;CACI;CACJ,KAdD;CAeA,SAAKoQ,QAAL,CAAc,YAAd,EAA4BhQ,OAA5B,CAAqCJ,IAAD,IAAU;CAC1C,UAAIwU,QAAQ,GAAGxU,IAAI,CAACpD,YAAL,CAAkB,SAAlB,EAA6B0C,KAA7B,CAAmC,GAAnC,EAAwCC,GAAxC,CAA6C0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAA7D,CAAf;CACA,UAAGO,QAAQ,CAAC3U,QAAT,CAAkBsR,WAAlB,CAAH,EACH,KAAK+B,UAAL,CAAgBlT,IAAhB,EAAsB,CAAtB;CACA,KAJD;CAKA,SAAKoQ,QAAL,CAAc,UAAd,EAA0BhQ,OAA1B,CAAmCJ,IAAD,IAAU;CACxC,UAAIyU,IAAI,GAAGzU,IAAI,CAACpD,YAAL,CAAkB,OAAlB,EAA2B0C,KAA3B,CAAiC,GAAjC,EAAsCC,GAAtC,CAA2C0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAA3D,CAAX;CACA,UAAGQ,IAAI,CAAC5U,QAAL,CAAcsR,WAAd,CAAH,EACH,KAAKgC,QAAL,CAAcnT,IAAd,EAAoB,CAApB;CAAwB,KAHzB;CAIA,SAAKoQ,QAAL,CAAc,cAAd,EAA8BhQ,OAA9B,CAAuCJ,IAAD,IAAU;CAC5C,UAAIwU,QAAQ,GAAGxU,IAAI,CAACpD,YAAL,CAAkB,WAAlB,EAA+B0C,KAA/B,CAAqC,GAArC,EAA0CC,GAA1C,CAA+C0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAA/D,CAAf;CACA,UAAGO,QAAQ,CAAC3U,QAAT,CAAkBsR,WAAlB,CAAH,EACH,KAAKiC,YAAL,CAAkBpT,IAAlB,EAAwB,CAAxB;CAA4B,KAH7B;CAIA,SAAKoQ,QAAL,CAAc,aAAd,EAA6BhQ,OAA7B,CAAsCJ,IAAD,IAAU;CAC3C,UAAIyT,KAAK,GAAGzT,IAAI,CAACpD,YAAL,CAAkB,UAAlB,EAA8B0C,KAA9B,CAAoC,GAApC,EAAyCC,GAAzC,CAA8C0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAA9D,CAAZ;CACA,UAAGR,KAAK,CAAC5T,QAAN,CAAesR,WAAf,CAAH,EACH,KAAKsC,KAAL,CAAWzT,IAAX,EAAiB,CAAjB;CAAqB,KAHtB;CAIA,SAAKoQ,QAAL,CAAc,eAAd,EAA+BhQ,OAA/B,CAAwCJ,IAAD,IAAU;CAC7C,UAAIyT,KAAK,GAAGzT,IAAI,CAACpD,YAAL,CAAkB,YAAlB,EAAgC0C,KAAhC,CAAsC,GAAtC,EAA2CC,GAA3C,CAAgD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAAhE,CAAZ;CACA,UAAGR,KAAK,CAAC5T,QAAN,CAAesR,WAAf,CAAH,EACH,KAAKuC,OAAL,CAAa1T,IAAb,EAAmB,CAAnB;CAAuB,KAHxB;CAIA,SAAKoQ,QAAL,CAAc,YAAd,EAA4BhQ,OAA5B,CAAqCJ,IAAD,IAAU;CAC1C,UAAI0U,MAAM,GAAG1U,IAAI,CAACpD,YAAL,CAAkB,SAAlB,EAA6B0C,KAA7B,CAAmC,GAAnC,EAAwCC,GAAxC,CAA6C0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAA7D,CAAb;CACA,UAAGS,MAAM,CAAC7U,QAAP,CAAgBsR,WAAhB,CAAH,EACH,KAAKkC,aAAL,CAAmBrT,IAAnB;CAA0B,KAH3B;CAIA,SAAKoQ,QAAL,CAAc,mBAAd,EAAmChQ,OAAnC,CAA4CJ,IAAD,IAAU;CACjD,UAAI2U,YAAY,GAAG3U,IAAI,CAACpD,YAAL,CAAkB,gBAAlB,EAAoC0C,KAApC,CAA0C,GAA1C,EAA+CC,GAA/C,CAAoD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAApE,CAAnB;CACA,UAAGU,YAAY,CAAC9U,QAAb,CAAsBsR,WAAtB,CAAH,EACHnR,IAAI,CAACnC,UAAL;CAAmB,KAHpB;CAIA,SAAKuS,QAAL,CAAc,uBAAd,EAAuChQ,OAAvC,CAAgDJ,IAAD,IAAU;CACrD,UAAI2U,YAAY,GAAG3U,IAAI,CAACpD,YAAL,CAAkB,oBAAlB,EAAwC0C,KAAxC,CAA8C,GAA9C,EAAmDC,GAAnD,CAAwD0U,GAAD,IAASvM,QAAQ,CAACuM,GAAD,CAAxE,CAAnB;CACA,UAAGU,YAAY,CAAC9U,QAAb,CAAsBsR,WAAtB,CAAH,EACHnR,IAAI,CAACnC,UAAL;CAAmB,KAHpB;CAII,GA/ED;;CAgFA,OAAK+W,SAAL,GAAiB,MAAM;CAC1B9T,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyB,KAAK/C,IAA9B;CACAmT,IAAAA,WAAW,GAAGA,WAAW,GAAC,CAA1B;CACA,SAAK4C,YAAL;CACA,QAAG5C,WAAW,GAAC,CAAf,EACI,KAAKwC,SAAL;CACJ,SAAKkB,SAAL;CACI,GAPD;;CAQA,OAAK/P,IAAL,GAAY,YAAY;CAC3B,QAAGqM,WAAW,IAAI,KAAKR,UAAL,EAAlB,EACI,OAAO,KAAP;CACJ,SAAKiE,SAAL;;CACA,QAAG,OAAOrE,UAAU,CAACY,WAAD,CAAjB,IAAkC,UAArC,EAAiD;CAC7CZ,MAAAA,UAAU,CAACY,WAAD,CAAV,CAAwB,IAAxB;CACH;;CACD,QAAGZ,UAAU,CAACY,WAAD,CAAV,YAAmCrB,IAAtC,EAA2C;CACvC,aAAOS,UAAU,CAACY,WAAD,CAAjB;CACH;;CACD,QAAG,KAAKP,aAAL,CAAmBO,WAAnB,aAA2CrB,IAA9C,EACI,OAAO,KAAKc,aAAL,CAAmBO,WAAnB,CAAP,CAXuB;CAa3B;CACA;;CACA,WAAO,IAAP;CACI,GAhBD;;CAiBA,OAAKnM,QAAL,GAAgB,MAAM;CACzB,QAAI8P,gBAAgB,GAAG,KAAK9D,cAAL,EAAvB;CACA,QAAI+D,UAAU,GAAG,KAAKC,YAAtB;CACA,SAAKpT,SAAL,GAAiBqT,YAAjB,CAA8B,IAA9B;CACA,QAAIC,UAAU,GAAG,KAAKlD,OAAL,CAAamD,SAA9B;CACA,QAAInN,CAAC,GAAG,KAAKoN,SAAL,EAAR;CACA,SAAKpD,OAAL,CAAamD,SAAb,GAAyBD,UAAzB;CACApU,IAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA0CiH,CAA1C;CACA,QAAG8M,gBAAgB,IAAI,CAAC,CAAxB,EACI,OAAO,KAAP;CACH,QAAIO,QAAJ;;CACD,WAAM,KAAKrE,cAAL,KAAsB8D,gBAAgB,GAAC,CAA7C,EAA+C;CAC3ChU,MAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyC,KAAKa,SAAL,GAAiB0T,YAAjB,EAAzC;CACAxU,MAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ,EAAuCoQ,WAAvC;CACAkE,MAAAA,QAAQ,GAAG,KAAKvQ,IAAL,EAAX;CACH,KAfwB;CAiBzB;CACA;CACA;;;CACA2J,IAAAA,UAAU,CAAC,MAAM;CAAC,WAAK7M,SAAL,GAAiBqT,YAAjB,CAA8B,KAA9B;CAAsC,KAA9C,EAA+C,CAA/C,CAAV;CACA,SAAKrT,SAAL,GAAiB2T,QAAjB,CAA0B,IAA1B,EAAgC;CAACC,MAAAA,KAAK,EAACT;CAAP,KAAhC;CACA,WAAOM,QAAP,CAtByB;CAyBrB,GAzBD,CAjY+D;CA6Z/D;CACA;;;CACA,OAAKI,UAAL,GAAmBC,OAAD,IAAa;CAAC,SAAKA,OAAL,GAAeA,OAAf;CAAwB,GAAxD;;CACA,OAAKb,SAAL,GAAiB,MAAM;CAC1B,QAAG,CAAC,KAAKa,OAAT,EACI;CACJ,QAAG,CAAC,KAAKC,OAAT,EACI,KAAKA,OAAL,GAAenX,UAAU,CAAC,KAAKkX,OAAN,EAAe,IAAf,EAAqB,IAArB,CAAzB;CACJ,QAAIxY,CAAJ;;CACA,SAAIA,CAAC,GAAC,CAAN,EAAQA,CAAC,GAAC,KAAK8T,cAAL,EAAV,EAAiC9T,CAAC,EAAlC,EAAsC;CAClC,WAAKyY,OAAL,CAAazY,CAAb,EAAgBwD,SAAhB,CAA0BiS,MAA1B,CAAiC,QAAjC,EAA2C,OAA3C,EAAoD,SAApD;CACA,WAAKgD,OAAL,CAAazY,CAAb,EAAgBwD,SAAhB,CAA0BC,GAA1B,CAA8B,QAA9B;CACH;;CACD,QAAGzD,CAAC,IAAE,KAAK8T,cAAL,EAAN,EAA6B;CACzB,WAAK2E,OAAL,CAAazY,CAAb,EAAgBwD,SAAhB,CAA0BiS,MAA1B,CAAiC,QAAjC,EAA2C,OAA3C,EAAoD,SAApD;CACA,WAAKgD,OAAL,CAAazY,CAAb,EAAgBwD,SAAhB,CAA0BC,GAA1B,CAA8B,SAA9B;CACAzD,MAAAA,CAAC;CACJ;;CACD,SAAIA,CAAJ,EAAMA,CAAC,IAAE,KAAKyT,UAAL,EAAT,EAA4BzT,CAAC,EAA7B,EAAiC;CAC7B,WAAKyY,OAAL,CAAazY,CAAb,EAAgBwD,SAAhB,CAA0BiS,MAA1B,CAAiC,QAAjC,EAA2C,OAA3C,EAAoD,SAApD;CACA,WAAKgD,OAAL,CAAazY,CAAb,EAAgBwD,SAAhB,CAA0BC,GAA1B,CAA8B,OAA9B;CACH;CACG,GAnBD;;CAoBA,OAAKiV,UAAL,GAAkB,MAAM;CAC3B,SAAKf,SAAL;CACA,QAAG5E,OAAO,CAAC2F,UAAX,EACI3F,OAAO,CAAC2F,UAAR,CAAmB,IAAnB;CACA,GAJD;;CAKA,OAAKC,IAAL,GAAY,MAAM;CACrB,SAAKzF,QAAL,CAAc,iBAAd,EAAiChQ,OAAjC,CAA0CJ,IAAD,IAAU;CAC/CA,MAAAA,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CACH,KAFD,EADqB;CAKrB;CACA;CACA;CACD;;CACC,SAAKxB,oBAAL;CACA,QAAGzC,OAAO,CAAC4F,IAAX,EACI5F,OAAO,CAAC4F,IAAR,CAAa,IAAb;CACA,GAZD,CAzb+D;CAwc/D;CACA;;;CACA,OAAKhS,OAAL,GAAe,MAAM;CACxB,QAAG0M,UAAU,CAACY,WAAD,CAAV,YAAmCrB,IAAtC,EACIS,UAAU,CAACY,WAAD,CAAV,CAAwBtN,OAAxB,GADJ,KAGI,KAAKuR,SAAL;CACA,GALD;;CAMA,OAAKU,UAAL,GAAkB,MAAM;CAC3BvF,IAAAA,UAAU,CAAC5Q,MAAX,CAAmBK,IAAD,IAAUA,IAAI,YAAY8P,IAA5C,EAAkD1P,OAAlD,CAA2DkB,OAAD,IAAa;CAAEA,MAAAA,OAAO,CAACwU,UAAR;CAAsB,KAA/F;CACA,SAAKlF,aAAL,CAAmBjR,MAAnB,CAA2BK,IAAD,IAAUA,IAAI,YAAY8P,IAApD,EAA0D1P,OAA1D,CAAmEkB,OAAD,IAAa;CAAEA,MAAAA,OAAO,CAACwU,UAAR;CAAsB,KAAvG;CACA,SAAKV,SAAL;CACI,GAJD;;CAKA,OAAKA,SAAL,GAAiB,MAAM;CAC1BtU,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAgC,KAAKiR,OAArC;CACAlR,IAAAA,OAAO,CAACC,GAAR,CAAY,qCAAZ;CACA,SAAKqQ,cAAL,CAAoB,CAAC,CAArB;CACA,QAAI2E,WAAW,GAAGvX,UAAU,CAAC,KAAKwT,OAAN,EAAe,WAAf,CAA5B;CACAlR,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBiV,aAAvB;CACAlV,IAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ,EAA8CiV,aAA9C;CACA,QAAI/U,KAAK,GAAG+U,aAAa,CAAC9V,SAAd,CAAwB,IAAxB,CAAZ;CACAc,IAAAA,eAAe,CAACC,KAAD,EAAQ8U,WAAR,EAAqB,KAAKE,eAA1B,EAA2C,KAAKC,wBAAhD,CAAf;CACA,SAAKlE,OAAL,CAAaxQ,WAAb,CAAyBP,KAAzB;CACA,SAAK+Q,OAAL,GAAe/Q,KAAf;CACA,SAAK4U,IAAL;CACA,SAAKD,UAAL;CACA,WAAO,KAAKO,QAAZ;CACA,WAAO,KAAKC,QAAZ;CACA,WAAO,KAAKpB,YAAZ;CACAlU,IAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8CkP,OAA9C,EAAuD,KAAKrO,SAAL,GAAiB0T,YAAjB,EAAvD;CACA,SAAK1T,SAAL,GAAiB2T,QAAjB,CAA0B,IAA1B;CACI,GAlBD,CArd+D;CA0e/D;CACA;;;CACA,OAAKtC,YAAL,GAAoB,CAACvU,QAAD,EAAW8W,KAAX,EAAkBtB,OAAlB,KAA8B;CACrD,QAAIlU,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAX,CADqD;CAGrD;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;;CACAsB,IAAAA,IAAI,CAACiE,KAAL,CAAW+F,QAAX,GAAsB,UAAtB;CACAhK,IAAAA,IAAI,CAACiE,KAAL,CAAWoS,UAAX,GAAwB,QAAxB;CACI,GAnBD;;CAoBA,OAAKtD,UAAL,GAAmBrU,QAAD,IAAc;CACnC,QAAIsB,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAX;CACAsB,IAAAA,IAAI,CAACiE,KAAL,CAAW+F,QAAX,GAAsB,QAAtB;CACAhK,IAAAA,IAAI,CAACiE,KAAL,CAAWoS,UAAX,GAAwB,SAAxB;CACI,GAJD;;CAKA,OAAK3C,OAAL,GAAgBhV,QAAD,IAAc;CAChC,SAAKkD,SAAL,GAAiB2T,QAAjB,CAA0B,IAA1B,EAAgC;CAAEC,MAAAA,KAAK,EAAE;CAAT,KAAhC;CACI,GAFD;;CAGA,OAAK/B,KAAL,GAAc/U,QAAD,IAAc;CAC9B,QAAIsB,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAX;CACA,SAAKkD,SAAL,GAAiB0U,aAAjB,CAA+BtW,IAA/B,EAAqC,EAArC;CACI,GAHD;;CAKA,OAAKqT,aAAL,GAAsB3U,QAAD,IAAc;CACtC,QAAIsB,IAAJ;CACA,QAAG,OAAOtB,QAAP,IAAmB,QAAtB,EAAgCsB,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAP,CAAhC,KACKsB,IAAI,GAAGtB,QAAP;CACJ,QAAI6X,QAAJ,CAAa,MAAb,EAAoBvW,IAAI,CAACwW,SAAzB,CAAD,CAAsC,IAAtC;CACI,GALD;;CAMA,OAAKrD,QAAL,GAAgB,CAACzU,QAAD,EAAW8W,KAAX,EAAmBiB,MAAnB,KAA8B;CACjDhI,IAAAA,UAAU,CAAC,MAAM;CACb,UAAIzO,IAAJ;CACA,UAAG,OAAOtB,QAAP,IAAmB,QAAtB,EAAgCsB,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAP,CAAhC,KACKsB,IAAI,GAAGtB,QAAP;CACL,UAAI,OAAO+X,MAAP,IAAiB,WAArB,EAAkCA,MAAM,GAAG,MAAT;CAClC,UAAInE,KAAK,GAAG,KAAKD,kBAAL,EAAZ;CACA,UAAIwB,CAAC,GAAG,CAAE7T,IAAI,CAAC0W,SAAN,GAAiB,IAAjB,GAAsBD,MAAvB,IAA+BnE,KAAK,CAACE,KAA7C;CACA,WAAKmE,UAAL,CAAgBrE,KAAK,CAACnN,CAAtB,EAAyBmN,KAAK,CAAClN,CAAN,GAAQyO,CAAjC,EAAoCvB,KAAK,CAACE,KAA1C,EAAiD,KAAKoE,MAAtD,EAA8DpB,KAA9D,EAPa;CASb;CACA;CACA;CACH,KAZS,EAYR,CAZQ,CAAV;CAaI,GAdD;;CAeA,OAAKtC,UAAL,GAAkB,CAACxU,QAAD,EAAW8W,KAAX,EAAkBiB,MAAlB,KAA6B;CAClDhI,IAAAA,UAAU,CAAC,MAAM;CACb,UAAIzO,IAAJ;CACA,UAAG,OAAOtB,QAAP,IAAmB,QAAtB,EAAgCsB,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAP,CAAhC,KACKsB,IAAI,GAAGtB,QAAP;CACL,UAAI,OAAO+X,MAAP,IAAiB,WAArB,EAAkCA,MAAM,GAAG,MAAT;CAClC,UAAInE,KAAK,GAAG,KAAKD,kBAAL,EAAZ;CACA,UAAIwB,CAAC,GAAG,CAAC,CAAC7T,IAAI,CAAC0W,SAAL,GAAe1W,IAAI,CAAC6W,YAArB,IAAmC,IAAnC,GAA0C,CAA1C,GAA8CJ,MAA/C,IAAuDnE,KAAK,CAACE,KAArE;CACA,WAAKmE,UAAL,CAAgBrE,KAAK,CAACnN,CAAtB,EAAyBmN,KAAK,CAAClN,CAAN,GAAQyO,CAAjC,EAAoCvB,KAAK,CAACE,KAA1C,EAAiD,KAAKoE,MAAtD,EAA8DpB,KAA9D,EAPa;CASb;CACA;CACA;CACH,KAZS,EAYR,CAZQ,CAAV;CAaI,GAdD;;CAeA,OAAKpC,YAAL,GAAoB,CAAC1U,QAAD,EAAW8W,KAAX,EAAkBiB,MAAlB,KAA6B;CACpDhI,IAAAA,UAAU,CAAC,MAAM;CACb,UAAIzO,IAAJ;CACA,UAAG,OAAOtB,QAAP,IAAmB,QAAtB,EAAgCsB,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAP,CAAhC,KACKsB,IAAI,GAAGtB,QAAP;CACL,UAAI,OAAO+X,MAAP,IAAiB,WAArB,EAAkCA,MAAM,GAAG,CAAT;CAClC,UAAInE,KAAK,GAAG,KAAKD,kBAAL,EAAZ;CACA,UAAIwB,CAAC,GAAG,CAAC,CAAC7T,IAAI,CAAC0W,SAAL,GAAe1W,IAAI,CAAC6W,YAAL,GAAkB,CAAlC,IAAqC,IAArC,GAA0C,IAAE,CAA5C,GAA8CJ,MAA/C,IAAuDnE,KAAK,CAACE,KAArE;CACA,WAAKmE,UAAL,CAAgBrE,KAAK,CAACnN,CAAtB,EAAyBmN,KAAK,CAAClN,CAAN,GAAQyO,CAAjC,EAAoCvB,KAAK,CAACE,KAA1C,EAAiD,KAAKoE,MAAtD,EAA8DpB,KAA9D,EAPa;CASb;CACA;CACA;CACH,KAZS,EAYR,CAZQ,CAAV;CAaI,GAdD;;CAeA,OAAKsB,aAAL,GAAqB,MAAM;CAC9B,SAAKlV,SAAL;CACI,GAFD;;CAGA,OAAK+U,UAAL,GAAkB,CAACxR,CAAD,EAAGC,CAAH,EAAKoN,KAAL,EAAWoE,MAAX,EAAmBpB,KAAnB,KAA6B;CAClD,SAAKW,QAAL,GAAgBhR,CAAhB;CACA,SAAKiR,QAAL,GAAgBhR,CAAhB;CACA,SAAK4P,YAAL,GAAoBQ,KAApB;CACA1U,IAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ,EAAiD,KAAKa,SAAL,GAAiB0T,YAAjB,EAAjD;CACAxU,IAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ,EAAuCoE,CAAvC,EAA0CC,CAA1C,EAA6C,KAAKxD,SAAL,GAAiB0T,YAAjB,EAA7C,EALkD;;CAO9C,SAAK1T,SAAL,GAAiB+U,UAAjB,CAA4BxR,CAA5B,EAA+BC,CAA/B,EAAkCoN,KAAlC,EAAyCoE,MAAzC,EAAiDpB,KAAjD,EAP8C;CAS9C,GATD;;CAUA,OAAKlC,MAAL,GAAe5U,QAAD,IAAc;CAC/B,QAAIsB,IAAJ;CACA,QAAG,OAAOtB,QAAP,IAAmB,QAAtB,EAAgCsB,IAAI,GAAG,KAAKiS,KAAL,CAAWvT,QAAX,CAAP,CAAhC,KACKsB,IAAI,GAAGtB,QAAP;CACLsB,IAAAA,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CACI,GALD;;CAMA,OAAK6C,SAAL,GAAkBrY,QAAD,IAAc;CAClC,SAAK0R,QAAL,CAAc1R,QAAd,EAAwB0B,OAAxB,CAAiCJ,IAAD,IAAU;CAAEA,MAAAA,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CAA0B,KAAtE;CACI,GAFD;;CAGA,OAAKX,IAAL,GAAa7U,QAAD,IAAc;CAC7B,SAAKuT,KAAL,CAAWvT,QAAX,EAAqBuF,KAArB,CAA2BiQ,OAA3B,GAAqC,GAArC;CACI,GAFD;;CAGA,OAAK8C,OAAL,GAAgBtY,QAAD,IAAc;CAChC,SAAK0R,QAAL,CAAc1R,QAAd,EAAwB0B,OAAxB,CAAiCJ,IAAD,IAAU;CAAEA,MAAAA,IAAI,CAACiE,KAAL,CAAWiQ,OAAX,GAAqB,GAArB;CAA0B,KAAtE;CACI,GAFD,CAzlB+D;CA8lB/D;CACA;;;CACA,OAAK+C,IAAL,GAAY,SAAZ;;CACA,OAAKC,OAAL,GAAgBD,IAAD,IAAU;CAAC,WAAO,KAAKA,IAAZ;CAAkB,GAA5C;;CACA,OAAKnT,OAAL,GAAgBmT,IAAD,IAAU;CAC5B,QAAGA,IAAI,IAAI,WAAX,EAAwB;CACpB,WAAK9V,SAAL,CAAeoK,KAAf;CACA,WAAKnK,kBAAL,CAAwBmK,KAAxB;CACA;CACH;;CACD,SAAK0L,IAAL,GAAYA,IAAZ;CACA,SAAKjF,OAAL,CAAatR,SAAb,CAAuBiS,MAAvB,CAA8B,SAA9B,EAAyC,cAAzC;;CACA,QAAGsE,IAAI,IAAI,cAAX,EAA2B;CACvB,WAAKjF,OAAL,CAAatR,SAAb,CAAuBC,GAAvB,CAA2B,cAA3B;CACA,WAAKS,kBAAL,CAAwBoJ,IAAxB,GAA+B,MAA/B;CACH,KAHD,MAGO,IAAGyM,IAAI,IAAI,oBAAX,EAAiC;CACpC,WAAKjF,OAAL,CAAatR,SAAb,CAAuBC,GAAvB,CAA2B,cAA3B;CACA,WAAKS,kBAAL,CAAwBoJ,IAAxB,GAA+B,OAA/B;CACH,KAHM,MAGA,IAAGyM,IAAI,IAAI,SAAX,EAAsB;CACzB,WAAKjF,OAAL,CAAatR,SAAb,CAAuBC,GAAvB,CAA2B,SAA3B;CACA,WAAKQ,SAAL,CAAeqJ,IAAf,GAAsB,MAAtB;CACA,WAAKrJ,SAAL,CAAekM,MAAf,GAAwB,CAAxB;CACH,KAJM,MAIA,IAAG4J,IAAI,IAAI,eAAX,EAA4B;CAC/B,WAAKjF,OAAL,CAAatR,SAAb,CAAuBC,GAAvB,CAA2B,SAA3B;CACA,WAAKQ,SAAL,CAAekM,MAAf,GAAwB,EAAxB;CACA,WAAKlM,SAAL,CAAeqJ,IAAf,GAAsB,OAAtB;CACH;CAEG,GAxBD;;CAyBA,OAAKqB,KAAL,GAAa,MAAb;CACA,OAAKsL,cAAL,GAAsB,QAAtB;;CACA,OAAKC,QAAL,GAAgB,MAAM;CACzBtW,IAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqC,KAAKoW,cAA1C,EAA0D,KAAKtL,KAA/D;;CACA,QAAG,CAAC,cAAD,EAAgB,oBAAhB,EAAsChM,QAAtC,CAA+C,KAAKqX,OAAL,EAA/C,CAAH,EAAmE;CAC/D,aAAO,KAAKC,cAAZ;CACH,KAFD,MAGK,IAAG,CAAC,SAAD,EAAW,eAAX,EAA4BtX,QAA5B,CAAqC,KAAKqX,OAAL,EAArC,CAAH,EAAyD;CAC1D,aAAO,KAAKrL,KAAZ;CACH;;CACD,WAAO,UAAP;CACI,GATD;;CAUA,OAAKwL,QAAL,GAAiBxL,KAAD,IAAW;CAC9B/K,IAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ,EAAsC8K,KAAtC,EAA6C,YAA7C,EAA2D,KAAKqL,OAAL,EAA3D;;CACA,YAAO,KAAKA,OAAL,EAAP;CACA,WAAK,cAAL;CACA,WAAK,oBAAL;CACI,aAAKC,cAAL,GAAsBtL,KAAtB;CACA,aAAKzK,kBAAL,CAAwByK,KAAxB,GAAgCA,KAAhC;CACA;;CACJ,WAAK,SAAL;CACA,WAAK,eAAL;CACI,aAAKA,KAAL,GAAaA,KAAb;CACA,aAAK1K,SAAL,CAAe0K,KAAf,GAAuBA,KAAvB;CACA;CAVJ;CAYI,GAdD;;CAeA,OAAKmC,SAAL,GAAiB,QAAjB;CACA,OAAKsJ,cAAL,GAAsB,QAAtB;CACA,OAAKC,kBAAL,GAA0B,QAA1B;;CACA,OAAKC,YAAL,GAAoB,MAAM;CAC7B,QAAG,CAAC,cAAD,EAAgB,oBAAhB,EAAsC3X,QAAtC,CAA+C,KAAKqX,OAAL,EAA/C,CAAH,EACI,OAAO,KAAKK,kBAAZ,CADJ,KAEK,IAAG,CAAC,SAAD,EAAY1X,QAAZ,CAAqB,KAAKqX,OAAL,EAArB,CAAH,EACD,OAAO,KAAKlJ,SAAZ,CADC,KAEA,IAAG,CAAC,eAAD,EAAkBnO,QAAlB,CAA2B,KAAKqX,OAAL,EAA3B,CAAH,EACD,OAAO,KAAKI,cAAZ;CACJ,WAAO,eAAP;CACI,GARD;;CASA,OAAKG,YAAL,GAAqBzJ,SAAD,IAAe;CACtClN,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ,EAA0CiN,SAA1C,EAAqD,YAArD,EAAmE,KAAKkJ,OAAL,EAAnE;;CACA,QAAG,CAAC,cAAD,EAAgB,oBAAhB,EAAsCrX,QAAtC,CAA+C,KAAKqX,OAAL,EAA/C,CAAH,EAAmE;CAC/D,WAAKK,kBAAL,GAA0BvJ,SAA1B;;CACA,cAAOA,SAAP;CACA,aAAK,OAAL;CACH,eAAK5M,kBAAL,CAAwBiM,MAAxB,GAAiC,EAAjC;CACA;;CACG,aAAK,QAAL;CACH,eAAKjM,kBAAL,CAAwBiM,MAAxB,GAAiC,EAAjC;CACA;;CACG,aAAK,OAAL;CACH,eAAKjM,kBAAL,CAAwBiM,MAAxB,GAAiC,EAAjC;CACA;CATG;CAYH,KAdD,MAeK,IAAG,CAAC,SAAD,EAAYxN,QAAZ,CAAqB,KAAKqX,OAAL,EAArB,CAAH,EAAyC;CAC1C,WAAKlJ,SAAL,GAAiBA,SAAjB;;CACA,cAAOA,SAAP;CACA,aAAK,OAAL;CACH,eAAK7M,SAAL,CAAekM,MAAf,GAAwB,IAAxB;CACA;;CACG,aAAK,QAAL;CACH,eAAKlM,SAAL,CAAekM,MAAf,GAAwB,CAAxB;CACA;;CACG,aAAK,OAAL;CACH,eAAKlM,SAAL,CAAekM,MAAf,GAAwB,CAAxB;CACA;CATG;CAWH,KAbI,MAcA,IAAG,CAAC,eAAD,EAAkBxN,QAAlB,CAA2B,KAAKqX,OAAL,EAA3B,CAAH,EAA+C;CAChD,WAAKI,cAAL,GAAsBtJ,SAAtB;;CACA,cAAOA,SAAP;CACA,aAAK,OAAL;CACH,eAAK7M,SAAL,CAAekM,MAAf,GAAwB,CAAxB;CACA;;CACG,aAAK,QAAL;CACH,eAAKlM,SAAL,CAAekM,MAAf,GAAwB,EAAxB;CACA;;CACG,aAAK,OAAL;CACH,eAAKlM,SAAL,CAAekM,MAAf,GAAwB,EAAxB;CACA;CATG;CAWH;;CACDvM,IAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ,EAA+C,KAAKI,SAAL,CAAekM,MAA9D,EAAsE,KAAKjM,kBAAL,CAAwBiM,MAA9F;CACI,GA9CD,CAlqB+D;CAmtB/D;CACA;CACA;;;CACA,MAAI1L,MAAM,GAAGD,EAAb;;CACA,OAAKE,SAAL,GAAiB,MAAMD,MAAvB;;CACA,OAAKE,SAAL,GAAkBH,EAAD,IAAQC,MAAM,GAAGD,EAAlC,CAxtB+D;;;CA0tB/D,OAAKsQ,OAAL,GACH,OAAOhU,IAAP,IAAe,QAAf,GACAwC,QAAQ,CAACkE,aAAT,CAAuB1G,IAAI,CAAC,CAAD,CAAJ,IAAS,GAAT,GAAeA,IAAf,GAAuB,MAAIA,IAAlD,CADA,GAEAA,IAHG,CA1tB+D;;CA+tB/D,OAAKwU,KAAL,GAAakF,UAAU,CAAC,KAAK1F,OAAL,CAAapV,YAAb,CAA0B,OAA1B,CAAD,CAAvB;CACA,MAAG,OAAO,KAAK4V,KAAZ,IAAqB,WAArB,IAAoCmF,KAAK,CAAC,KAAKnF,KAAN,CAA5C,EAA0D,KAAKA,KAAL,GAAa,CAAb;CAC1D,OAAKoE,MAAL,GAAcc,UAAU,CAAC,KAAK1F,OAAL,CAAapV,YAAb,CAA0B,QAA1B,CAAD,CAAV,IAAmD,CAAjE;CACA,OAAK4Y,KAAL,GAAamC,KAAK,CAACD,UAAU,CAAC,KAAK1F,OAAL,CAAapV,YAAb,CAA0B,OAA1B,CAAD,CAAX,CAAL,GAAwD,CAAxD,GAA6D8a,UAAU,CAAC,KAAK1F,OAAL,CAAapV,YAAb,CAA0B,OAA1B,CAAD,CAApF,CAluB+D;;CAouB/D,MAAIgb,IAAI,GAAG,IAAX;CACA9W,EAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkC,KAAKiR,OAAvC,EAAgD4F,IAAI,CAAC5F,OAArD;CACA,MAAIA,OAAO,GAAG,KAAKA,OAAnB;CACAvD,EAAAA,UAAU,CAAC,YAAW;CACzB,QAAItK,MAAM,GAAG3D,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;CACA0D,IAAAA,MAAM,CAACqF,MAAP,GAAgBwI,OAAO,CAAC6E,YAAR,GAAqBe,IAAI,CAACpF,KAA1C;CACArO,IAAAA,MAAM,CAACoF,KAAP,GAAeyI,OAAO,CAAC6F,WAAR,GAAoBD,IAAI,CAACpF,KAAxC;CACA1R,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCiR,OAAjC,EAA0C4F,IAAI,CAAC5F,OAA/C;CACA7N,IAAAA,MAAM,CAACzD,SAAP,CAAiBC,GAAjB,CAAqB,WAArB,EAAkC,SAAlC;CACAwD,IAAAA,MAAM,CAACF,KAAP,CAAaiQ,OAAb,GAAuB,GAAvB;CACA0D,IAAAA,IAAI,CAAC3B,eAAL,GAAuB9R,MAAvB;CACA,QAAG6N,OAAO,IAAIA,OAAO,CAAC8F,UAAnB,IAAiC9F,OAAO,CAAC8F,UAAR,CAAmBA,UAAvD,EACI9F,OAAO,CAAC8F,UAAR,CAAmBA,UAAnB,CAA8BlX,WAA9B,CAA0CuD,MAA1C,EADJ,KAGI6N,OAAO,CAACpR,WAAR,CAAoBuD,MAApB;CACJyT,IAAAA,IAAI,CAACzW,SAAL,GAAiB,IAAIgI,UAAJ,CAAahF,MAAb,CAAjB;CACAyT,IAAAA,IAAI,CAACzW,SAAL,CAAekL,SAAf,GAA2B,GAA3B;CACAuL,IAAAA,IAAI,CAACzW,SAAL,CAAe0K,KAAf,GAAuB,MAAvB,CAdyB;CAgBtB;CACA;;CACH,QAAIkM,OAAO,GAAGvX,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd;CACAsX,IAAAA,OAAO,CAACvO,MAAR,GAAiBoO,IAAI,CAAC5F,OAAL,CAAa6E,YAAb,GAA0Be,IAAI,CAACpF,KAAhD;CACAuF,IAAAA,OAAO,CAACxO,KAAR,GAAgBqO,IAAI,CAAC5F,OAAL,CAAa6F,WAAb,GAAyBD,IAAI,CAACpF,KAA9C;CACAuF,IAAAA,OAAO,CAACrX,SAAR,CAAkBC,GAAlB,CAAsB,WAAtB,EAAmC,wBAAnC;CACAoX,IAAAA,OAAO,CAAC9T,KAAR,CAAciQ,OAAd,GAAwB,KAAxB;CACA0D,IAAAA,IAAI,CAAC1B,wBAAL,GAAgC6B,OAAhC;CACA,QAAG/F,OAAO,IAAIA,OAAO,CAAC8F,UAAnB,IAAiC9F,OAAO,CAAC8F,UAAR,CAAmBA,UAAvD,EACI9F,OAAO,CAAC8F,UAAR,CAAmBA,UAAnB,CAA8BlX,WAA9B,CAA0CmX,OAA1C,EADJ,KAGI/F,OAAO,CAACpR,WAAR,CAAoBuD,MAApB;CACJyT,IAAAA,IAAI,CAACxW,kBAAL,GAA0B,IAAI+H,UAAJ,CAAa4O,OAAb,CAA1B;CACAH,IAAAA,IAAI,CAACxW,kBAAL,CAAwByK,KAAxB,GAAgC,QAAhC;CACA+L,IAAAA,IAAI,CAACxW,kBAAL,CAAwBiM,MAAxB,GAAiC,EAAjC;CACAuK,IAAAA,IAAI,CAACxW,kBAAL,CAAwBiL,SAAxB,GAAoC,GAApC;CACI,GAhCS,EAgCP,CAhCO,CAAV;;CAiCA,OAAKtI,YAAL,GAAoB,MAAM;CAC7B,QAAI6T,IAAI,GAAG,IAAX;CACA9W,IAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkC,KAAKiR,OAAvC,EAAgD4F,IAAI,CAAC5F,OAArD;CACA,QAAIA,OAAO,GAAG,KAAKA,OAAnB;CACAvD,IAAAA,UAAU,CAAC,YAAW;CAClB,UAAItK,MAAM,GAAG3D,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;CACA0D,MAAAA,MAAM,CAACqF,MAAP,GAAgBwI,OAAO,CAAC6E,YAAR,GAAqBe,IAAI,CAACpF,KAA1C;CACArO,MAAAA,MAAM,CAACoF,KAAP,GAAeyI,OAAO,CAAC6F,WAAR,GAAoBD,IAAI,CAACpF,KAAxC;CACA1R,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCiR,OAAjC,EAA0C4F,IAAI,CAAC5F,OAA/C;CACA7N,MAAAA,MAAM,CAACzD,SAAP,CAAiBC,GAAjB,CAAqB,WAArB,EAAkC,SAAlC;CACAwD,MAAAA,MAAM,CAACF,KAAP,CAAaiQ,OAAb,GAAuB,GAAvB;CACA0D,MAAAA,IAAI,CAAC3B,eAAL,GAAuB9R,MAAvB;CACA,UAAI6T,CAAC,GAAGJ,IAAI,CAACxH,QAAL,CAAc,YAAd,CAAR;CACA4H,MAAAA,CAAC,CAAC,CAAD,CAAD,CAAKxW,WAAL,CAAiB2C,MAAjB,EATkB;CAWlB;CACA;CACA;;CACAyT,MAAAA,IAAI,CAACzW,SAAL,GAAiB,IAAIgI,UAAJ,CAAahF,MAAb,CAAjB;CACAyT,MAAAA,IAAI,CAACzW,SAAL,CAAekL,SAAf,GAA2B,GAA3B;CACAuL,MAAAA,IAAI,CAACzW,SAAL,CAAe0K,KAAf,GAAuB,MAAvB,CAhBkB;CAkBlB;CACA;;CACA,UAAIkM,OAAO,GAAGvX,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd;CACAsX,MAAAA,OAAO,CAACvO,MAAR,GAAiBoO,IAAI,CAAC5F,OAAL,CAAa6E,YAAb,GAA0Be,IAAI,CAACpF,KAAhD;CACAuF,MAAAA,OAAO,CAACxO,KAAR,GAAgBqO,IAAI,CAAC5F,OAAL,CAAa6F,WAAb,GAAyBD,IAAI,CAACpF,KAA9C;CACAuF,MAAAA,OAAO,CAACrX,SAAR,CAAkBC,GAAlB,CAAsB,WAAtB,EAAmC,wBAAnC;CACAoX,MAAAA,OAAO,CAAC9T,KAAR,CAAciQ,OAAd,GAAwB,KAAxB;CACA0D,MAAAA,IAAI,CAAC1B,wBAAL,GAAgC6B,OAAhC;CACAC,MAAAA,CAAC,CAAC,CAAD,CAAD,CAAKxW,WAAL,CAAiBuW,OAAjB,EA1BkB;CA4BlB;CACA;CACA;;CACAH,MAAAA,IAAI,CAACxW,kBAAL,GAA0B,IAAI+H,UAAJ,CAAa4O,OAAb,CAA1B;CACAH,MAAAA,IAAI,CAACxW,kBAAL,CAAwByK,KAAxB,GAAgC,QAAhC;CACA+L,MAAAA,IAAI,CAACxW,kBAAL,CAAwBiM,MAAxB,GAAiC,EAAjC;CACAuK,MAAAA,IAAI,CAACxW,kBAAL,CAAwBiL,SAAxB,GAAoC,GAApC;CACH,KAnCS,EAmCP,CAnCO,CAAV;CAqCI,GAzCD,CAxwB+D;;;CAmzB/D,OAAKrO,IAAL,GACH,OAAOA,IAAP,IAAe,QAAf,GACAA,IADA,GAEAA,IAAI,CAACY,EAHF;CAIA,MAAG,OAAOmR,QAAP,IAAoB,QAAvB,EACH,KAAKA,QAAL,GAAgBA,QAAhB,CADG,KAEK,IAAI,KAAKiC,OAAL,CAAaH,YAAb,CAA0B,WAA1B,CAAJ,EACR,KAAK9B,QAAL,GAAgB,KAAKiC,OAAL,CAAapV,YAAb,CAA0B,WAA1B,CAAhB,CADQ,KAGR,KAAKmT,QAAL,GAAgB,KAAK/R,IAArB;CACG8C,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6B,KAAK/C,IAAlC,EA7zB+D;;CA+zB/D,MAAIgY,aAAJ;CACA,MAAG,OAAOiC,OAAP,IAAkB,WAArB,EACHA,OAAO,CAACC,OAAR,CAAgBrb,OAAhB,CAAwBE,IAAxB,CAA6B,MAAM;CAC/B0R,IAAAA,UAAU,CAAC,MAAM;CAACuH,MAAAA,aAAa,GAAGjW,cAAc,CAAC,KAAKiS,OAAN,CAA9B;CAA8C,KAAtD,EAAuD,CAAvD,CAAV;CACH,GAFD,EADG,KAKHvD,UAAU,CAAC,MAAM;CAACuH,IAAAA,aAAa,GAAGjW,cAAc,CAAC,KAAKiS,OAAN,CAA9B;CAA8C,GAAtD,EAAuD,CAAvD,CAAV;CACGlR,EAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAuC,KAAKiR,OAA5C;;CAEA,OAAKmG,SAAL,GAAiB,MAAMnC,aAAvB;;CACA,OAAKoC,SAAL,GAAkBlK,CAAD,IAAO8H,aAAa,GAAG9H,CAAxC,CAz0B+D;;;CA20B/D,MAAIoE,KAAK,GAAG,KAAKD,kBAAL,EAAZ;CACAvR,EAAAA,OAAO,CAACC,GAAR,CAAYuR,KAAZ;CACA,OAAKnN,CAAL,GAASmN,KAAK,CAACnN,CAAf;CACA,OAAKC,CAAL,GAASkN,KAAK,CAAClN,CAAf,CA90B+D;;CAg1B/D,OAAKyQ,IAAL,CAAU,IAAV,EAAgBlU,MAAhB,EAh1B+D;;CAk1B/D,OAAK0O,WAAL,GAl1B+D;;CAo1B/D,OAAKgI,yBAAL,GAAiC,YAAY;CAChD,QAAIC,QAAQ,GAAG,EAAf;CACA,QAAIC,GAAG,GAAG,KAAKnI,QAAL,CAAc,kDAAd,CAAV;CACA,QAAItS,IAAI,GAAG,CAAX;CACAya,IAAAA,GAAG,CAACnY,OAAJ,CAAaJ,IAAD,IAAU;CAClBc,MAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ,EAA+Cf,IAA/C,EAAqDlC,IAArD;;CACA,UAAGkC,IAAI,CAAC6R,YAAL,CAAkB,YAAlB,CAAH,EAAmC;CACtCyG,QAAAA,QAAQ,CAACxa,IAAD,CAAR,GAAiB,IAAIgS,IAAJ,CAAS9P,IAAT,EAAeA,IAAI,CAACpD,YAAL,CAAkB,WAAlB,KAAkC,EAAjD,EAAqD,EAArD,EAAyD8E,EAAzD,EAA6D,EAA7D,CAAjB;CACA5D,QAAAA,IAAI;CACA;;CACD,UAAGkC,IAAI,CAAC6R,YAAL,CAAkB,iBAAlB,CAAH,EAAwC;CAC3C;CACAyG,QAAAA,QAAQ,CAACxa,IAAI,GAAC,CAAN,CAAR,GAAmB,IAAIgS,IAAJ,CAAS9P,IAAT,EAAeA,IAAI,CAACpD,YAAL,CAAkB,WAAlB,KAAkC,EAAjD,EAAqD,EAArD,EAAyD8E,EAAzD,EAA6D,EAA7D,CAAnB;CACA5D,QAAAA,IAAI;CACA;;CACD,UAAGkC,IAAI,CAAC6R,YAAL,CAAkB,MAAlB,CAAH,EAA6B;CAChC/Q,QAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;;CACA,YAAGf,IAAI,CAAC6R,YAAL,CAAkB,kBAAlB,CAAH,EAA0C;CACtC/Q,UAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;;CACA,cAAGf,IAAI,CAACpD,YAAL,CAAkB,kBAAlB,KAAyC,EAA5C,EAAgD;CACnD,gBAAI4b,CAAC,GAAG,KAAKvG,KAAL,CAAW,MAAIjS,IAAI,CAACpD,YAAL,CAAkB,kBAAlB,CAAf,CAAR;CACA0b,YAAAA,QAAQ,CAACxa,IAAD,CAAR,GAAiB,IAAIgS,IAAJ,CAAS0I,CAAT,EAAYA,CAAC,CAAC5b,YAAF,CAAe,WAAf,KAA+B,EAA3C,EAA+C,EAA/C,EAAmD8E,EAAnD,EAAuD,EAAvD,CAAjB,CAFmD;CAI/C,WAJD,MAMH4W,QAAQ,CAACxa,IAAI,IAAI4J,QAAQ,CAAC1H,IAAI,CAACpD,YAAL,CAAkB,MAAlB,CAAD,CAAR,IAAuC,CAA3C,CAAJ,GAAoD,CAArD,CAAR,GAAkE,IAAIkT,IAAJ,CAAS9P,IAAT,EAAeA,IAAI,CAACpD,YAAL,CAAkB,WAAlB,KAAkC,EAAjD,EAAqD,EAArD,EAAyD8E,EAAzD,EAA6D,EAA7D,CAAlE;CACA;;CACDZ,QAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EAAgDf,IAAhD,EAAsDlC,IAAtD;CACAA,QAAAA,IAAI,IAAI4J,QAAQ,CAAC1H,IAAI,CAACpD,YAAL,CAAkB,MAAlB,CAAD,CAAR,IAAuC,CAA/C;CACAkE,QAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EAAgDf,IAAhD,EAAsDlC,IAAtD;CACI;;CACD,UAAGkC,IAAI,CAAC6R,YAAL,CAAkB,OAAlB,CAAH,EAA8B;CACjC,YAAG7R,IAAI,CAAC6R,YAAL,CAAkB,kBAAlB,CAAH,EAA0C;CACtC,cAAG7R,IAAI,CAACpD,YAAL,CAAkB,kBAAlB,KAAyC,EAA5C,EAAgD;CACnD,gBAAI4b,CAAC,GAAG,KAAKvG,KAAL,CAAWjS,IAAI,CAACpD,YAAL,CAAkB,kBAAlB,CAAX,CAAR;CACA0b,YAAAA,QAAQ,CAACxa,IAAI,IAAI4J,QAAQ,CAAC1H,IAAI,CAACpD,YAAL,CAAkB,MAAlB,CAAD,CAAR,IAAuC,CAA3C,CAAJ,GAAoD,CAArD,CAAR,GAAkE,IAAIkT,IAAJ,CAAS0I,CAAT,EAAYA,CAAC,CAAC5b,YAAF,CAAe,WAAf,KAA+B,EAA3C,EAA+C,EAA/C,EAAmD8E,EAAnD,EAAuD,EAAvD,CAAlE;CACI,WAHD,MAKH4W,QAAQ,CAACxa,IAAI,IAAI4J,QAAQ,CAAC1H,IAAI,CAACpD,YAAL,CAAkB,MAAlB,CAAD,CAAR,IAAuC,CAA3C,CAAJ,GAAoD,CAArD,CAAR,GAAkE,IAAIkT,IAAJ,CAAS9P,IAAT,EAAeA,IAAI,CAACpD,YAAL,CAAkB,WAAlB,KAAkC,EAAjD,EAAqD,EAArD,EAAyD8E,EAAzD,EAA6D,EAA7D,CAAlE;CACA;;CACDZ,QAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EAAgDf,IAAhD,EAAsDlC,IAAtD;CACAA,QAAAA,IAAI,IAAI4J,QAAQ,CAAC1H,IAAI,CAACpD,YAAL,CAAkB,OAAlB,CAAD,CAAR,IAAwC,CAAhD;CACAkE,QAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EAAgDf,IAAhD,EAAsDlC,IAAtD;CACI;CACJ,KAxCD;CAyCA,WAAOwa,QAAP;CACI,GA9CD;;CA+CA,OAAK1H,aAAL,GAAqB,KAAKyH,yBAAL,EAArB,CAn4B+D;CAq4B/D;CACA;CACA;CACA;CACH;;CCv4Bc,kBAAU5Z,IAAV,EAAgB;CAC3B,WAASga,WAAT,CAAsBC,QAAtB,EAAgC;CACnC,QAAIC,SAAS,GAAGnY,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAhB;CACAkY,IAAAA,SAAS,CAACnC,SAAV;CAiDAkC,IAAAA,QAAQ,CAAClX,WAAT,CAAqBmX,SAArB;CACAA,IAAAA,SAAS,CAACjU,aAAV,CAAwB,cAAxB,EAAwClD,WAAxC,CAAoDkX,QAApD;CACAA,IAAAA,QAAQ,CAACtZ,gBAAT,CAA0B,WAA1B,EAAuCgB,OAAvC,CAAgDwY,QAAD,IAAc;CACzDnK,MAAAA,UAAU,CAAC,MAAM;CACpB,YAAIoK,cAAc,GAAGrY,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAArB;CACA,YAAIqY,aAAa,GAAGtY,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAApB;CACAoY,QAAAA,cAAc,CAACnY,SAAf,CAAyBC,GAAzB,CAA6B,sBAA7B;CACAmY,QAAAA,aAAa,CAACpY,SAAd,CAAwBC,GAAxB,CAA4B,gBAA5B;CACA,YAAIoY,MAAJ;;CACA,eAAOA,MAAM,GAAGH,QAAQ,CAACd,UAAzB,EAAsC;CAClCgB,UAAAA,aAAa,CAAClY,WAAd,CAA0BmY,MAA1B;CACH;;CACDF,QAAAA,cAAc,CAACjY,WAAf,CAA2BkY,aAA3B;CACAF,QAAAA,QAAQ,CAAChY,WAAT,CAAqBiY,cAArB;CACApK,QAAAA,UAAU,CAAC,MAAM;CAEb;CACA;CACA;CACA;CACA;CACA;CACA;CACH,SATS,EASR,CATQ,CAAV;CAUI,OArBS,EAqBR,CArBQ,CAAV;CAsBH,KAvBD;CAwBAiK,IAAAA,QAAQ,CAACzU,KAAT,CAAesF,KAAf,GAAuB,OAAvB;CACAmP,IAAAA,QAAQ,CAACzU,KAAT,CAAeuF,MAAf,GAAwB,OAAxB;CACAhJ,IAAAA,QAAQ,CAACpB,gBAAT,CAA0B,oBAA1B,EAAgDgB,OAAhD,CAAyDJ,IAAD,IAAS;CAACA,MAAAA,IAAI,CAACyD,gBAAL,CAAsB,OAAtB,EAAgCC,EAAD,IAAQ;CAAE5C,QAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ,EAAoD2C,EAAE,CAACsV,MAAvD,EAA+DtV,EAAE,CAACuV,MAAlE;CAA4E,OAArH;CAAwH,KAA1L;CACI;;CACD,MAAI,OAAOxa,IAAP,IAAgB,QAApB,EAA8B;CACjC,QAAGA,IAAI,CAAC,CAAD,CAAJ,IAAW,GAAd,EACIA,IAAI,GAAG,MAAIA,IAAX;CACJA,IAAAA,IAAI,GAAG+B,QAAQ,CAACkE,aAAT,CAAuBjG,IAAvB,CAAP;CACI,GAJD,MAKK,IAAI,OAAOA,IAAP,IAAgB,WAApB,EACRA,IAAI,GAAG+B,QAAQ,CAACkE,aAAT,CAAuB,eAAvB,CAAP;;CACG+T,EAAAA,WAAW,CAACha,IAAD,CAAX,CAzF2B;;CA4F3B+B,EAAAA,QAAQ,CAAC0Y,IAAT,CAAcjV,KAAd,CAAoBkV,MAApB,GAA6B,MAA7B;CACA,MAAIC,UAAU,GAAG,EAAjB;CACA5Y,EAAAA,QAAQ,CAAC0Y,IAAT,CAAczV,gBAAd,CAA+B,WAA/B,EAA6CC,EAAD,IAAQ;CACvD0V,IAAAA,UAAU,CAAChZ,OAAX,CAAoBxB,EAAD,IAAQ;CAAEya,MAAAA,YAAY,CAACza,EAAD,CAAZ;CAAmB,KAAhD;CACA4B,IAAAA,QAAQ,CAAC0Y,IAAT,CAAcjV,KAAd,CAAoBkV,MAApB,GAA6B,MAA7B;CACAC,IAAAA,UAAU,CAACpM,IAAX,CAAgByB,UAAU,CAAC,MAAM;CAAEjO,MAAAA,QAAQ,CAAC0Y,IAAT,CAAcjV,KAAd,CAAoBkV,MAApB,GAA6B,MAA7B;CAAqC,KAA9C,EAAgD,IAAhD,CAA1B;CACI,GAJD;CAKA,MAAIG,UAAU,GAAG9Y,QAAQ,CAACkE,aAAT,CAAuB,cAAvB,CAAjB;CACA,MAAI6U,QAAQ,GAAG/Y,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,CAAf;CACA,MAAI8U,KAAK,GAAGD,QAAQ,CAACna,gBAAT,CAA0B,8BAA1B,CAAZ;CACA,MAAIqa,aAAJ,EAAmBnV,eAAnB;CACA,MAAIoV,YAAJ,EAAkBtV,gBAAlB;;CACA,OAAKC,mBAAL,GAA2B,MAAMD,gBAAjC;;CACA,OAAKG,kBAAL,GAA0B,MAAMD,eAAhC;;CAEA,MAAIqV,IAAJ,EAAUC,IAAV;CACA,MAAIC,YAAJ,EAAkBC,aAAlB;;CACA,OAAKC,QAAL,GAAgB,MAAM;CAAE,WAAO;CAAC5U,MAAAA,CAAC,EAAEwU,IAAJ;CAAUvU,MAAAA,CAAC,EAAEwU,IAAb;CAAmBpH,MAAAA,KAAK,EAAEqH;CAA1B,KAAP;CAAgD,GAAxE;;CACA,MAAIG,SAAS,GAAG,KAAhB;;CACA,OAAK/E,YAAL,GAAoBzN,CAAC,IAAIwS,SAAS,GAAGxS,CAArC;;CACA,OAAK8N,YAAL,GAAoB9N,CAAC,IAAIwS,SAAzB;;CACA,OAAKrD,UAAL,GAAkB,UAAUxR,CAAV,EAAaC,CAAb,EAAgBoN,KAAhB,EAAuBoE,MAAvB,EAA+BpB,KAA/B,EAAsC;CAC3D,QAAG,KAAKF,YAAL,EAAH,EAAwB;CACpBxU,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;CACAD,MAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;CACA;CACH;;CACDD,IAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ,EAA6CoE,CAA7C,EAA+CC,CAA/C,EAAiDoN,KAAjD,EAAwDoE,MAAxD,EAAgEpB,KAAhE,EAAuE,KAAKF,YAAL,EAAvE;CACAxU,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBoE,CAAvB,EAA0BC,CAA1B,EAA6B,2BAA7B,EAA0DoN,KAA1D,EAAiEoE,MAAjE,EAAyEpB,KAAzE;CACAqE,IAAAA,YAAY,GAAGrH,KAAf;CACAsH,IAAAA,aAAa,GAAGlD,MAAhB;CACA+C,IAAAA,IAAI,GAAGxU,CAAP;CACAyU,IAAAA,IAAI,GAAGxU,CAAP;CACAtE,IAAAA,OAAO,CAACC,GAAR,CAAYoE,CAAZ,EAAcC,CAAd;CACAqJ,IAAAA,UAAU,CAAC,MAAM;CACbjO,MAAAA,QAAQ,CAACkE,aAAT,CAAuB,kBAAvB,EAA2CT,KAA3C,CAAiDgW,kBAAjD,GAAsEzE,KAAK,GAAC,GAA5E;CACAhV,MAAAA,QAAQ,CAACkE,aAAT,CAAuB,mBAAvB,EAA4CT,KAA5C,CAAkDgW,kBAAlD,GAAuEzE,KAAK,GAAC,GAA7E;CACA+D,MAAAA,QAAQ,CAACtV,KAAT,CAAegW,kBAAf,GAAoCzE,KAAK,GAAC,KAAN,GAAYA,KAAZ,GAAmB,GAAvD;CACA/G,MAAAA,UAAU,CAAC,MAAM;CACpB8K,QAAAA,QAAQ,CAACtV,KAAT,CAAeoG,IAAf,GAAsB,EAAElF,CAAC,GAAC,IAAF,GAAS,OAAK,CAAhB,IAAmB,IAAzC;CACAoU,QAAAA,QAAQ,CAACtV,KAAT,CAAesG,GAAf,GAAqB,EAAEnF,CAAC,GAAC,IAAF,GAAS,OAAK,CAAhB,IAAmB,IAAxC;CACA5E,QAAAA,QAAQ,CAACkE,aAAT,CAAuB,kBAAvB,EAA2CT,KAA3C,CAAiDiW,SAAjD,GAA6D,WAAU,IAAE1H,KAAZ,GAAmB,GAAhF;CACAhS,QAAAA,QAAQ,CAACkE,aAAT,CAAuB,mBAAvB,EAA4CT,KAA5C,CAAkDiW,SAAlD,GAA8D,YAAWtD,MAAX,GAAmB,MAAjF;CACI,OALS,EAKR,CALQ,CAAV;CAMH,KAVS,EAUR,CAVQ,CAAV;CAWA;CACI,GAzBD;;CA0BA,OAAKpS,kBAAL,GAA0B,UAAS2V,EAAT,EAAaC,EAAb,EAAiBC,MAAjB,EAAyBC,OAAzB,EAAkC9E,KAAlC,EAAyC;CACtE,SAAKmB,UAAL,CAAgBgD,IAAI,GAACQ,EAArB,EAAyBP,IAAI,GAACQ,EAA9B,EAAkCP,YAAY,GAACQ,MAA/C,EAAuDP,aAAa,GAACQ,OAArE,EAA8E9E,KAA9E;CACI,GAFD;;CAGA,OAAK+E,SAAL,GAAiB,UAASvW,IAAT,EAAe;CACnC;CACA;CACA;CACA;CACA,QAAIwO,KAAK,GAAGkF,UAAU,CAAC1T,IAAI,CAACpH,YAAL,CAAkB,OAAlB,CAAD,CAAtB,CALmC;;CAOnC,QAAI4d,kBAAkB,GAAGxW,IAAI,CAACU,aAAL,CAAmB,uBAAnB,CAAzB,CAPmC;;CASnC8N,IAAAA,KAAK,GAAGmF,KAAK,CAACnF,KAAD,CAAL,GAAe,CAAf,GAAmBA,KAA3B,CATmC;CAWnC;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;;CACAgI,IAAAA,kBAAkB,CAACvW,KAAnB,CAAyBiW,SAAzB,GAAqC,WAAS1H,KAAT,GAAe,GAApD;CACAxO,IAAAA,IAAI,CAACC,KAAL,CAAWsF,KAAX,GAAoB1K,IAAI,CAAC6S,GAAL,CAAS8I,kBAAkB,CAAC3C,WAA5B,EAAyC,IAAzC,CAAD,GAAiDrF,KAAjD,GAAuD,IAA1E;CACAxO,IAAAA,IAAI,CAACC,KAAL,CAAWuF,MAAX,GAAqB3K,IAAI,CAAC6S,GAAL,CAAS8I,kBAAkB,CAAC3D,YAA5B,EAA0C,IAA1C,CAAD,GAAkDrE,KAAlD,GAAwD,IAA5E;CACI,GA1BD;;CA2BA,OAAKiI,UAAL,GAAkB,YAAY;CACjC;CACA;CACA,QAAIC,KAAK,GAAG,SAARA,KAAQ,CAAU1a,IAAV,EAAgB;CACxBc,MAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCf,IAAlC;CACA,UAAIkB,QAAQ,GAAG1C,UAAU,CAACwB,IAAD,EAAO,WAAP,CAAzB;CACAc,MAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ,EAAsCf,IAAtC;CACA,aAAO,IAAEkB,QAAQ,CAAC3B,GAAT,CAAamb,KAAb,EAAoB5I,MAApB,CAA2B,CAAC3J,CAAD,EAAGD,CAAH,KAASrJ,IAAI,CAAC6S,GAAL,CAASvJ,CAAT,EAAWD,CAAX,CAApC,EAAkD,CAAlD,CAAT;CACH,KALD;;CAMA,QAAIyS,SAAS,GAAGD,KAAK,CAACla,QAAQ,CAAC0Y,IAAV,CAArB;CACApY,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqB4Z,SAArB;;CACA,SAAI,IAAIzd,CAAC,GAAE,CAAX,EAAcA,CAAC,GAACyd,SAAhB,EAA2Bzd,CAAC,EAA5B,EACIsc,KAAK,CAACpZ,OAAN,CAAc,KAAKma,SAAnB;CACA,GAbD;;CAcA9L,EAAAA,UAAU,CAAC,MAAM;CACpB,SAAKgM,UAAL;CACI,GAFS,EAER,CAFQ,CAAV;;CAGA,OAAKG,eAAL,GAAuB,YAAY;CACtCnB,IAAAA,aAAa,GAAG3Z,MAAM,CAAC+a,WAAvB;CACAnB,IAAAA,YAAY,GAAG5Z,MAAM,CAACgb,UAAtB;;CACA,QAAGrB,aAAa,GAAC,CAAd,GAAkBC,YAAY,GAAC,CAAlC,EAAqC;CACjCpV,MAAAA,eAAe,GAAGzF,IAAI,CAACiQ,KAAL,CAAY2K,aAAa,GAAC,CAAf,GAAkB,CAA7B,CAAlB;CACArV,MAAAA,gBAAgB,GAAGqV,aAAnB;CACAH,MAAAA,UAAU,CAACrV,KAAX,CAAiBoG,IAAjB,GAAyB,CAACvK,MAAM,CAACgb,UAAP,GAAoBxW,eAArB,IAAuC,CAAxC,GAA2C,IAAnE;CACAgV,MAAAA,UAAU,CAACrV,KAAX,CAAiB8W,KAAjB,GAA0B,CAACjb,MAAM,CAACgb,UAAP,GAAoBxW,eAArB,IAAuC,CAAxC,GAA2C,IAApE;CACAgV,MAAAA,UAAU,CAACrV,KAAX,CAAiBsF,KAAjB,GAA0BjF,eAAD,GAAkB,IAA3C;CACAgV,MAAAA,UAAU,CAACrV,KAAX,CAAiBsG,GAAjB,GAAuB,GAAvB;CACA+O,MAAAA,UAAU,CAACrV,KAAX,CAAiB+W,MAAjB,GAA0B,GAA1B;CACA1B,MAAAA,UAAU,CAACrV,KAAX,CAAiBuF,MAAjB,GAA2BpF,gBAAD,GAAmB,IAA7C;CACH,KATD,MAUK;CACDA,MAAAA,gBAAgB,GAAGvF,IAAI,CAACiQ,KAAL,CAAY4K,YAAY,GAAC,CAAd,GAAiB,CAA5B,CAAnB;CACApV,MAAAA,eAAe,GAAGoV,YAAlB;CACAJ,MAAAA,UAAU,CAACrV,KAAX,CAAiBsG,GAAjB,GAAwB,CAACzK,MAAM,CAAC+a,WAAP,GAAqBzW,gBAAtB,IAAyC,CAA1C,GAA6C,IAApE;CACAkV,MAAAA,UAAU,CAACrV,KAAX,CAAiB+W,MAAjB,GAA2B,CAAClb,MAAM,CAAC+a,WAAP,GAAqBzW,gBAAtB,IAAyC,CAA1C,GAA6C,IAAvE;CACAkV,MAAAA,UAAU,CAACrV,KAAX,CAAiBuF,MAAjB,GAA2BpF,gBAAD,GAAmB,IAA7C;CACAkV,MAAAA,UAAU,CAACrV,KAAX,CAAiB8W,KAAjB,GAAyB,GAAzB;CACAzB,MAAAA,UAAU,CAACrV,KAAX,CAAiBoG,IAAjB,GAAwB,GAAxB;CACAiP,MAAAA,UAAU,CAACrV,KAAX,CAAiBsF,KAAjB,GAAyBjF,eAAe,GAAC,IAAzC;CACH;;CACD9D,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,kBAAvB,EAA2CT,KAA3C,CAAiDgX,eAAjD,GAAoE,OAAK,CAAN,GAAS,KAAT,GAAgB,OAAK,CAArB,GAAwB,IAA3F;CACAza,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,mBAAvB,EAA4CT,KAA5C,CAAkDgX,eAAlD,GAAqE,OAAK,CAAN,GAAS,KAAT,GAAgB,OAAK,CAArB,GAAwB,IAA5F;CACAza,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,mBAAvB,EAA4CT,KAA5C,CAAkDiW,SAAlD,GAA8D,WAAU5V,eAAe,GAAC,IAA1B,GAAgC,GAA9F;CACA9D,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,EAAoCT,KAApC,CAA0C8W,KAA1C,GAAoDrT,QAAQ,CAAC4R,UAAU,CAACrV,KAAX,CAAiBoG,IAAlB,CAAT,GAAoC,IAAvF;CACA7J,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,EAAoCT,KAApC,CAA0C+W,MAA1C,GAAoD,GAApD;CACAxa,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,EAAoCT,KAApC,CAA0CC,MAA1C,GAAoD,IAApD;CACI,GA7BD;;CA8BA,OAAK0W,eAAL;CACA9a,EAAAA,MAAM,CAAC2D,gBAAP,CAAwB,QAAxB,EAAmCC,EAAD,IAAQ;CAC7C,SAAKkX,eAAL;CACA,SAAKjE,UAAL,CAAgBgD,IAAhB,EAAsBC,IAAtB,EAA4BC,YAA5B,EAA0CC,aAA1C,EAAyD,CAAzD;CACI,GAHD,EAzN2B;CA+N3B;;CACA,WAASoB,eAAT,CAAyBC,GAAzB,EAA8BT,KAA9B,EAAqC;CACxC,QAAGA,KAAK,IAAI,CAAT,IAAcA,KAAK,GAAG,CAAzB,EACI,OAAOS,GAAG,CAACpc,QAAJ,EAAP;CACJ,QAAIqc,MAAM,GAAG,EAAb;CACA,QAAIC,OAAO,GAAG,CAAC,IAAD,EAAO,GAAP,EAAY,GAAZ,EAAiB,GAAjB,EAAsB,GAAtB,EAA2B,EAA3B,EAA+B,EAA/B,EAAmC,EAAnC,EAAuC,EAAvC,EAA2C,CAA3C,EAA8C,CAA9C,EAAiD,CAAjD,EAAoD,CAApD,CAAd;CACA,QAAIC,KAAJ;CACA,QAAGZ,KAAK,IAAI,CAAZ,EACIY,KAAK,GAAG,CAAC,GAAD,EAAM,IAAN,EAAW,GAAX,EAAe,IAAf,EAAoB,GAApB,EAAyB,IAAzB,EAA+B,GAA/B,EAAoC,IAApC,EAA0C,GAA1C,EAA8C,IAA9C,EAAmD,GAAnD,EAAuD,IAAvD,EAA4D,GAA5D,CAAR,CADJ,KAGIA,KAAK,GAAG,CAAC,GAAD,EAAM,IAAN,EAAW,GAAX,EAAe,IAAf,EAAoB,GAApB,EAAyB,IAAzB,EAA+B,GAA/B,EAAoC,IAApC,EAA0C,GAA1C,EAA8C,IAA9C,EAAmD,GAAnD,EAAuD,IAAvD,EAA4D,GAA5D,CAAR;;CACJ,SAAK,IAAIpe,CAAC,GAAG,CAAb,EAAeA,CAAC,IAAEme,OAAO,CAAC7L,MAA1B,EAAiCtS,CAAC,EAAlC,EAAsC;CAClC,aAAOie,GAAG,GAACE,OAAO,CAACne,CAAD,CAAX,GAAiBie,GAAxB,EAA6B;CAChCC,QAAAA,MAAM,IAAIE,KAAK,CAACpe,CAAD,CAAf;CACAie,QAAAA,GAAG,IAAIE,OAAO,CAACne,CAAD,CAAd;CACI;CACJ;;CACD,WAAOke,MAAP;CACI;;CACD,OAAKG,gBAAL,GAAyBC,WAAD,IAAiB;CAC5C,QAAIC,GAAG,GAAG,EAAV;CACAA,IAAAA,GAAG,IAAIP,eAAe,CAACM,WAAW,CAAC,CAAD,CAAX,GAAe,CAAhB,EAAmB,CAAnB,CAAtB;;CACA,SAAI,IAAIte,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGse,WAAW,CAAChM,MAA/B,EAAuCtS,CAAC,EAAxC,EACIue,GAAG,IAAI,MAAMP,eAAe,CAACM,WAAW,CAACte,CAAD,CAAX,GAAe,CAAhB,EAAmBA,CAAnB,CAA5B;;CACJ,WAAOue,GAAP;CACI,GAND;;CAOA,OAAKC,aAAL,GAAqB,YAAY;CACpC,QAAIC,QAAQ,GAAGC,KAAK,CAACrc,GAAN,CAAWyE,IAAD,IAAUA,IAAI,CAACgN,cAAL,EAApB,CAAf;CACAxQ,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,EAAoC8R,SAApC,GAAgD,KAAK+E,gBAAL,CAAsBI,QAAtB,CAAhD;CACI,GAHD;;CAIA,OAAKE,KAAL,GAAchL,CAAD,IAAO;CACvB,SAAK0E,QAAL,CAAc1E,CAAd;CACA,SAAK7D,IAAL,CAAU6D,CAAV;CACA,SAAK/L,IAAL;CACI,GAJD;;CAKA,OAAKA,IAAL,GAAY,MAAM;CACrB,QAAGtE,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,EAAoC8R,SAApC,IAAiD,EAApD,EACI,KAAK/R,OAAL,GAFiB;;CAIrB,QAAIqX,YAAY,GAAG,KAAKlY,cAAL,EAAnB;CACA,QAAIiN,CAAC,GAAGiL,YAAY,CAAChX,IAAb,EAAR;CACA,SAAK4W,aAAL;;CACA,QAAG7K,CAAC,YAAYf,IAAhB,EAAsB;CAClB,WAAK+L,KAAL,CAAWhL,CAAX,EADkB;CAGlB;CACA;CACA;;CACA,aAAO,IAAP;CACH,KAPD,MAQK,IAAG,CAACA,CAAJ,EAAO;CACR,WAAK5L,GAAL;CACA,UAAI8W,cAAc,GAAG,KAAKnY,cAAL,EAArB;CACA,UAAGmY,cAAc,CAAC9K,iBAAf,EAAH,EACH,KAAKsE,QAAL,CAAcwG,cAAd,EAJW;;CAMR,UAAGH,KAAK,CAACpM,MAAN,GAAe,CAAf,IAAoBuM,cAAc,CAAC/K,cAAf,KAAkC+K,cAAc,CAACpL,UAAf,EAAzD,EACH,KAAK7L,IAAL,GADG,KAGH,KAAKyQ,QAAL,CAAcwG,cAAd,EATW;;CAWR,aAAO,IAAP,CAXQ;CAaX,KA5BoB;;;CA8BrB,WAAO,KAAP;CACI,GA/BD;;CAgCA,OAAKlX,QAAL,GAAgB,YAAY;CAC/B;CACA,WAAM,CAAC,KAAKC,IAAL,EAAP,EAAoB;CAChB,GAHD;;CAIA,OAAKE,QAAL,GAAiBiL,OAAD,IAAa;CAChCnP,IAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8CkP,OAA9C;CACA,QAAI+L,WAAW,GAAG,KAAKpY,cAAL,EAAlB,CAFgC;CAIhC;CACA;;CACA,QAAIiN,CAAC,GAAGmL,WAAW,CAAChX,QAAZ,EAAR,CANgC;;CAQhClE,IAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ,EAA+Cib,WAA/C,EAA4DnL,CAA5D;;CACA,QAAGA,CAAC,YAAYf,IAAhB,EAAsB;CAClB,aAAMe,CAAC,CAACE,iBAAF,cAAiCjB,IAAvC,EAA6C;CAChD,aAAK9C,IAAL,CAAU6D,CAAV;CACAA,QAAAA,CAAC,GAAGA,CAAC,CAACE,iBAAF,EAAJ;CACI;;CACD,WAAK/D,IAAL,CAAU6D,CAAV;CACA/P,MAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8CkP,OAA9C;CAEA,WAAKsF,QAAL,CAAc1E,CAAd,EAAiBZ,OAAjB,EARkB;CAWlB;;CACA,WAAKyL,aAAL;CACA,aAAO,IAAP;CACH,KAdD,MAeK,IAAG,CAAC7K,CAAJ,EAAO;CACR,WAAK5L,GAAL;CACA,UAAIgX,eAAe,GAAG,KAAKrY,cAAL,EAAtB,CAFQ;;CAIR9C,MAAAA,OAAO,CAACC,GAAR,CAAY,oCAAZ,EAAkDib,WAAW,CAAChH,YAA9D,EAA6EgH,WAAW,CAACxG,KAAzF;CAEA,UAAGoG,KAAK,CAACpM,MAAN,GAAe,CAAf,IAAoByM,eAAe,CAACjL,cAAhB,KAAmC,CAAC,CAA3D,EACH,KAAKhM,QAAL,CAAc;CAACwQ,QAAAA,KAAK,EAAGwG,WAAW,CAAChH,YAAZ,GAA2BgH,WAAW,CAAChH,YAAvC,GAAsDgH,WAAW,CAACxG;CAA3E,OAAd,EADG,KAEK;CACR,aAAKD,QAAL,CAAc0G,eAAd,EAA+BhM,OAA/B;CACAnP,QAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8CkP,OAA9C;CACI,OAXO;CAaR;CACA;;CACA,WAAKyL,aAAL;CACA,aAAO,IAAP;CACH,KAjBI,MAiBE,IAAGzL,OAAH,EAAW;CACdxB,MAAAA,UAAU,CAAC,MAAM;CACpB,aAAK8G,QAAL,CAAcyG,WAAd,EAA2B/L,OAA3B;CACI,OAFS,EAER,CAFQ,CAAV;CAGH,KA7C+B;;;CA+ChC,SAAKyL,aAAL;CACA,WAAO,KAAP,CAhDgC;CAkD5B,GAlDD;;CAmDA,OAAK3W,YAAL,GAAoB,YAAY;CACnC;CACA,WAAM,CAAC,KAAKC,QAAL,EAAP,EAAwB;CACpB,GAHD;;CAKA,OAAKuN,uBAAL,GAA+B,UAAUvS,IAAV,EAAgB;CAClDc,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAAmCf,IAAnC;;CACA,QAAIkc,eAAe,GAAIlc,IAAD,IAAU;CAC5B,aAAO;CAACmF,QAAAA,CAAC,EAAEnF,IAAI,CAACmc,UAAT;CAAqB/W,QAAAA,CAAC,EAACpF,IAAI,CAAC0W;CAA5B,OAAP;CACH,KAFD;;CAGA,QAAI0F,WAAW,GAAG,CAAlB;;CACA,QAAIC,UAAU,GAAG,SAAbA,UAAa,CAASnC,SAAT,EAAoB;CACjC,UAAIA,SAAS,IAAI,MAAjB,EACH,OAAO,CAAP;CACG,aAAOxC,UAAU,CAACwC,SAAS,CAAC5a,KAAV,CAAgB,GAAhB,EAAqB,CAArB,EAAwBA,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAAD,CAAjB;CACH,KAJD;;CAKA,QAAIgd,YAAY,GAAItc,IAAD,IAAU;CACzBc,MAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ,EAAuCf,IAAvC;CACA,UAAIuc,SAAS,GAAGL,eAAe,CAAClc,IAAD,CAA/B;CACA,UAAG,CAACA,IAAI,CAACwc,YAAT,EACH,OAAO;CAAErX,QAAAA,CAAC,EAAE,CAAL;CACLC,QAAAA,CAAC,EAAE,CADE;CAELqN,QAAAA,OAAO,EAAE,CAFJ;CAGLgK,QAAAA,OAAO,EAAE,CAHJ;CAILlT,QAAAA,KAAK,EAAE,CAJF;CAKLC,QAAAA,MAAM,EAAE,CALH;CAMLgJ,QAAAA,KAAK,EAAE;CANF,OAAP;;CAOG,UAAGxS,IAAI,CAACwc,YAAL,CAAkB9b,SAAlB,CAA4BG,QAA5B,CAAqC,UAArC,CAAH,EACA;CACHC,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBwb,SAAxB;CACA,eAAOA,SAAP;CACI;;CACD,UAAIG,OAAO,GAAGJ,YAAY,CAACtc,IAAI,CAACwc,YAAN,CAA1B;CACA,UAAIvY,KAAK,GAAGnE,MAAM,CAAC6c,gBAAP,CAAwB3c,IAAI,CAACwc,YAA7B,CAAZ,CAjByB;;CAmBzB,UAAIhK,KAAJ,CAnByB;CAqBzB;CACA;CACA;CACA;;CACAA,MAAAA,KAAK,GAAG6J,UAAU,CAACpY,KAAK,CAACiW,SAAP,CAAlB,CAzByB;CA2BzB;CACA;;CACAkC,MAAAA,WAAW,IAAI5J,KAAf,CA7ByB;CA+BzB;;CACA,aAAO;CAACrN,QAAAA,CAAC,EAACuX,OAAO,CAACvX,CAAR,GAAUoX,SAAS,CAACpX,CAAV,GAAYiX,WAAzB;CAAsChX,QAAAA,CAAC,EAACsX,OAAO,CAACtX,CAAR,GAAUmX,SAAS,CAACnX,CAAV,GAAYgX;CAA9D,OAAP;CACH,KAjCD;;CAkCA,QAAIlO,CAAC,GAAGoO,YAAY,CAACtc,IAAD,CAApB;CACA,QAAIiE,KAAK,GAAGnE,MAAM,CAAC6c,gBAAP,CAAwB3c,IAAxB,CAAZ;CACA,QAAIwS,KAAK,GAAG6J,UAAU,CAACpY,KAAK,CAACiW,SAAP,CAAtB;CACAkC,IAAAA,WAAW,IAAI5J,KAAf;CACA1R,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwB;CAACoE,MAAAA,CAAC,EAAC+I,CAAC,CAAC/I,CAAF,GAAI,IAAJ,GAAS,GAAZ;CAAiBC,MAAAA,CAAC,EAAC8I,CAAC,CAAC9I,CAAF,GAAI,IAAJ,GAAS;CAA5B,KAAxB,EAA0D,aAA1D,EAAyEgX,WAAzE,EAAsFnY,KAAK,CAACiW,SAA5F,EAAuG1H,KAAvG;CACA,QAAI9B,GAAG,GAAG;CAAEvL,MAAAA,CAAC,EAAE+I,CAAC,CAAC/I,CAAF,GAAI,IAAT;CACLC,MAAAA,CAAC,EAAE8I,CAAC,CAAC9I,CAAF,GAAI,IADF;CAELqN,MAAAA,OAAO,EAACvE,CAAC,CAAC/I,CAAF,GAAI,IAAJ,GAAS,MAAInF,IAAI,CAAC6X,WAAT,GAAqB,IAArB,GAA0BuE,WAFtC;CAGLK,MAAAA,OAAO,EAACvO,CAAC,CAAC9I,CAAF,GAAI,IAAJ,GAAS,MAAIpF,IAAI,CAAC6W,YAAT,GAAsB,IAAtB,GAA2BuF,WAHvC;CAIL7S,MAAAA,KAAK,EAAEvJ,IAAI,CAAC6X,WAAL,GAAiB,IAAjB,GAAsBuE,WAJxB;CAKL5S,MAAAA,MAAM,EAAExJ,IAAI,CAAC6W,YAAL,GAAkB,IAAlB,GAAuBuF,WAL1B;CAML5J,MAAAA,KAAK,EAAE4J;CANF,KAAV;CAOAtb,IAAAA,OAAO,CAACC,GAAR,CAAY2P,GAAZ;CACA,WAAOA,GAAP,CA1DkD;CA4DlD;CACI,GA7DD;;CA8DA,OAAK4F,aAAL,GAAqB,UAAStE,OAAT,EAAkB/B,OAAlB,EAA2B;CACnD,QAAIqC,KAAK,GAAG,KAAKC,uBAAL,CAA6BP,OAA7B,CAAZ;CACA,QAAI4K,UAAU,GAAG;CAACrT,MAAAA,KAAK,EAAEyI,OAAO,CAAC6F,WAAR,GAAoBvF,KAAK,CAACE,KAAlC;CAAyChJ,MAAAA,MAAM,EAAEwI,OAAO,CAAC6E,YAAR,GAAqBvE,KAAK,CAACE;CAA5E,KAAjB;CACA,QAAGvC,OAAH,EACI,KAAK0G,UAAL,CAAgBrE,KAAK,CAACG,OAAtB,EAA+BH,KAAK,CAACmK,OAArC,EAA8C5d,IAAI,CAAC6S,GAAL,CAASY,KAAK,CAAC/I,KAAf,EAAsB+I,KAAK,CAAC9I,MAA5B,CAA9C;CAAA,MACI,CADJ,EACOyG,OAAO,CAACuF,KAAR,GAAgBvF,OAAO,CAACuF,KAAxB,GAAgC,CADvC;CAEA,GAND;;CAOA,OAAKD,QAAL,GAAgB,UAASvR,IAAT,EAAeiM,OAAf,EAAwB;CAC3CnP,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCkP,OAAxC,EAAiDjM,IAAI,CAACgO,OAAtD,EAA+D,KAAKsD,YAAL,EAA/D;CACAxU,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BiD,IAAI,CAACgO,OAAjC,EAA0C,KAAKsD,YAAL,EAA1C;CACArF,IAAAA,OAAO,GAAGA,OAAO,GAAGA,OAAH,GAAa,EAA9B;CACAnP,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BkP,OAA3B;;CACA,QAAGjM,IAAI,CAACgO,OAAL,CAAa1R,OAAb,IAAwB,WAA3B,EACA;CACKmO,MAAAA,UAAU,CAAC,MAAM;CACrB,YAAI6D,KAAK,GAAGtO,IAAI,CAACqO,kBAAL,EAAZ;;CACA,YAAG,OAAOrO,IAAI,CAACmS,QAAZ,IAAwB,WAAxB,IAAuC,OAAOnS,IAAI,CAACoS,QAAZ,IAAwB,WAAlE,EAA+E;CAC3EtV,UAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ,EAAuCiD,IAAI,CAACmS,QAA5C,EAAsDnS,IAAI,CAACoS,QAA3D,EAAqE,KAAKd,YAAL,EAArE,EAA0FrF,OAA1F;CACA,eAAK0G,UAAL,CAAgB3S,IAAI,CAACmS,QAArB,EAA+BnS,IAAI,CAACoS,QAApC,EAA8C9D,KAAK,CAACE,KAApD,EAA2DxO,IAAI,CAAC4S,MAAhE,EAAwE,OAAO3G,OAAO,CAACuF,KAAf,IAAuB,WAAvB,GAAqCvF,OAAO,CAACuF,KAA7C,GAAsD,OAAOxR,IAAI,CAACgR,YAAZ,IAA2B,WAA3B,GAAyChR,IAAI,CAACgR,YAA9C,GAA6DhR,IAAI,CAACwR,KAAhM;CACH,SAHD,MAGO;CACHxR,UAAAA,IAAI,CAACmS,QAAL,GAAgB7D,KAAK,CAACnN,CAAtB;CAAyBnB,UAAAA,IAAI,CAACoS,QAAL,GAAgB9D,KAAK,CAAClN,CAAtB;CAAyBpB,UAAAA,IAAI,CAACgR,YAAL,GAAoBhR,IAAI,CAACwR,KAAzB;CAClD1U,UAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ,EAAuCuR,KAAK,CAACnN,CAA7C,EAAgDmN,KAAK,CAAClN,CAAtD,EAAyD,KAAKkQ,YAAL,EAAzD;CACA,eAAKqB,UAAL,CAAgBrE,KAAK,CAACnN,CAAtB,EAAyBmN,KAAK,CAAClN,CAA/B,EAAkCkN,KAAK,CAACE,KAAxC,EAA+CxO,IAAI,CAAC4S,MAApD,EAA4D,OAAO3G,OAAO,CAACuF,KAAf,IAAuB,WAAvB,GAAqCvF,OAAO,CAACuF,KAA7C,GAAsD,OAAOxR,IAAI,CAACgR,YAAZ,IAA2B,WAA3B,GAAyChR,IAAI,CAACgR,YAA9C,GAA6DhR,IAAI,CAACwR,KAApL;CACH;CACI,OAVS,EAUR,CAVQ,CAAV;CAWJ,KAbD,MAcK;CACA/G,MAAAA,UAAU,CAAC,MAAM;CACrB3N,QAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCiD,IAAI,CAACgO,OAAvC;CACA,YAAIM,KAAK,GAAG,KAAKC,uBAAL,CAA6BvO,IAAI,CAACgO,OAAlC,CAAZ;CACC,aAAK2E,UAAL,CAAgBrE,KAAK,CAACG,OAAtB,EAA+BH,KAAK,CAACmK,OAArC,EAA8C5d,IAAI,CAAC6S,GAAL,CAASY,KAAK,CAAC/I,KAAf,EAAsB+I,KAAK,CAAC9I,MAA5B,CAA9C,EAAmF,CAAnF,EAAsF,OAAOyG,OAAO,CAACuF,KAAf,IAAuB,WAAvB,GAAqCvF,OAAO,CAACuF,KAA7C,GAAqDxR,IAAI,CAACwR,KAAhJ;CACI,OAJS,EAIR,CAJQ,CAAV;CAKJ;CACG,GA1BD;;CA2BA,MAAIqH,QAAQ,GAAG,IAAI/M,IAAJ,CAASrR,IAAT,EAAe,cAAf,EAA+B,EAA/B,EAAmC,IAAnC,EAAyC,EAAzC,CAAf;CACA,MAAImd,KAAK,GAAG,CAACiB,QAAD,CAAZ,CA/b2B;;CAkc3B,OAAK7P,IAAL,GAAY,UAAU6D,CAAV,EAAa;CAC5B,SAAKiM,MAAL,GAAc1d,gBAAd,CAA+B,wBAA/B,EAAyDgB,OAAzD,CAAiEJ,IAAI,IAAIA,IAAI,CAACU,SAAL,CAAeiS,MAAf,CAAsB,aAAtB,CAAzE;CACA,QAAG9B,CAAC,CAAC6E,OAAL,EACI7E,CAAC,CAAC6E,OAAF,CAAUhV,SAAV,CAAoBC,GAApB,CAAwB,aAAxB;CACJkQ,IAAAA,CAAC,CAACmB,OAAF,CAAUtR,SAAV,CAAoBC,GAApB,CAAwB,kBAAxB;CACA,QAAGib,KAAK,CAACpM,MAAN,GAAa,CAAhB,EACIoM,KAAK,CAACA,KAAK,CAACpM,MAAN,GAAa,CAAd,CAAL,CAAsBwC,OAAtB,CAA8BtR,SAA9B,CAAwCiS,MAAxC,CAA+C,kBAA/C;CACJiJ,IAAAA,KAAK,CAAC5O,IAAN,CAAW6D,CAAX;CACA;CACI,GATD;;CAUA,OAAK5L,GAAL,GAAW,YAAY;CAC1B,SAAK6X,MAAL,GAAc1d,gBAAd,CAA+B,wBAA/B,EAAyDgB,OAAzD,CAAiEJ,IAAI,IAAIA,IAAI,CAACU,SAAL,CAAeiS,MAAf,CAAsB,aAAtB,CAAzE;CACA,QAAI9B,CAAC,GAAG+K,KAAK,CAAC3W,GAAN,EAAR;CACA4L,IAAAA,CAAC,CAACmB,OAAF,CAAUtR,SAAV,CAAoBiS,MAApB,CAA2B,kBAA3B;CACA,QAAGiJ,KAAK,CAACpM,MAAN,IAAgB,CAAnB,EACIoM,KAAK,CAAC5O,IAAN,CAAW6D,CAAX;CACJ+K,IAAAA,KAAK,CAACA,KAAK,CAACpM,MAAN,GAAa,CAAd,CAAL,CAAsBwC,OAAtB,CAA8BtR,SAA9B,CAAwCC,GAAxC,CAA4C,kBAA5C;CACA,QAAGib,KAAK,CAACA,KAAK,CAACpM,MAAN,GAAc,CAAf,CAAL,CAAuBkG,OAA1B,EACIkG,KAAK,CAACA,KAAK,CAACpM,MAAN,GAAc,CAAf,CAAL,CAAuBkG,OAAvB,CAA+BhV,SAA/B,CAAyCC,GAAzC,CAA6C,aAA7C;CACJ,WAAOkQ,CAAP;CACI,GAVD;;CAWA,OAAKjN,cAAL,GAAsB,YAAY;CACrC,WAAOgY,KAAK,CAACA,KAAK,CAACpM,MAAN,GAAc,CAAf,CAAZ;CACI,GAFD;;CAGA,OAAKuN,WAAL,GAAmB,UAAU/Y,IAAV,EAAgB;CACtCA,IAAAA,IAAI,GAAGA,IAAI,IAAI6Y,QAAf;CACA,QAAG7Y,IAAI,YAAY8L,IAAnB,EACI,OAAO;CAAC9R,MAAAA,IAAI,EAAEgG,IAAI,CAAChG,IAAZ;CAAkBgG,MAAAA,IAAI,EAAEA,IAAxB;CAA8B9C,MAAAA,QAAQ,EAAE8C,IAAI,CAACyM,aAAL,GAAqBlR,GAArB,CAA0B2L,CAAD,IAAO,KAAK6R,WAAL,CAAiB7R,CAAjB,CAAhC;CAAxC,KAAP;CACJ,WAAO;CAAC8R,MAAAA,QAAQ,EAAE;CAAX,KAAP;CACI,GALD;;CAOA,OAAKC,SAAL,GAAiB,UAASC,KAAT,EAAgB;CACpC,QAAIC,IAAI,GAAID,KAAD,IAAW;CAClB,UAAGA,KAAK,CAAC1N,MAAN,IAAgB,CAAnB,EACH;CACG2N,MAAAA,IAAI,CAACD,KAAK,CAAC,CAAD,CAAN,CAAJ;;CACA,aAAMA,KAAK,CAAC,CAAD,CAAL,CAASlM,cAAT,KAA0BkM,KAAK,CAAC,CAAD,CAArC,EACH,KAAKpY,IAAL;CACA,KAND;;CAOA8W,IAAAA,KAAK,GAAG,CAACiB,QAAD,CAAR;CACAA,IAAAA,QAAQ,CAAC/G,UAAT;CACAqH,IAAAA,IAAI,CAACD,KAAD,CAAJ;CACA,SAAK3H,QAAL,CAAc2H,KAAK,CAAC,CAAD,CAAnB;CACI,GAZD;;CAaA,MAAIE,GAAJ;;CACA,OAAKN,MAAL,GAAc,YAAW;CAC5B,QAAIM,GAAJ,EACI,OAAOA,GAAP;CACJA,IAAAA,GAAG,GAAG5c,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,CAAN;CACA,WAAO0Y,GAAP;CACI,GALD;;CAMA,OAAK3Y,OAAL,GAAe,YAAY;CAC9B3D,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;CACA,QAAIqc,GAAG,GAAG5c,QAAQ,CAACkE,aAAT,CAAuB,WAAvB,CAAV,CAF8B;;CAI9B,QAAI2Y,UAAU,GAAG7c,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;CACA,QAAI6c,IAAI,GAAG,KAAKP,WAAL,EAAX,CAL8B;;CAO9B,QAAIQ,WAAW,GAAG,CAACD,IAAD,EAAOE,gBAAP,KAA4B;CAC1C1c,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2Buc,IAA3B;CACA,UAAIG,gBAAgB,GAAGjd,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAvB;CACA,UAAIid,WAAW,GAAGld,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB,CAH0C;CAK1C;CACA;CACA;CACA;CACA;CACA;CACA;;CAEAid,MAAAA,WAAW,CAACC,SAAZ,GAAwBL,IAAI,CAACtZ,IAAL,CAAU+L,QAAlC,CAb0C;;CAc1C0N,MAAAA,gBAAgB,CAAC7c,WAAjB,CAA6B8c,WAA7B,EAd0C;;CAgB1C,UAAGJ,IAAI,CAACpc,QAAL,CAAcsO,MAAd,GAAuB,CAA1B,EAA6B;CAChC,YAAIoO,SAAS,GAAGpd,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAhB,CADgC;;CAGhC6c,QAAAA,IAAI,CAACpc,QAAL,CAAcd,OAAd,CAAsB,CAACyd,OAAD,EAAUtc,KAAV,KAAoB;CACtC,cAAIuc,mBAAmB,GAAG,CAACN,gBAAD,EAAmBF,IAAI,CAACtZ,IAAxB,EAA8BzC,KAA9B,CAA1B;CACA,cAAIwc,SAAS,GAAGvd,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAhB,CAFsC;;CAItC,cAAGod,OAAO,CAACb,QAAX,EAAqB;CACxB,gBAAIgB,SAAS,GAAI9P,CAAD,IAAO;CACnB,kBAAGA,CAAC,CAACsB,MAAF,IAAY,CAAf,EACH,OAAO,EAAP;CACG,qBAAOwO,SAAS,CAAC9P,CAAC,CAAC,CAAD,CAAF,CAAT,CAAgB+P,MAAhB,CAAuB,CAAC/P,CAAC,CAAC,CAAD,CAAF,CAAvB,CAAP;CACH,aAJD;;CAKA6P,YAAAA,SAAS,CAACJ,SAAV,GAAsB,KAAKpC,gBAAL,CAAsByC,SAAS,CAACF,mBAAD,CAA/B,CAAtB,CANwB;;CAQxBC,YAAAA,SAAS,CAACrd,SAAV,CAAoBC,GAApB,CAAwB,cAAxB;CACI,WATD,MAUHod,SAAS,CAACnd,WAAV,CAAsB2c,WAAW,CAACM,OAAD,EAAUC,mBAAV,CAAjC;;CACGC,UAAAA,SAAS,CAACta,gBAAV,CAA2B,OAA3B,EAAqCC,EAAD,IAAQ;CAC3C,gBAAGA,EAAE,CAACwa,MAAH,IAAaH,SAAhB,EAA2B;CACvB,mBAAKd,SAAL,CAAea,mBAAf;CACAhd,cAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwB+c,mBAAxB;CACH;CACD,WALD;CAMAF,UAAAA,SAAS,CAAChd,WAAV,CAAsBmd,SAAtB,EArBsC;CAwBzC,SAxBD;CAyBAN,QAAAA,gBAAgB,CAAC7c,WAAjB,CAA6Bgd,SAA7B;CACAN,QAAAA,IAAI,CAACtZ,IAAL,CAAUyR,UAAV,CAAqBgI,gBAArB,EA7BgC;CA+B5B;;CACD3c,MAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ,EAAuC0c,gBAAvC,EAhD0C;;CAkD1C,aAAOA,gBAAP;CACH,KAnDD;;CAoDAL,IAAAA,GAAG,CAAC5G,SAAJ,GAAgB,EAAhB,CA3D8B;;CA6D9B4G,IAAAA,GAAG,CAACxc,WAAJ,CAAgB2c,WAAW,CAACD,IAAD,EAAO,EAAP,CAA3B;CACI,GA9DD,CArf2B;CAsjB3B;CACA;;;CAEA,OAAKpG,OAAL,GAAe,MAAM;CACxB,WAAO,KAAKtT,cAAL,GAAsBsT,OAAtB,EAAP;CACI,GAFD;;CAGA,OAAKpT,OAAL,GAAgBmT,IAAD,IAAU;CAC5BnW,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BkW,IAA9B;CACA,SAAKrT,cAAL,GAAsBE,OAAtB,CAA8BmT,IAA9B;CACA,SAAKkH,iBAAL;CACI,GAJD;;CAKA,OAAK/G,QAAL,GAAgB,MAAM;CACzB,WAAO,KAAKxT,cAAL,GAAsBwT,QAAtB,EAAP;CACI,GAFD;;CAGA,OAAKC,QAAL,GAAiBxL,KAAD,IAAW;CAC9B/K,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+B8K,KAA/B;CACA,SAAKjI,cAAL,GAAsByT,QAAtB,CAA+BxL,KAA/B;CACA,SAAKsS,iBAAL;CACI,GAJD;;CAKA,OAAK1G,YAAL,GAAqB2G,EAAD,IAAQ;CAC/Btd,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoCqd,EAApC;CACA,SAAKxa,cAAL,GAAsB6T,YAAtB,CAAmC2G,EAAnC;CACA,SAAKD,iBAAL;CACI,GAJD;;CAKA,OAAK3G,YAAL,GAAoB,MAAM;CAC7B1W,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;CACA,WAAO,KAAK6C,cAAL,GAAsB4T,YAAtB,EAAP;CACI,GAHD;;CAIA,OAAKzT,YAAL,GAAoB,MAAM;CAC7B,SAAKH,cAAL,GAAsBG,YAAtB;CACI,GAFD;;CAGA,MAAI6T,IAAI,GAAG,IAAX;;CACA,WAASyG,aAAT,GAAyB;CAC5B7d,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,mBAAvB,EAA4CjB,gBAA5C,CAA6D,OAA7D,EAAsE,UAASC,EAAT,EAAa;CAC/EkU,MAAAA,IAAI,CAAC9T,OAAL,CAAa,SAAb;CACH,KAFD;CAGAtD,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,sBAAvB,EAA+CjB,gBAA/C,CAAgE,OAAhE,EAAyE,UAASC,EAAT,EAAa;CAClFkU,MAAAA,IAAI,CAAC9T,OAAL,CAAa,SAAb;CACH,KAFD;CAGAtD,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,sBAAvB,EAA+CjB,gBAA/C,CAAgE,OAAhE,EAAyE,UAASC,EAAT,EAAa;CAClF5C,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4B6W,IAAI,CAACV,OAAL,EAA5B;;CACA,cAAOU,IAAI,CAACV,OAAL,EAAP;CACA,aAAK,eAAL;CACHU,UAAAA,IAAI,CAAC9T,OAAL,CAAa,SAAb;CACA;;CACG,aAAK,cAAL;CACH8T,UAAAA,IAAI,CAAC9T,OAAL,CAAa,oBAAb;CACA;;CACG,aAAK,oBAAL;CACH8T,UAAAA,IAAI,CAAC9T,OAAL,CAAa,cAAb;CACA;;CACG,aAAK,SAAL;CACH8T,UAAAA,IAAI,CAAC9T,OAAL,CAAa,SAAb;CACA;;CACG,aAAK,SAAL;CACH8T,UAAAA,IAAI,CAAC9T,OAAL,CAAa,eAAb;CACA;CAfG;CAiBH,KAnBD;CAoBAtD,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,2BAAvB,EAAoDjB,gBAApD,CAAqE,OAArE,EAA8E,UAASC,EAAT,EAAa;CACvFkU,MAAAA,IAAI,CAAC9T,OAAL,CAAa,cAAb;CACH,KAFD;CAGAtD,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8CjB,gBAA9C,CAA+D,OAA/D,EAAwE,UAASC,EAAT,EAAa;CACjFkU,MAAAA,IAAI,CAACP,QAAL,CAAc,OAAd;CACH,KAFD;CAGA7W,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,oBAAvB,EAA6CjB,gBAA7C,CAA8D,OAA9D,EAAuE,UAASC,EAAT,EAAa;CAChFkU,MAAAA,IAAI,CAACP,QAAL,CAAc,MAAd;CACH,KAFD;CAGA7W,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,mBAAvB,EAA4CjB,gBAA5C,CAA6D,OAA7D,EAAsE,UAASC,EAAT,EAAa;CAC/EkU,MAAAA,IAAI,CAACP,QAAL,CAAc,KAAd;CACH,KAFD;CAGA7W,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8CjB,gBAA9C,CAA+D,OAA/D,EAAwE,UAASC,EAAT,EAAa;CACjFkU,MAAAA,IAAI,CAACP,QAAL,CAAc,OAAd;CACH,KAFD;CAGA7W,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,sBAAvB,EAA+CjB,gBAA/C,CAAgE,OAAhE,EAAyE,UAASC,EAAT,EAAa;CAClFkU,MAAAA,IAAI,CAACP,QAAL,CAAc,QAAd;CACH,KAFD;CAGA7W,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8CjB,gBAA9C,CAA+D,OAA/D,EAAwE,UAASC,EAAT,EAAa;CACjFkU,MAAAA,IAAI,CAACH,YAAL,CAAkB,OAAlB;CACH,KAFD;CAGAjX,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,sBAAvB,EAA+CjB,gBAA/C,CAAgE,OAAhE,EAAyE,UAASC,EAAT,EAAa;CAClFkU,MAAAA,IAAI,CAACH,YAAL,CAAkB,QAAlB;CACH,KAFD;CAGAjX,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8CjB,gBAA9C,CAA+D,OAA/D,EAAwE,UAASC,EAAT,EAAa;CACjFkU,MAAAA,IAAI,CAACH,YAAL,CAAkB,OAAlB;CACH,KAFD;CAGAjX,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8CjB,gBAA9C,CAA+D,OAA/D,EAAwE,UAASC,EAAT,EAAa;CACjFkU,MAAAA,IAAI,CAAC9T,OAAL,CAAa,WAAb;CACH,KAFD;CAGI;;CACD,OAAKqa,iBAAL,GAAyB,MAAM;CAClC3d,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,oBAAvB,EAA6ChE,SAA7C,CAAuDiS,MAAvD,CAA8D,SAA9D,EAAwE,cAAxE,EAAwF,eAAxF,EAAyG,oBAAzG,EAA+H,SAA/H;CACA,QAAG,KAAKuE,OAAL,MAAgB,SAAhB,IAA6B,KAAKA,OAAL,MAAgB,QAAhD,EACI1W,QAAQ,CAACkE,aAAT,CAAuB,uBAAvB,EAAgDhE,SAAhD,CAA0DiS,MAA1D,CAAiE,QAAjE,EADJ,KAGInS,QAAQ,CAACkE,aAAT,CAAuB,uBAAvB,EAAgDhE,SAAhD,CAA0DC,GAA1D,CAA8D,QAA9D;CACJH,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,oBAAvB,EAA6ChE,SAA7C,CAAuDC,GAAvD,CAA2D,KAAKuW,OAAL,EAA3D;CACA1W,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8ChE,SAA9C,CAAwDiS,MAAxD,CAA+D,OAA/D,EAAuE,MAAvE,EAA+E,KAA/E,EAAsF,OAAtF,EAA+F,QAA/F;CACAnS,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8ChE,SAA9C,CAAwDC,GAAxD,CAA4D,KAAKyW,QAAL,EAA5D;CACA5W,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8ChE,SAA9C,CAAwDiS,MAAxD,CAA+D,OAA/D,EAAuE,QAAvE,EAAiF,OAAjF;CACAnS,IAAAA,QAAQ,CAACkE,aAAT,CAAuB,qBAAvB,EAA8ChE,SAA9C,CAAwDC,GAAxD,CAA4D,KAAK6W,YAAL,EAA5D;CACI,GAXD;;CAYA/I,EAAAA,UAAU,CAAC4P,aAAD,EAAgB,CAAhB,CAAV,CA5pB2B;CA+pB3B;CACA;CAIA;;CACA,OAAKC,WAAL,GAAoB7f,IAAD,IAAU;CAChCoe,IAAAA,QAAQ,GAAGpe,IAAX;CACAmd,IAAAA,KAAK,GAAG,CAACiB,QAAD,CAAR;CACI,GAHD;;CAIA,OAAK0B,WAAL,GAAmB,MAAM1B,QAAzB;;CACA,OAAK2B,KAAL,GAAa,MAAM;CACtB5C,IAAAA,KAAK,GAAG,CAACiB,QAAD,CAAR;CACA,SAAK/X,IAAL;CACA,WAAO,IAAP;CACI,GAJD;;CAKA,OAAK2Z,OAAL,GAAe,MAAM;CACxB7C,IAAAA,KAAK,GAAG,CAACiB,QAAD,CAAR;CACAA,IAAAA,QAAQ,CAAC/G,UAAT;CACA,SAAKhR,IAAL;CACI,GAJD;;CAKA,MAAI4Z,UAAU,GAAG,IAAIC,WAAJ,CAAe,IAAf,CAAjB;;CACA,OAAKC,aAAL,GAAqB,MAAMF,UAA3B;CACH;;CClrBD;;CAEA;;;;OAGaG,MAAM,GAAGC;OACTH,UAAU,GAAGI;OACbjP,MAAI,GAAGkP;OACPC,IAAI,GAAGC;KAETC,aAAa,GAAG,MAAM;CAC7B,MAAIxd,MAAJ;CACA,MAAG,OAAOsW,OAAP,IAAkB,WAArB,EACHA,OAAO,CAACC,OAAR,CAAgBrb,OAAhB,CAAwBE,IAAxB,CAA6B,MAAM;CAC/B4E,IAAAA,MAAM,GAAG,IAAIkd,MAAJ,CAAWre,QAAQ,CAACkE,aAAT,CAAuB,eAAvB,CAAX,EAAoD8Z,KAApD,EAAT;CACH,GAFD,EADG,KAKH7c,MAAM,GAAG,IAAIkd,MAAJ,CAAWre,QAAQ,CAACkE,aAAT,CAAuB,eAAvB,CAAX,EAAoD8Z,KAApD,EAAT;CACG,SAAO7c,MAAP;CACH;CAED;;;CAGA;CACA;CACA;CACA;;;;;;;;;;;;;;"}